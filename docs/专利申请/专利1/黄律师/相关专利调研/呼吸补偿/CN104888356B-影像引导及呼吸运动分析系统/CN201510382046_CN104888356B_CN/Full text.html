<html><head><title>全文文本(Fulltext)</title><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><style>div.fullText table {width: 100%;text-indent: 1px;} 
 div.fullText table td.header {font-weight: bold;text-align: center;font-family: '宋体';font-size: 16px;line-height:20px;color: #000000;padding: 5px;}div.fullText table td.content {padding: 1px;text-align: left;vertical-align: top;width: 100%;font-family: '宋体';font-size: 14px;line-height:20px;color: #000000;}</style></head><body><?xml version="1.0" encoding="UTF-8"?><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table><tr><td id="claim_title" class="header">权利要求书</td></tr><tr><td class="content" id="claim_1"><business:ClaimText>1.一种影像引导及呼吸运动分析系统，其特征在于：包括C型臂及X射线影像系统、治疗控制系统、数据库管理系统、治疗床和影像引导放射治疗系统，影像引导放射治疗系统即IGRT系统；所述IGRT系统由影像采集软件系统、呼吸运动追踪信号采集软件系统、影像引导系统和呼吸运动分析系统组成；所述治疗床与治疗控制系统电通信连接，治疗控制系统分别与影像引导系统、呼吸运动分析系统电通信连接，所述数据库管理系统分别与影像引导系统、呼吸运动分析系统电通信连接；所述影像引导系统、呼吸运动分析系统、影像采集软件系统、呼吸运动追踪系统采集软件系统之间为电通信连接；所述呼吸运动追踪信号采集软件系统还与红外呼吸运动追踪系统电通信连接，所述C型臂与X射线影像系统、影像采集软件系统之间为电通信连接；</business:ClaimText></td></tr><tr><td class="content" id="claim_2"><business:ClaimText>其分析方法如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_3"><business:ClaimText>第一步：系统初始化，整个系统完成初始化操作；</business:ClaimText></td></tr><tr><td class="content" id="claim_4"><business:ClaimText>第二步：数据加载，所述治疗控制系统向影像引导放射治疗系统发送需要进行摆位的患者信息，影像引导放射治疗系统则根据接收到的患者信息从数据库管理系统中下载对应患者的计划影像数据；</business:ClaimText></td></tr><tr><td class="content" id="claim_5"><business:ClaimText>第三步：通过IGRT系统选择交叉定位或者CBCT定位方式进行患者摆位；</business:ClaimText></td></tr><tr><td class="content" id="claim_6"><business:ClaimText>第四步：摆位验证，基于交叉定位X线影像进行患者摆位的验证；</business:ClaimText></td></tr><tr><td class="content" id="claim_7"><business:ClaimText>第五步：呼吸运动建模，通过基于交叉定位X线影像的呼吸运动建模方式或基于4DCBCT的呼吸运动建模方式进行呼吸运动分析并得到呼吸运动模型；</business:ClaimText></td></tr><tr><td class="content" id="claim_8"><business:ClaimText>第六步：在治疗过程中，针对动态治疗目标基于交叉定位X线影像进行呼吸运动模型的验证和更新；若不是动态治疗目标，则基于交叉定位X线影像进行患者运动监测。</business:ClaimText></td></tr><tr><td class="content" id="claim_9"><business:ClaimText>2.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第一步中的系统初始化方法如下：所述IGRT系统接收治疗控制系统启动指令而启动，IGRT系统从数据库系统中获取患者影像与计划数据并选择治疗床定位参考点；IGRT系统向C型臂与X射线影像系统、影像采集系统发送初始化指令并初始化；IGRT系统向呼吸运动追踪信号采集软件系统发送初始化指令并初始化。</business:ClaimText></td></tr><tr><td class="content" id="claim_10"><business:ClaimText>3.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第三步中的交叉定位方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_11"><business:ClaimText>步骤A，IGRT系统向C型臂系统发送旋转机架指令控制C型臂旋转，使两个平板探测器运动至角度a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>；当接收到C型臂系统发送的旋转完毕信号之后，IGRT系统读取两个平板探测器当前的机架角度值a<base:Sub>11</base:Sub>与a<base:Sub>21</base:Sub>，之后向X射线影像采集系统发送启动曝光指令；</business:ClaimText></td></tr><tr><td class="content" id="claim_12"><business:ClaimText>步骤B，当IGRT系统接收到平板返回的图像就绪信号之后，IGRT系统将再次读取两个平板探测器当前的机架角度值a<base:Sub>12</base:Sub>与a<base:Sub>22</base:Sub>，并且从平板中读取图像I<base:Sub>a1</base:Sub>与I<base:Sub>a2</base:Sub>；将a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>的值分别以曝光前后的角度均值替代，即a<base:Sub>1</base:Sub>＝(a<base:Sub>11</base:Sub>+a<base:Sub>12</base:Sub>)/2，a<base:Sub>2</base:Sub>＝(a<base:Sub>21</base:Sub>+a<base:Sub>22</base:Sub>)/2；</business:ClaimText></td></tr><tr><td class="content" id="claim_13"><business:ClaimText>步骤C，IGRT系统将根据a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>生成对应角度的DRR影像DRR<base:Sub>1</base:Sub>与DRR<base:Sub>2</base:Sub>，使用DRR<base:Sub>1</base:Sub>与I<base:Sub>a1</base:Sub>配准，DRR<base:Sub>2</base:Sub>与I<base:Sub>a2</base:Sub>配准，得出定位参考点在三维空间中的偏移量。</business:ClaimText></td></tr><tr><td class="content" id="claim_14"><business:ClaimText>4.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第三步中的CBCT定位方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_15"><business:ClaimText>步骤A，IGRT系统控制C型臂旋转至起始采集角度，在确认C型臂已经到达起始采集角度之后，IGRT系统将向C型臂发送机架旋转指令并控制C型臂匀速旋转；在C型臂启动匀速旋转之初，IGRT系统将定时对C型臂的机架角度进行监控，以确保C型臂机架进入匀速旋转状态；在确认C型臂进入匀速旋转状态之后IGRT系统将向X射线影像系统发送启动透视模式指令；</business:ClaimText></td></tr><tr><td class="content" id="claim_16"><business:ClaimText>步骤B，IGRT系统进入图像采集循环中，具体过程为：IGRT系统从C型臂读取当前的机架旋转角度a<base:Sub>t1</base:Sub>，之后向X射线影像系统发送启动曝光指令，当X射线影像系统发回图像就绪信号后IGRT系统再次从C型臂读取当前的机架旋转角度a<base:Sub>t2</base:Sub>，并从X射线影像系统读取图像I<base:Sub>t</base:Sub>，图像I<base:Sub>t</base:Sub>所对应的角度值为(a<base:Sub>t1</base:Sub>+a<base:Sub>t2</base:Sub>)/2，此时若机架旋转角度a<base:Sub>t2</base:Sub>大于终止角度则退出图像采集循环，否则继续进入下一次采集循环；</business:ClaimText></td></tr><tr><td class="content" id="claim_17"><business:ClaimText>步骤C，当IGRT系统完成整个旋转采集图像的过程之后，IGRT系统将向C型臂发送停止旋转指令，并开始进行CBCT的重建，利用CBCT与计划CT进行三维图像配准以确定患者实际体位与计划体位之间的偏差量。</business:ClaimText></td></tr><tr><td class="content" id="claim_18"><business:ClaimText>5.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第四步中的摆位验证方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_19"><business:ClaimText>步骤A，IGRT系统根据之前的图像配准结果计算定位参考点的空间偏移量并通过治疗控制系统控制治疗床移动补偿偏移量；之后，IGRT系统向C型臂系统发送旋转机架指令控制C型臂旋转，使两块平板探测器分别运动至角度b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>；当接收到C型臂系统发送的旋转完毕信号之后，IGRT系统读取两块平板探测器当前的机架角度值b<base:Sub>11</base:Sub>与b<base:Sub>21</base:Sub>，之后向X射线影像采集系统发送启动曝光指令；</business:ClaimText></td></tr><tr><td class="content" id="claim_20"><business:ClaimText>步骤B，当IGRT系统接收到平板探测器返回的图像就绪信号之后，IGRT系统将再次读取两块平板探测器当前的机架角度值b<base:Sub>12</base:Sub>与b<base:Sub>22</base:Sub>，并且从两块平板探测器中读取图像I<base:Sub>b1</base:Sub>与I<base:Sub>b2</base:Sub>；将b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>的值分别以曝光前后的角度均值替代，即b<base:Sub>1</base:Sub>＝(b<base:Sub>11</base:Sub>+b<base:Sub>12</base:Sub>)/2，b<base:Sub>2</base:Sub>＝(b<base:Sub>21</base:Sub>+b<base:Sub>22</base:Sub>)/2；最后，IGRT系统将根据b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>生成对应角度的DRR影像DRR<base:Sub>1</base:Sub>与DRR<base:Sub>2</base:Sub>，将DRR<base:Sub>1</base:Sub>与I<base:Sub>b1</base:Sub>叠加显示，DRR<base:Sub>2</base:Sub>与I<base:Sub>b2</base:Sub>叠加显示；</business:ClaimText></td></tr><tr><td class="content" id="claim_21"><business:ClaimText>步骤C，若用户接收摆位验证的结果，IGRT系统将通过摆位验证过程，将治疗床由定位参考点移动至治疗等中心处，并且将摆位验证中间过程产生的数据返回至数据库管理系统；否则，IGRT系统将再次重复整个摆位验证过程直至用户接受摆位验证结果。</business:ClaimText></td></tr><tr><td class="content" id="claim_22"><business:ClaimText>6.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第五步选择基于4D CBCT的呼吸运动建模方式进行呼吸运动建模并得到呼吸运动模型；进行4D CBCT重建时，影像引导系统会将控制指令发送至呼吸运动追踪信号采集软件系统，控制红外呼吸运动追踪系统采集呼吸运动追踪信号，并将信号通过呼吸运动追踪信号采集软件系统回发至影像引导系统；在进行运动分析的过程中，呼吸运动分析系统通过影像采集软件系统与呼吸运动追踪信号采集软件系统获取患者的在线影像和呼吸运动追踪信号。</business:ClaimText></td></tr><tr><td class="content" id="claim_23"><business:ClaimText>7.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第六步中的患者运动监测方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_24"><business:ClaimText>步骤A，IGRT系统对C型臂及X射线影像采集系统进行初始化操作，并将固定在C型臂机架上的两块平板探测器旋转至指定角度a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>处；然后，IGRT系统向X射线影像采集系统发送启动曝光指令，并等待平板向其发送的图像就绪信号；当IGRT系统接收到平板探测器发送的图像就绪信号后，IGRT系统从平板探测器中读取图像I<base:Sub>t1</base:Sub>与I<base:Sub>t2</base:Sub>；</business:ClaimText></td></tr><tr><td class="content" id="claim_25"><business:ClaimText>步骤B，IGRT系统将根据计划CT生成机架角度a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>所对应的DRR影像(或者使用初始摆位时采集的a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>角度下的X射线影像)I<base:Sub>a1</base:Sub>与I<base:Sub>a2</base:Sub>，对I<base:Sub>t1</base:Sub>(I<base:Sub>t2</base:Sub>)与I<base:Sub>a1</base:Sub>(I<base:Sub>a2</base:Sub>)进行自动二维图像配准并计算三维偏移量；当三维偏移量超出允许的范围时，IGRT系统将向治疗控制系统发送中止治疗指令；若三维偏移量在允许的范围内，IGRT系统将重复之前的步骤进入下一次运动监测过程。</business:ClaimText></td></tr><tr><td class="content" id="claim_26"><business:ClaimText>8.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第五步中的基于交叉定位X线影像的呼吸运动建模方式的方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_27"><business:ClaimText>步骤A，IGRT系统将对C型臂系统以及X射线影像采集系统进行初始化操作，并在完成初始化操作之后控制C型臂机架旋转至指定角度；在确认C型臂机架已经旋转至指定角度之后，IGRT系统将进入呼吸运动模型建立的图像采集循环，该循环的具体步骤为：IGRT系统向X射线影像采集系统发送启动曝光指令，之后从呼吸运动追踪系统读取当前的呼吸运动追踪信号t，当IGRT系统接收到平板探测器的图像就绪信号之后，IGRT系统将从两块平板探测器读取该呼吸追踪信号t所对应的图像I<base:Sub>t1</base:Sub>与I<base:Sub>t2</base:Sub>，此时若采集的呼吸运动追踪信号已经覆盖了足够多的呼吸运动周期，则退出图像采集循环，否则继续该循环；</business:ClaimText></td></tr><tr><td class="content" id="claim_28"><business:ClaimText>步骤B，IGRT系统自动提取每个时相图像I<base:Sub>t1</base:Sub>与I<base:Sub>t2</base:Sub>中的金标点或靶区轮廓，并计算出其中心坐标(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)，(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)与呼吸运动追踪信号t的映射关系即为呼吸运动模型，该模型的具体参数将被IGRT系统发送至治疗控制系统以备使用。</business:ClaimText></td></tr><tr><td class="content" id="claim_29"><business:ClaimText>9.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第五步中的基于4D CBCT的呼吸运动建模方式的方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_30"><business:ClaimText>步骤A，IGRT系统将按照初始定位旋转采集时记录的呼吸运动追踪信号t对旋转采集的投影图像数据进行呼吸分相，对每个时相的投影图像进行三维重建得到该时相所对应的CBCT；</business:ClaimText></td></tr><tr><td class="content" id="claim_31"><business:ClaimText>步骤B，IGRT系统将各时相下的CBCT与计划CT进行非刚体配准，并将计划CT中的金标点或靶区轮廓映射到各时相的CBCT中；</business:ClaimText></td></tr><tr><td class="content" id="claim_32"><business:ClaimText>步骤C，IGRT系统自动提取每个时相CBCT中的金标点或靶区轮廓，并计算出其中心坐标(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)，(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)与呼吸运动追踪信号t的映射关系即为呼吸运动模型，该模型的具体参数将被IGRT系统发送至治疗控制系统以备使用。</business:ClaimText></td></tr><tr><td class="content" id="claim_33"><business:ClaimText>10.按照权利要求1所述的影像引导及呼吸运动分析系统，其特征在于：所述第六步中对呼吸运动模型进行验证与更新的方法步骤如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_34"><business:ClaimText>步骤A，IGRT系统将对C型臂系统以及X射线影像采集系统进行初始化操作，并在完成初始化操作之后控制C型臂机架旋转至指定角度；</business:ClaimText></td></tr><tr><td class="content" id="claim_35"><business:ClaimText>步骤B，在确认C型臂机架已经旋转至指定角度之后，IGRT系统将进入呼吸运动模型验证与更新的图像采集循环，该循环的具体步骤为：IGRT系统向X射线影像采集系统发送启动曝光指令，之后从呼吸运动追踪系统读取当前的呼吸运动追踪信号t，当IGRT系统接收到平板探测器的图像就绪信号之后，IGRT系统将从两块平板探测器读取该呼吸追踪信号t所对应的图像I<base:Sub>t1</base:Sub>与I<base:Sub>t2</base:Sub>，并根据图像I<base:Sub>t1</base:Sub>与I<base:Sub>t2</base:Sub>计算出金标点或者靶区轮廓的中心坐标(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)，若图像I<base:Sub>t1</base:Sub>与I<base:Sub>t2</base:Sub>中靶区中心坐标(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)与呼吸运动追踪信号t在原呼吸运动模型中所对应的靶区中心坐标(x<base:Sub>t2</base:Sub>,y<base:Sub>t2</base:Sub>,z<base:Sub>t2</base:Sub>)的差值超出了允许的范围，IGRT系统将通知治疗控制系统中止治疗过程并跳出图像采集循环，否则IGRT系统将用(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)更新呼吸运动模型，并将更新后的呼吸运动模型发送至治疗控制系统，之后进入下一次图像采集循环直到整个治疗过程结束。</business:ClaimText></td></tr></table></div><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table style="table-layout:fixed"><tr><td id="description_title" class="header">
						说明书
					</td></tr><tr><td class="content" id="description_invention_title">影像引导及呼吸运动分析系统</td></tr><tr><td class="content" id="description_1">技术领域</td></tr><tr><td class="content" id="description_2">本发明涉及放射治疗技术领域，尤其涉及一种影像引导及呼吸运动分析系统。</td></tr><tr><td class="content" id="description_3">背景技术</td></tr><tr><td class="content" id="description_4">放射治疗技术是一种常用的肿瘤治疗手段。而影像引导是保证肿瘤放射治疗精度和疗效的重要的技术手段。在肿瘤放射治疗的治疗实施环节，影像引导技术主要应用包括以下几个方面。一个是基于影像引导的患者摆位，即通过采集患者在线影像并与计划影像进行对比来调整患者的治疗体位，从而使治疗时的患者体位与计划时的患者体位一致。另外一个是自适应放射治疗，即利用在线三维影像分析患者组织器官形态和位置的变化以及实际承受照射剂量，并在必要时利用在线三维影像进行计划调整。另外一个是治疗过程中患者体位变化的监测，即在治疗过程中通过采集患者在线影像并与计划影像进行对比，从而确定患者体位的变化，并通过某种机制进行补偿。最后一个是治疗过程中运动肿瘤的实时追踪治疗，即在治疗前利用患者影像建立肿瘤的运动模型，在治疗过程中根据该模型实时估计肿瘤的位置进行动态治疗，并且应该能够在治疗过程中对该模型进行更新。为实现放射治疗的精度定位和精确治疗，影像引导方法应该同时具备以上功能才能完全满足临床上需求。目前，常用的影像引导方法大多采用基于旋转单平面成像系统或者固定双平面成像系统，只能实现部分影像引导功能，尚不能完全满足临床上的需要。</td></tr><tr><td class="content" id="description_5">发明内容</td></tr><tr><td class="content" id="description_6">针对现有技术存在的不足之处，本发明的目的在于提供一种影像引导及呼吸运动分析系统。</td></tr><tr><td class="content" id="description_7">本发明的目的通过下述技术方案实现：</td></tr><tr><td class="content" id="description_8">一种影像引导及呼吸运动分析系统，包括C型臂及X射线影像系统、治疗控制系统、数据库管理系统、治疗床和影像引导放射治疗系统，影像引导放射治疗系统即IGRT系统；所述IGRT系统由影像采集软件系统、呼吸运动追踪信号采集软件系统、影像引导系统和呼吸运动分析系统组成；所述治疗床与治疗控制系统电通信连接，治疗控制系统分别与影像引导系统、呼吸运动分析系统电通信连接，所述数据库管理系统分别与影像引导系统、呼吸运动分析系统电通信连接；所述影像引导系统、呼吸运动分析系统、影像采集软件系统、呼吸运动追踪系统采集软件系统之间为电通信连接；所述呼吸运动追踪信号采集软件系统还与红外呼吸运动追踪系统电通信连接，所述C型臂与X射线影像系统、影像采集软件系统之间为电通信连接；</td></tr><tr><td class="content" id="description_9">第一步：系统初始化，整个系统完成初始化操作；</td></tr><tr><td class="content" id="description_10">第二步：选择定位模式：通过IGRT系统选择交叉定位或者CBCT定位；</td></tr><tr><td class="content" id="description_11">第三步：摆位验证；所述治疗控制系统向影像引导系统发送需要进行摆位的患者信息，影像引导系统则根据接收到的患者信息从数据库管理系统中下载对应患者的计划影像数据；当影像引导系统下载完患者的计划影像数据后，将向影像采集软件系统发送控制指令，再通过影像采集软件系统控制C型臂与X射线影像系统采集患者的在线影像；采集到的X射线影像将通过影像采集软件系统回发送给影像引导系统，影像引导系统再根据患者的计划影像与在线影像进行摆位，并将摆位结果发送给治疗控制系统以控制治疗床移动，同时所有的摆位数据也将被发送至数据库管理系统；</td></tr><tr><td class="content" id="description_12">第四步：判断是否为动态治疗目标，如果是动态治疗目标，则通过基于X影像的呼吸运动建模方式或基于4D CBCT的呼吸运动建模方式进行呼吸运动建模并得到呼吸运动模型，然后在治疗过程中不断对呼吸运动模型进行验证与更新；如果不是动态治疗目标，则进行运动监测；</td></tr><tr><td class="content" id="description_13">第五步：呼吸运动分析系统在进行运动分析的过程中需要将控制指令以及呼吸运动模型发送给治疗控制系统，通过治疗控制系统调整治疗床与治疗机头的位置，同时也需要将运动分析的数据上传至数据库管理系统中。</td></tr><tr><td class="content" id="description_14">所述第四步选择基于4D CBCT的呼吸运动建模方式进行呼吸运动建模并得到呼吸运动模型；进行4D CBCT重建时，影像引导系统会将控制指令发送至呼吸运动追踪信号采集软件系统，控制红外呼吸运动追踪系统采集呼吸运动追踪信号，并将信号通过呼吸运动追踪信号采集软件系统回发至影像引导系统，在进行运动分析的过程中，呼吸运动分析系统通过影像采集软件系统与呼吸运动追踪信号采集软件系统获取患者的在线影像和呼吸运动追踪信号。</td></tr><tr><td class="content" id="description_15">所述第一步中的系统初始化方法如下：所述IGRT系统接收治疗控制系统启动指令而启动，IGRT系统从数据库系统中获取患者影像与计划数据并选择治疗床定位参考点；IGRT系统向C型臂与X射线影像系统、影像采集系统发送初始化指令并初始化；IGRT系统向呼吸运动追踪信号采集软件系统发送初始化指令并初始化。</td></tr><tr><td class="content" id="description_16">所述第二步中的交叉定位方法步骤如下：</td></tr><tr><td class="content" id="description_17">步骤A，IGRT系统向C型臂发送旋转机架指令并控制C型臂旋转至角度a；当接收到C型臂发送的旋转完毕信号之后，IGRT系统读取C型臂当前的机架角度值a<base:Sub>11</base:Sub>，IGRT系统向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值a<base:Sub>12</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>a1</base:Sub>；</td></tr><tr><td class="content" id="description_18">步骤B，IGRT系统完成了一个角度下的X射线影像采集过程，然后IGRT系统改变C型臂旋转角度至a<base:Sub>2</base:Sub>，当接收到C型臂发送的旋转完毕信号之后，IGRT系统读取C型臂当前的机架角度值a<base:Sub>21</base:Sub>，IGRT系统向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值a<base:Sub>22</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>a2</base:Sub>；</td></tr><tr><td class="content" id="description_19">步骤C，将a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>的值分别以曝光前后的角度均值替代，即a<base:Sub>1</base:Sub>＝(a<base:Sub>11</base:Sub>+a<base:Sub>12</base:Sub>)/2，a<base:Sub>2</base:Sub>＝(a<base:Sub>21</base:Sub>+a<base:Sub>22</base:Sub>)/2。最后，IGRT系统将根据a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>生成对应角度的DRR影像DRR<base:Sub>1</base:Sub>与DRR<base:Sub>2</base:Sub>；使用DRR<base:Sub>1</base:Sub>与I<base:Sub>a1</base:Sub>配准，使用DRR<base:Sub>2</base:Sub>与I<base:Sub>a2</base:Sub>配准，得出患者实际体位与计划体位之间偏差。</td></tr><tr><td class="content" id="description_20">本发明优选第二步中的CBCT定位方法步骤如下：</td></tr><tr><td class="content" id="description_21">步骤A，IGRT系统控制C型臂旋转至起始采集角度，在确认C型臂已经到达起始采集角度之后，IGRT系统将向C型臂发送机架旋转指令并控制C型臂匀速旋转；在C型臂启动匀速旋转之初，IGRT系统将定时对C型臂的机架角度进行监控，以确保C型臂机架进入匀速旋转状态；在确认C型臂进入匀速旋转状态之后IGRT系统将向X射线影像系统发送启动透视模式指令；</td></tr><tr><td class="content" id="description_22">步骤B，IGRT系统进入图像采集循环中，具体过程为：IGRT系统从C型臂读取当前的机架旋转角度a<base:Sub>t1</base:Sub>，之后向X射线影像系统发送启动曝光指令，当X射线影像系统发回图像就绪信号后IGRT系统再次从C型臂读取当前的机架旋转角度a<base:Sub>t2</base:Sub>，并从X射线影像系统读取图像I<base:Sub>t</base:Sub>，图像I<base:Sub>t</base:Sub>所对应的角度值为(a<base:Sub>t1</base:Sub>+a<base:Sub>t2</base:Sub>)/2，此时若机架旋转角度a<base:Sub>t2</base:Sub>大于终止角度则退出图像采集循环，否则继续进入下一次采集循环；</td></tr><tr><td class="content" id="description_23">步骤C，当IGRT系统完成整个旋转采集图像的过程之后，IGRT系统将向C型臂发送停止旋转指令，并开始进行CBCT的重建，利用CBCT与计划CT进行三维图像配准以确定患者实际体位与计划体位之间的偏差。</td></tr><tr><td class="content" id="description_24">本发明优选第三步中的摆位验证方法步骤如下：</td></tr><tr><td class="content" id="description_25">步骤A，IGRT系统根据之前的图像配准结果计算定位参考点的患者体位偏差并通过治疗控制系统控制治疗床移动补偿偏差量；IGRT系统向C型臂发送旋转机架指令控制C型臂旋转至角度b<base:Sub>1</base:Sub>。当接收到C型臂发送的旋转完毕信号之后，IGRT系统读取C型臂当前的机架角度值b<base:Sub>11</base:Sub>，之后向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值b<base:Sub>12</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>b1</base:Sub>；</td></tr><tr><td class="content" id="description_26">步骤B，IGRT系统完成了一个角度下的X射线影像采集过程，然后IGRT系统改变C型臂旋转角度至b<base:Sub>2</base:Sub>，IGRT系统读取C型臂当前的机架角度值b<base:Sub>21</base:Sub>，IGRT系统向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值b<base:Sub>22</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>b2</base:Sub>；</td></tr><tr><td class="content" id="description_27">步骤C，将b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>的值分别以曝光前后的角度均值替代，即b<base:Sub>1</base:Sub>＝(b<base:Sub>11</base:Sub>+b<base:Sub>12</base:Sub>)/2，b<base:Sub>2</base:Sub>＝(b<base:Sub>21</base:Sub>+b<base:Sub>22</base:Sub>)/2，IGRT系统将根据b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>生成对应角度的DRR影像DRR<base:Sub>1</base:Sub>与DRR<base:Sub>2</base:Sub>；将DRR<base:Sub>1</base:Sub>与I<base:Sub>b1</base:Sub>叠加显示，DRR<base:Sub>2</base:Sub>与I<base:Sub>b2</base:Sub>叠加显示；</td></tr><tr><td class="content" id="description_28">步骤D，若用户接受摆位验证的结果，IGRT系统将通过摆位验证过程，将摆位验证中间过程产生的数据返回至数据库管理系统；否则，IGRT系统将再次重复整个摆位验证过程直至用户接受摆位验证结果。</td></tr><tr><td class="content" id="description_29">本发明优选第四步中的运动监测方法步骤如下：</td></tr><tr><td class="content" id="description_30">步骤a，IGRT系统对C型臂与X射线影像系统进行初始化操作，并将C型臂机架旋转至指定角度a处；</td></tr><tr><td class="content" id="description_31">步骤b，IGRT系统向X射线影像系统发送启动曝光指令，并等待X射线影像系统向其发送的图像就绪信号；当IGRT系统接收到X射线影像系统发送的图像就绪信号后，IGRT系统从X射线影像系统读取图像I<base:Sub>t</base:Sub>，IGRT系统将根据计划CT生成机架角度a所对应的DRR影像I<base:Sub>a</base:Sub>，对I<base:Sub>t</base:Sub>与I<base:Sub>a</base:Sub>进行自动二维图像配准并计算偏移量；</td></tr><tr><td class="content" id="description_32">步骤c，当I<base:Sub>t</base:Sub>与I<base:Sub>a</base:Sub>的偏移量超出允许的范围时，IGRT系统将向治疗控制系统发送中止治疗指令；若I<base:Sub>t</base:Sub>与I<base:Sub>a</base:Sub>的偏移量在允许的范围内，IGRT系统将重复之前的步骤进入下一次运动监测过程。</td></tr><tr><td class="content" id="description_33">本发明优选第四步中的基于X影像的呼吸运动建模方式的方法步骤如下：</td></tr><tr><td class="content" id="description_34">步骤a，IGRT系统将对C型臂与X射线影像系统进行初始化操作，并在完成初始化操作之后控制C型臂机架旋转至指定角度；在确认C型臂机架已经旋转至指定角度之后，IGRT系统将进入呼吸运动模型建立的图像采集循环，该循环的具体步骤为：IGRT系统向X射线影像系统发送启动曝光指令，之后从呼吸运动追踪系统读取当前的呼吸运动追踪信号t，当IGRT系统接收到X射线影像系统的图像就绪信号之后，IGRT系统将从X射线影像系统读取该呼吸追踪信号t所对应的图像I<base:Sub>t</base:Sub>，此时若采集的呼吸运动追踪信号已经覆盖了足够多的呼吸运动周期，则退出图像采集循环，否则继续该循环；</td></tr><tr><td class="content" id="description_35">步骤b，IGRT系统自动提取每幅图像I<base:Sub>t</base:Sub>中的金标点或靶区轮廓，金标点为检测靶区的金标点，并计算出其中心坐标(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)，(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)与呼吸运动追踪信号t的映射关系即为呼吸运动模型，该模型的具体参数将被IGRT系统发送至治疗控制系统以备使用。</td></tr><tr><td class="content" id="description_36">本发明优选第四步中的基于4D CBCT的呼吸运动建模方式的方法步骤如下：</td></tr><tr><td class="content" id="description_37">步骤a，IGRT系统将按照初始定位旋转采集时记录的呼吸运动追踪信号t对旋转采集的投影图像数据进行呼吸分相，对每个时相的投影图像进行三维重建得到该时相所对应的CBCT；</td></tr><tr><td class="content" id="description_38">步骤b，IGRT系统将各时相下的CBCT与计划CT进行非刚体配准，并将计划CT中的金标点或靶区轮廓映射到各时相的CBCT中；</td></tr><tr><td class="content" id="description_39">步骤c，IGRT系统自动提取每个时相CBCT中的金标点或靶区轮廓，并计算出其中心坐标(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)，(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)与呼吸运动追踪信号t的映射关系即为呼吸运动模型，该模型的具体参数将被IGRT系统发送至治疗控制系统以备使用。</td></tr><tr><td class="content" id="description_40">本发明优选第四步中对呼吸运动模型进行验证与更新的方法步骤如下：</td></tr><tr><td class="content" id="description_41">步骤a，IGRT系统将对C型臂与X射线影像系统进行初始化操作，并在完成初始化操作之后控制C型臂机架旋转至指定角度；</td></tr><tr><td class="content" id="description_42">步骤b，在确认C型臂机架已经旋转至指定角度之后，IGRT系统将进入呼吸运动模型验证与更新的图像采集循环，该循环的具体步骤为：IGRT系统向X射线影像系统发送启动曝光指令，之后从呼吸运动追踪系统读取当前的呼吸运动追踪信号t，当IGRT系统接收到X射线影像系统的图像就绪信号之后，IGRT系统将从X射线影像系统读取该呼吸追踪信号t所对应的图像I<base:Sub>t</base:Sub>，并从图像I<base:Sub>t</base:Sub>中自动提取金标点或者靶区轮廓的中心坐标(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)，若图像I<base:Sub>t</base:Sub>中靶区中心坐标(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)与呼吸运动追踪信号t在原呼吸运动模型中所对应的靶区中心坐标(x<base:Sub>t2</base:Sub>,y<base:Sub>t2</base:Sub>,z<base:Sub>t2</base:Sub>)的差值超出了允许的范围，IGRT系统将通知治疗控制系统中止治疗过程并跳出图像采集循环，否则IGRT系统将用(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)更新呼吸运动模型，并将更新后的呼吸运动模型发送至治疗控制系统，之后进入下一次图像采集循环直到整个治疗过程结束。</td></tr><tr><td class="content" id="description_43">本发明较现有技术相比，具有以下优点及有益效果：</td></tr><tr><td class="content" id="description_44">(1)本发明兼备基于交叉定位二维X光影像和三维CBCT影像的两种患者定位方式，从而可以在治疗前利用三维CBCT影像进行快速、准确的患者摆位、自适应放射治疗分析，在治疗中利用交叉定位二维X光影像进行患者体位变化的在线监测和运动组织的实时追踪。此外，还可以针对不同患者和不同治疗部位制定个体化的摆位方法。</td></tr><tr><td class="content" id="description_45">(2)本发明可以在完成患者摆位后进行患者四维CBCT的重建，通过将各时相下的CBCT与计划CT进行非刚体配准获取准确的肿瘤运动模型。该模型不仅描述肿瘤质心的运动轨迹，而且还包含了肿瘤的旋转和形状变化情况。此外，结合交叉定位二维X光影像定位方式，本发明可以在治疗过程中对肿瘤运动模型进行验证和更新。</td></tr><tr><td class="content" id="description_46">附图说明</td></tr><tr><td class="content" id="description_47">图1为本发明的影像引导及呼吸运动分析系统的数据流图；</td></tr><tr><td class="content" id="description_48">图2为本发明的整体流程示意图；</td></tr><tr><td class="content" id="description_49">图3为本发明IGRT系统初始化过程的逻辑流程图；</td></tr><tr><td class="content" id="description_50">图4为本发明交叉定位过程的逻辑流程图；</td></tr><tr><td class="content" id="description_51">图5为本发明CBCT定位过程的逻辑流程图；</td></tr><tr><td class="content" id="description_52">图6为本发明摆位验证过程的逻辑流程图；</td></tr><tr><td class="content" id="description_53">图7为本发明运动监测的逻辑流程图；</td></tr><tr><td class="content" id="description_54">图8为本发明基于X射线影像呼吸运动建模的逻辑流程图；</td></tr><tr><td class="content" id="description_55">图9为本发明基于4D CBCT呼吸运动建模的逻辑流程图；</td></tr><tr><td class="content" id="description_56">图10为本发明呼吸运动模型验证与更新的逻辑流程图；。</td></tr><tr><td class="content" id="description_57">具体实施方式</td></tr><tr><td class="content" id="description_58">下面结合实施例对本发明作进一步地详细说明：</td></tr><tr><td class="content" id="description_59">实施例</td></tr><tr><td class="content" id="description_60">如图1～图10所示，一种影像引导及呼吸运动分析系统，包括C型臂及X射线影像系统、治疗控制系统、数据库管理系统、治疗床和影像引导放射治疗系统，影像引导放射治疗系统即IGRT系统；所述IGRT系统由影像采集软件系统、呼吸运动追踪信号采集软件系统、影像引导系统和呼吸运动分析系统组成；所述治疗床与治疗控制系统电通信连接，治疗控制系统分别与影像引导系统、呼吸运动分析系统电通信连接，所述数据库管理系统分别与影像引导系统、呼吸运动分析系统电通信连接；所述影像引导系统、呼吸运动分析系统、影像采集软件系统、呼吸运动追踪系统采集软件系统之间为电通信连接；所述呼吸运动追踪信号采集软件系统还与红外呼吸运动追踪系统电通信连接，所述C型臂与X射线影像系统、影像采集软件系统之间为电通信连接；</td></tr><tr><td class="content" id="description_61">第一步：系统初始化，整个系统完成初始化操作；</td></tr><tr><td class="content" id="description_62">第二步：选择定位模式：通过IGRT系统选择交叉定位或者CBCT定位；</td></tr><tr><td class="content" id="description_63">第三步：摆位验证；所述治疗控制系统分向影像引导系统发送需要进行摆位的患者信息，影像引导系统则根据接收到的患者信息从数据库管理系统中下载对应患者的计划影像数据；当影像引导系统下载完患者的计划影像数据后，将向影像采集软件系统发送控制指令，再通过影像采集软件系统控制C型臂与X射线影像采集系统采集患者的在线影像；采集到的X射线影像将通过影像采集软件系统回发送给影像引导系统，影像引导系统再根据患者的计划影像与在线影像进行摆位，并将摆位结果发送给治疗控制系统以控制治疗床移动，同时所有的摆位数据也将被发送至数据库管理系统；</td></tr><tr><td class="content" id="description_64">第四步：判断是否为动态治疗目标，如果是动态治疗目标，则通过基于X影像的呼吸运动建模方式或基于4D CBCT的呼吸运动建模方式进行呼吸运动建模并得到呼吸运动模型，然后在治疗过程中不断对呼吸运动模型进行验证与更新；如果不是动态治疗目标，则进行运动监测；</td></tr><tr><td class="content" id="description_65">第五步：呼吸运动分析系统在进行运动分析的过程中需要将控制指令以及呼吸运动模型发送给治疗控制系统，通过治疗控制系统调整治疗床与治疗机头的位置，同时也需要将运动分析的数据上传至数据库管理系统中。</td></tr><tr><td class="content" id="description_66">根据本发明一种优选实施方式，所述第四步选择基于4D CBCT的呼吸运动建模方式进行呼吸运动建模并得到呼吸运动模型；进行4D CBCT重建时，影像引导系统会将控制指令发送至呼吸运动追踪信号采集软件系统，控制红外呼吸运动追踪系统采集呼吸运动追踪信号，并将信号通过呼吸运动追踪信号采集软件系统回发至影像引导系统，在进行运动分析的过程中，呼吸运动分析系统通过影像采集软件系统与呼吸运动追踪信号采集软件系统获取患者的在线影像和呼吸运动追踪信号。</td></tr><tr><td class="content" id="description_67">根据本发明一种优选实施方式，所述第一步中的系统初始化方法如下：所述IGRT系统接收治疗控制系统启动指令而启动，IGRT系统从数据库系统中获取患者影像与计划数据并选择治疗床定位参考点；IGRT系统向C型臂与X射线影像系统、影像采集系统发送初始化指令并初始化；IGRT系统向呼吸运动追踪信号采集软件系统发送初始化指令并初始化。</td></tr><tr><td class="content" id="description_68">根据本发明一种优选实施方式，所述第二步中的交叉定位方法步骤如下：</td></tr><tr><td class="content" id="description_69">步骤A，IGRT系统向C型臂发送旋转机架指令并控制C型臂旋转至角度a；当接收到C型臂发送的旋转完毕信号之后，IGRT系统读取C型臂当前的机架角度值a<base:Sub>11</base:Sub>，IGRT系统向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值a<base:Sub>12</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>a1</base:Sub>；</td></tr><tr><td class="content" id="description_70">步骤B，IGRT系统完成了一个角度下的X射线影像采集过程，然后IGRT系统改变C型臂旋转角度至a<base:Sub>2</base:Sub>，当接收到C型臂发送的旋转完毕信号之后，IGRT系统读取C型臂当前的机架角度值a<base:Sub>21</base:Sub>，IGRT系统向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值a<base:Sub>22</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>a2</base:Sub>；</td></tr><tr><td class="content" id="description_71">步骤C，将a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>的值分别以曝光前后的角度均值替代，即a<base:Sub>1</base:Sub>＝(a<base:Sub>11</base:Sub>+a<base:Sub>12</base:Sub>)/2，a<base:Sub>2</base:Sub>＝(a<base:Sub>21</base:Sub>+a<base:Sub>22</base:Sub>)/2。最后，IGRT系统将根据a<base:Sub>1</base:Sub>与a<base:Sub>2</base:Sub>生成对应角度的DRR影像DRR<base:Sub>1</base:Sub>与DRR<base:Sub>2</base:Sub>；使用DRR<base:Sub>1</base:Sub>与I<base:Sub>a1</base:Sub>配准，使用DRR<base:Sub>2</base:Sub>与I<base:Sub>a2</base:Sub>配准，得出定位参考点在三维空间中的偏移量。</td></tr><tr><td class="content" id="description_72">根据本发明一种优选实施方式，所述第二步中的CBCT定位方法步骤如下：</td></tr><tr><td class="content" id="description_73">步骤A，IGRT系统控制C型臂旋转至起始采集角度，在确认C型臂已经到达起始采集角度之后，IGRT系统将向C型臂发送机架旋转指令并控制C型臂匀速旋转；在C型臂启动匀速旋转之初，IGRT系统将定时对C型臂的机架角度进行监控，以确保C型臂机架进入匀速旋转状态；在确认C型臂进入匀速旋转状态之后IGRT系统将向X射线影像系统发送启动透视模式指令；</td></tr><tr><td class="content" id="description_74">步骤B，IGRT系统进入图像采集循环中，具体过程为：IGRT系统从C型臂读取当前的机架旋转角度a<base:Sub>t1</base:Sub>，之后向X射线影像系统发送启动曝光指令，当X射线影像系统发回图像就绪信号后IGRT系统再次从C型臂读取当前的机架旋转角度a<base:Sub>t2</base:Sub>，并从X射线影像系统读取图像I<base:Sub>t</base:Sub>，图像I<base:Sub>t</base:Sub>所对应的角度值为(a<base:Sub>t1</base:Sub>+a<base:Sub>t2</base:Sub>)/2，此时若机架旋转角度a<base:Sub>t2</base:Sub>大于终止角度则退出图像采集循环，否则继续进入下一次采集循环；</td></tr><tr><td class="content" id="description_75">步骤C，当IGRT系统完成整个旋转采集图像的过程之后，IGRT系统将向C型臂发送停止旋转指令，并开始进行CBCT的重建，利用CBCT与计划CT进行三维图像配准以确定定位参考点的空间偏移量。</td></tr><tr><td class="content" id="description_76">根据本发明一种优选实施方式，所述第三步中的摆位验证方法步骤如下：</td></tr><tr><td class="content" id="description_77">步骤A，IGRT系统根据之前的图像配准结果计算定位参考点的空间偏移量并通过治疗控制系统控制治疗床移动补偿偏移量；IGRT系统向C型臂发送旋转机架指令控制C型臂旋转至角度b<base:Sub>1</base:Sub>。当接收到C型臂发送的旋转完毕信号之后，IGRT系统读取C型臂当前的机架角度值b<base:Sub>11</base:Sub>，之后向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值b<base:Sub>12</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>b1</base:Sub>；</td></tr><tr><td class="content" id="description_78">步骤B，IGRT系统完成了一个角度下的X射线影像采集过程，然后IGRT系统改变C型臂旋转角度至b<base:Sub>2</base:Sub>，IGRT系统读取C型臂当前的机架角度值b<base:Sub>21</base:Sub>，IGRT系统向X射线影像系统发送启动曝光指令；当IGRT系统接收到X射线影像系统返回的图像就绪信号之后，IGRT系统将再次读取C型臂当前的机架角度值b<base:Sub>22</base:Sub>，并且从X射线影像系统中读取图像I<base:Sub>b2</base:Sub>；</td></tr><tr><td class="content" id="description_79">步骤C，将b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>的值分别以曝光前后的角度均值替代，即b<base:Sub>1</base:Sub>＝(b<base:Sub>11</base:Sub>+b<base:Sub>12</base:Sub>)/2，b<base:Sub>2</base:Sub>＝(b<base:Sub>21</base:Sub>+b<base:Sub>22</base:Sub>)/2，IGRT系统将根据b<base:Sub>1</base:Sub>与b<base:Sub>2</base:Sub>生成对应角度的DRR影像DRR<base:Sub>1</base:Sub>与DRR<base:Sub>2</base:Sub>；将DRR<base:Sub>1</base:Sub>与I<base:Sub>b1</base:Sub>叠加显示，DRR<base:Sub>2</base:Sub>与I<base:Sub>b2</base:Sub>叠加显示；</td></tr><tr><td class="content" id="description_80">步骤D，若用户接收摆位验证的结果，IGRT系统将通过摆位验证过程，将治疗床由定位参考点移动至治疗等中心处，并且将摆位验证中间过程产生的数据返回至数据库管理系统；否则，IGRT系统将再次重复整个摆位验证过程直至用户接受摆位验证结果。</td></tr><tr><td class="content" id="description_81">根据本发明一种优选实施方式，所述第四步中的运动监测方法步骤如下：</td></tr><tr><td class="content" id="description_82">步骤a，IGRT系统对C型臂与X射线影像系统进行初始化操作，并将C型臂机架旋转至指定角度a处；</td></tr><tr><td class="content" id="description_83">步骤b，IGRT系统向X射线影像系统发送启动曝光指令，并等待X射线影像系统向其发送的图像就绪信号；当IGRT系统接收到X射线影像系统发送的图像就绪信号后，IGRT系统从X射线影像系统读取图像I<base:Sub>t</base:Sub>，IGRT系统将根据计划CT生成机架角度a所对应的DRR影像I<base:Sub>a</base:Sub>，对I<base:Sub>t</base:Sub>与I<base:Sub>a</base:Sub>进行自动二维图像配准并计算偏移量；</td></tr><tr><td class="content" id="description_84">步骤c，当I<base:Sub>t</base:Sub>与I<base:Sub>a</base:Sub>的偏移量超出允许的范围时，IGRT系统将向治疗控制系统发送中止治疗指令；若I<base:Sub>t</base:Sub>与I<base:Sub>a</base:Sub>的偏移量在允许的范围内，IGRT系统将重复之前的步骤进入下一次运动监测过程。</td></tr><tr><td class="content" id="description_85">根据本发明一种优选实施方式，所述第四步中的基于X影像的呼吸运动建模方式的方法步骤如下：</td></tr><tr><td class="content" id="description_86">步骤a，IGRT系统将对C型臂与X射线影像系统进行初始化操作，并在完成初始化操作之后控制C型臂机架旋转至指定角度；在确认C型臂机架已经旋转至指定角度之后，IGRT系统将进入呼吸运动模型建立的图像采集循环，该循环的具体步骤为：IGRT系统向X射线影像系统发送启动曝光指令，之后从呼吸运动追踪系统读取当前的呼吸运动追踪信号t，当IGRT系统接收到X射线影像系统的图像就绪信号之后，IGRT系统将从X射线影像系统读取该呼吸追踪信号t所对应的图像I<base:Sub>t</base:Sub>，此时若采集的呼吸运动追踪信号已经覆盖了足够多的呼吸运动周期，则退出图像采集循环，否则继续该循环；</td></tr><tr><td class="content" id="description_87">步骤b，IGRT系统自动提取每幅图像I<base:Sub>t</base:Sub>中的金标点或靶区轮廓，金标点为检测靶区的金标点，并计算出其中心坐标(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)，(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)与呼吸运动追踪信号t的映射关系即为呼吸运动模型，该模型的具体参数将被IGRT系统发送至治疗控制系统以备使用。</td></tr><tr><td class="content" id="description_88">根据本发明一种优选实施方式，所述第四步中的基于4D CBCT的呼吸运动建模方式的方法步骤如下：</td></tr><tr><td class="content" id="description_89">步骤a，IGRT系统将按照初始定位旋转采集时记录的呼吸运动追踪信号t对旋转采集的投影图像数据进行分类，对每个时相的投影图像进行三维重建得到该时相所对应的CBCT；</td></tr><tr><td class="content" id="description_90">步骤b，IGRT系统将各时相下的CBCT与计划CT进行非刚体配准，并将计划CT中的金标点或靶区轮廓映射到各时相的CBCT中；</td></tr><tr><td class="content" id="description_91">步骤c，IGRT系统自动提取每个时相CBCT中的金标点或靶区轮廓，并计算出其中心坐标(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)，(x<base:Sub>t</base:Sub>,y<base:Sub>t</base:Sub>,z<base:Sub>t</base:Sub>)与呼吸运动追踪信号t的映射关系即为呼吸运动模型，该模型的具体参数将被IGRT系统发送至治疗控制系统以备使用。</td></tr><tr><td class="content" id="description_92">根据本发明一种优选实施方式，所述第四步中对呼吸运动模型进行验证与更新的方法步骤如下：</td></tr><tr><td class="content" id="description_93">步骤a，IGRT系统将对C型臂与X射线影像系统进行初始化操作，并在完成初始化操作之后控制C型臂机架旋转至指定角度；</td></tr><tr><td class="content" id="description_94">步骤b，在确认C型臂机架已经旋转至指定角度之后，IGRT系统将进入呼吸运动模型验证与更新的图像采集循环，该循环的具体步骤为：IGRT系统向X射线影像系统发送启动曝光指令，之后从呼吸运动追踪系统读取当前的呼吸运动追踪信号t，当IGRT系统接收到X射线影像系统的图像就绪信号之后，IGRT系统将从X射线影像系统读取该呼吸追踪信号t所对应的图像I<base:Sub>t</base:Sub>，并从图像I<base:Sub>t</base:Sub>中自动提取金标点或者靶区轮廓的中心坐标(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)，若图像I<base:Sub>t</base:Sub>中靶区中心坐标(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)与呼吸运动追踪信号t在原呼吸运动模型中所对应的靶区中心坐标(x<base:Sub>t2</base:Sub>,y<base:Sub>t2</base:Sub>,z<base:Sub>t2</base:Sub>)的差值超出了允许的范围，IGRT系统将通知治疗控制系统中止治疗过程并跳出图像采集循环，否则IGRT系统将用(x<base:Sub>t1</base:Sub>,y<base:Sub>t1</base:Sub>,z<base:Sub>t1</base:Sub>)原呼吸运动模型中的(x<base:Sub>t2</base:Sub>,y<base:Sub>t2</base:Sub>,z<base:Sub>t2</base:Sub>)，并将更新后的呼吸运动模型发送至治疗控制系统，之后进入下一次图像采集循环直到整个治疗过程结束。</td></tr><tr><td class="content" id="description_95">以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。</td></tr></table></div></body></html>