<html><head><title>全文文本(Fulltext)</title><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><style>div.fullText table {width: 100%;text-indent: 1px;} 
 div.fullText table td.header {font-weight: bold;text-align: center;font-family: '宋体';font-size: 16px;line-height:20px;color: #000000;padding: 5px;}div.fullText table td.content {padding: 1px;text-align: left;vertical-align: top;width: 100%;font-family: '宋体';font-size: 14px;line-height:20px;color: #000000;}</style></head><body><?xml version="1.0" encoding="UTF-8"?><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table><tr><td id="claim_title" class="header">权利要求书</td></tr><tr><td class="content" id="claim_1"><business:ClaimText>1.一种呼吸运动建模方法，其特征在于，包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_2"><business:ClaimText>采集脏器不同部位的2D超声序列；</business:ClaimText></td></tr><tr><td class="content" id="claim_3"><business:ClaimText>对每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；</business:ClaimText></td></tr><tr><td class="content" id="claim_4"><business:ClaimText>从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将所述呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；</business:ClaimText></td></tr><tr><td class="content" id="claim_5"><business:ClaimText>将所述重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；</business:ClaimText></td></tr><tr><td class="content" id="claim_6"><business:ClaimText>将所述呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</business:ClaimText></td></tr><tr><td class="content" id="claim_7"><business:ClaimText>2.根据权利要求1所述的呼吸运动建模方法，其特征在于，所述方法还包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_8"><business:ClaimText>对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入所述呼吸模型进行呼吸运动估计与补偿。</business:ClaimText></td></tr><tr><td class="content" id="claim_9"><business:ClaimText>3.一种呼吸运动建模装置，其特征在于，包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_10"><business:ClaimText>呼吸参考信号提取模块，用于对于2D超声探头采集的脏器不同部位的每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；</business:ClaimText></td></tr><tr><td class="content" id="claim_11"><business:ClaimText>4D超声数据重建模块，用于从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将所述呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；</business:ClaimText></td></tr><tr><td class="content" id="claim_12"><business:ClaimText>变换矩阵生成模块，用于将所述重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；</business:ClaimText></td></tr><tr><td class="content" id="claim_13"><business:ClaimText>呼吸模型生成模块，用于将所述呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</business:ClaimText></td></tr><tr><td class="content" id="claim_14"><business:ClaimText>4.根据权利要求3所述的呼吸运动建模装置，其特征在于，还包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_15"><business:ClaimText>呼吸估计与补偿模块，用于对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入所述呼吸模型进行呼吸运动估计与补偿。</business:ClaimText></td></tr><tr><td class="content" id="claim_16"><business:ClaimText>5.一种呼吸运动建模系统，其特征在于，包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_17"><business:ClaimText>计算机、超声机；</business:ClaimText></td></tr><tr><td class="content" id="claim_18"><business:ClaimText>所述超声机用于通过2D超声探头采集脏器不同部位的2D超声序列；</business:ClaimText></td></tr><tr><td class="content" id="claim_19"><business:ClaimText>所述计算机包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_20"><business:ClaimText>呼吸参考信号提取模块，用于对于2D超声探头采集的脏器不同部位的每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；</business:ClaimText></td></tr><tr><td class="content" id="claim_21"><business:ClaimText>4D超声数据重建模块，用于从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将所述呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；</business:ClaimText></td></tr><tr><td class="content" id="claim_22"><business:ClaimText>变换矩阵生成模块，用于将所述重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；</business:ClaimText></td></tr><tr><td class="content" id="claim_23"><business:ClaimText>呼吸模型生成模块，用于将所述呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</business:ClaimText></td></tr><tr><td class="content" id="claim_24"><business:ClaimText>6.根据权利要求5所述呼吸运动建模系统，其特征在于，所述计算机还包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_25"><business:ClaimText>呼吸估计与补偿模块，用于对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入所述呼吸模型进行呼吸运动估计与补偿。</business:ClaimText></td></tr></table></div><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table style="table-layout:fixed"><tr><td id="description_title" class="header">
						说明书
					</td></tr><tr><td class="content" id="description_invention_title">一种呼吸运动建模方法、装置和系统</td></tr><tr><td class="content" id="description_1">技术领域</td></tr><tr><td class="content" id="description_2">本发明涉及医疗技术领域，具体地说，涉及一种呼吸运动建模方法、装置和系统。</td></tr><tr><td class="content" id="description_3">背景技术</td></tr><tr><td class="content" id="description_4">呼吸运动对腹胸部器官的微创手术造成了许多的阻碍，因呼吸导致的器官运动会造成静态的导航信息与移动的器官之间的不匹配，降低导航的准确性。在使用传统的图像导航时，医生需要凭借经验和知识来判断由呼吸运动造成的脏器或病灶的位移。但对于一些缺乏临床经验的医生，可能会出现因病灶位置判断不准确而引起病人的痛苦或者并发症的情况。呼吸运动模型的建立为上述问题的解决提供了可能性。因此，呼吸运动建模也成了近年来医学图像处理领域的研究热点。</td></tr><tr><td class="content" id="description_5">目前，MR/CT成像的速度还不足以提供具有足够时间分辨率的三维运动信息用于导航，并且采集成本过高。此外，CT成像还存在数据采集过程中产生有害辐射的问题。相比之下基于超声成像的呼吸运动建模成为了研究的热点。但超声成像的呼吸运动模型仍然有以下缺陷：</td></tr><tr><td class="content" id="description_6">1)、利用单纯外部或内部标志点跟踪的方式不仅需要安装外设或是寻找特定的内部解刨学特征点，而且跟踪到的呼吸运动只能代表该标志点处的运动，，不是整个感兴趣区域的运动；</td></tr><tr><td class="content" id="description_7">2)、基于外设来提取呼吸参考信号会给手术加上额外限制条件，且外设与图像获取之间可能存在延迟，影响了准确性与灵活性；</td></tr><tr><td class="content" id="description_8">3)、目前3D超声探头没有得到普及，术中实时4D(即三维运动+时间)的超声数据难以获取；</td></tr><tr><td class="content" id="description_9">4)、脏器受呼吸运动的影响发生形变，而目前大多数基于超声体数据的运动分析是刚性的或是仿射的，忽略了脏器的形变。</td></tr><tr><td class="content" id="description_10">基于现有技术存在的上述问题，急需一种新的技术方案。</td></tr><tr><td class="content" id="description_11">发明内容</td></tr><tr><td class="content" id="description_12">为了克服上述技术问题，本发明提供了一种呼吸运动建模方法、装置和系统，提高了呼吸运动建模的有效性。</td></tr><tr><td class="content" id="description_13">为了实现上述目的，一方面，本发明提供了一种呼吸运动建模方法，包括：</td></tr><tr><td class="content" id="description_14">采集脏器不同部位的2D超声序列；</td></tr><tr><td class="content" id="description_15">对每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；</td></tr><tr><td class="content" id="description_16">从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将所述呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；</td></tr><tr><td class="content" id="description_17">将所述重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；</td></tr><tr><td class="content" id="description_18">将所述呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</td></tr><tr><td class="content" id="description_19">在本发明的一种可选的实施方式中，所述方法还包括：</td></tr><tr><td class="content" id="description_20">对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入所述呼吸模型进行呼吸运动估计与补偿。</td></tr><tr><td class="content" id="description_21">另一方面，本发明还提供了一种呼吸运动建模装置，包括：</td></tr><tr><td class="content" id="description_22">呼吸参考信号提取模块，用于对于2D超声探头采集的脏器不同部位的每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；</td></tr><tr><td class="content" id="description_23">4D超声数据重建模块，用于从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将所述呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；</td></tr><tr><td class="content" id="description_24">变换矩阵生成模块，用于将所述重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；</td></tr><tr><td class="content" id="description_25">呼吸模型生成模块，用于将所述呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</td></tr><tr><td class="content" id="description_26">在本发明的一种可选的实施方式中，还包括：</td></tr><tr><td class="content" id="description_27">呼吸估计与补偿模块，用于对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入所述呼吸模型进行呼吸运动估计与补偿。</td></tr><tr><td class="content" id="description_28">另一方面，本发明还提供了一种呼吸运动建模系统，包括：</td></tr><tr><td class="content" id="description_29">计算机、超声机；</td></tr><tr><td class="content" id="description_30">所述超声机用于通过2D超声探头采集脏器不同部位的2D超声序列；</td></tr><tr><td class="content" id="description_31">所述计算机包括：</td></tr><tr><td class="content" id="description_32">呼吸参考信号提取模块，用于对于2D超声探头采集的脏器不同部位的每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；</td></tr><tr><td class="content" id="description_33">4D超声数据重建模块，用于从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将所述呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；</td></tr><tr><td class="content" id="description_34">变换矩阵生成模块，用于将所述重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；</td></tr><tr><td class="content" id="description_35">呼吸模型生成模块，用于将所述呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</td></tr><tr><td class="content" id="description_36">在本发明的一种可选的实施方式中，所述计算机还包括：</td></tr><tr><td class="content" id="description_37">呼吸估计与补偿模块，用于对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入所述呼吸模型进行呼吸运动估计与补偿。</td></tr><tr><td class="content" id="description_38">本发明所述的一种呼吸运动建模方法、装置和系统，该方法包括：采集脏器不同部位的2D超声序列；对每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取；从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将呼吸信号对应的图像子序列重采样，得到重建的4D超声数据；将重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵；将呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。本发明的技术方案具有以下优点：1、直接输入整个超声序列来提取呼吸参考信号，不需要任何外设跟踪呼吸运动或标志点，也不要求图像中需具有特定的解刨学特征。2、利用2D超声序列重建4D超声数据，使用普通2D超声探头也可以获得4D超声数据，提高系统的适用性和实用性。3、考虑了脏器(比如肝脏)因呼吸运动产生的形变，采用B-样条插值的方法实现了不同呼吸节点超声体数据之间的弹性配准。4、重建的三维图像序列可以在半个呼吸周期内捕获活动的脏器，使脏器的三维运动可视化。</td></tr><tr><td class="content" id="description_39">附图说明</td></tr><tr><td class="content" id="description_40">图1为本发明所述一种呼吸运动建模方法的流程图；</td></tr><tr><td class="content" id="description_41">图2为本发明所述的4D超声重建的示意图；</td></tr><tr><td class="content" id="description_42">图3为本发明所述的术前呼吸运动建模与术中的呼吸运动估计补偿的示意图；</td></tr><tr><td class="content" id="description_43">图4为本发明所述的4D超声呼吸模型建立的示意图；</td></tr><tr><td class="content" id="description_44">图5为本发明所述一种呼吸运动建模装置的框图；</td></tr><tr><td class="content" id="description_45">图6为本发明所述一种呼吸运动建模系统的示意图。</td></tr><tr><td class="content" id="description_46">具体实施方式</td></tr><tr><td class="content" id="description_47">下面参考附图来说明本发明的实施例。在本发明的一个附图或一种实施方式中描述的元素和特征可以与一个或更多个其他附图或实施方式中示出的元素和特征相结合。应当注意，为了清楚的目的，附图和说明中省略了与本发明无关的、本领域普通技术人员已知的部件或处理的表示和描述。</td></tr><tr><td class="content" id="description_48">本发明实施例提供了一种呼吸运动建模方法，如图1所示，该方法包括：</td></tr><tr><td class="content" id="description_49">101、采集脏器不同部位的2D超声序列。</td></tr><tr><td class="content" id="description_50">在术前利用2D超声探头采集患者自由呼吸情况下脏器(如肝脏)不同部位横截面的超声序列，每个呼吸序列包含3～4个呼吸周期。使超声探头尽量保持在一条垂直在超声平面的直线上移动，超声序列图像平面之间尽量保持平行。该采集过程可使用机械臂完成。</td></tr><tr><td class="content" id="description_51">102、对每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取。</td></tr><tr><td class="content" id="description_52">基于kd-树最近邻查找的流形学习方法采用LTSA算法，具体流程如下：</td></tr><tr><td class="content" id="description_53">(1)将所有输入的图像数据进行适当降采样后处理成高维的向量；</td></tr><tr><td class="content" id="description_54">(2)对所有输入的图像数据处理成高维向量后建立kd-树，对每个输入向量x<base:Sub>i</base:Sub>，选择与其最近的k个最近邻(包括x<base:Sub>i</base:Sub>在内)构成局部邻域X<base:Sub>i</base:Sub>,其中<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540782&amp;blobId=3788406780" width="492"/>表示k个最近邻；</td></tr><tr><td class="content" id="description_55">(3)将超声序列中每帧图像与其对应的k个最近邻输入到LTSA算法中进行呼吸信号参考值的计算，输出一个一维向量，该一维向量就作为该序列的呼吸参考信号；</td></tr><tr><td class="content" id="description_56">(4)对每组超声序列重复上述过程将得到多组呼吸参考信号，用于呼吸信号同步，实现基于2D超声序列的4D超声数据重建。</td></tr><tr><td class="content" id="description_57">对于超声肝脏图像，与其他运动、变形或噪音相比，呼吸运动占主导地位。呼吸参考信号被认为是一维基本呼吸模式，其可以以3D呼吸运动的主要成分为特征。因此，本发明实施例中的呼吸信号被定义为一维的。</td></tr><tr><td class="content" id="description_58">103、从每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将呼吸信号对应的图像子序列重采样，得到重建的4D超声数据。</td></tr><tr><td class="content" id="description_59">图2是本发明所提出的4D超声重建的示意图，所述的4D超声重建包括以下几个步骤：</td></tr><tr><td class="content" id="description_60">1)、每组2D超声序列提取出呼吸信号，有S<base:Sub>1</base:Sub>,...,S<base:Sub>i</base:Sub>,...,S<base:Sub>N</base:Sub>个呼吸信号；</td></tr><tr><td class="content" id="description_61">2)、对每个S<base:Sub>i</base:Sub>找出多对连续的呼气末参考值EE和吸气末参考值EI；</td></tr><tr><td class="content" id="description_62">3)、从多对EE和EI中找一对EE<base:Sub>i</base:Sub>和EI<base:Sub>i</base:Sub>，其值与所有EE和EI的平均值最接近；</td></tr><tr><td class="content" id="description_63">4)、把EE<base:Sub>i</base:Sub>和EI<base:Sub>i</base:Sub>之间的子图像序列提出，对子图像序列利用线性插值的方法进行重采样为k帧，每帧都对应不同节点；</td></tr><tr><td class="content" id="description_64">5)、将具有相同呼吸节点的图像组合起来构成3D体数据，从而获得一组从呼气末到吸气末的4D超声数据。即进行4D超声重建，获得从3D+t<base:Sub>1</base:Sub>到3D+t<base:Sub>K</base:Sub>的超声图像。</td></tr><tr><td class="content" id="description_65">104、将重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵。</td></tr><tr><td class="content" id="description_66">105、将呼吸参考信号和对应的变换矩阵进行线性拟合，生成呼吸模型。</td></tr><tr><td class="content" id="description_67">进一步的，在步骤105后，该方法还包括：</td></tr><tr><td class="content" id="description_68">对术中采集的实时2D超声序列计算实时呼吸参考信号值并输入呼吸模型进行呼吸运动估计与补偿。</td></tr><tr><td class="content" id="description_69">通过呼吸估计与补偿，使呼吸模型更符合实际情况，准确性更高。</td></tr><tr><td class="content" id="description_70">图3示出了术前运动呼吸建模与术中的呼吸运动估计补偿的示意图。其中，术前采集2D超声序列并提取呼吸参考信号。然后进行4D超声重建，得到3D+t<base:Sub>1</base:Sub>至3D+t<base:Sub>K</base:Sub>的超声图像，将术中实时获得的呼吸参考信号输入到术前建立的3D呼吸模型中，得到与该参考信号相对应的形变场用于术中引导图像的呼吸运动估计或补偿。</td></tr><tr><td class="content" id="description_71">下面对步骤104-105的实现进行具体描述。</td></tr><tr><td class="content" id="description_72">104获得变换矩阵具体实现为：</td></tr><tr><td class="content" id="description_73">首先将4D超声数据中的3D体数据标记为I(y)，其中y＝(x<base:Sup>T</base:Sup>,t)<base:Sup>T</base:Sup>∈R<base:Sup>3</base:Sup>×R，y表示I上的一个坐标，包括空间位置x∈R<base:Sup>3</base:Sup>及时间位置t∈R。每个图像都有其对应的呼吸信号的值。</td></tr><tr><td class="content" id="description_74">呼吸运动模型大体可以简化为一个公式来表示，如下：</td></tr><tr><td class="content" id="description_75">M＝Φ(s)  (1)</td></tr><tr><td class="content" id="description_76">其中，s表示运动模型输入参考数据，例如器官或皮肤表面的位移；M表示运动模型的输出结果，可以是通过配准得到的变换矩阵，Φ表示输入与输出之间的对应关系。</td></tr><tr><td class="content" id="description_77">通过基于B-样条参数化的弹性配准的方法计算出可以描述超声体数据呼吸运动的形变场。为了避免因选择的参考图像而引入潜在偏差，在此选用全局配准的方法，使用全局的损失函数及全局的优化策略。在这里所有体数据都向一个潜在的体数据配准，该体数据位于所有图像运动的中心。基于B-样条的弹性形变配准通过在图像数据上均匀分布的控制点的约束来确定图像中特征点的偏移量Δy。基于B样条弹性配准计算的变换T定义如下：</td></tr><tr><td class="content" id="description_78"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540646&amp;blobId=3788394102" width="492"/></td></tr><tr><td class="content" id="description_79">其中，y<base:Sub>k</base:Sub>表示控制点，β<base:Sup>r</base:Sup>(y)为B样条最优顺序多项式，p<base:Sub>k</base:Sub>表示B-样条系数向量，N<base:Sub>y</base:Sub>表示在y处的B样条的紧支撑内的所有控制点的集合，T<base:Sub>μ</base:Sub>(y)或T<base:Sub>μ</base:Sub>(x,t)表示基于B-样条的坐标变换矩阵。</td></tr><tr><td class="content" id="description_80">在通过正确配准后各个时间点上的体数据对应空间位置上的强度值相同的假设下，利用公式(3)的相异性矩阵来测量配准的结果，并利用一个全局优化策略最小化公式(3)，获得变换参数。</td></tr><tr><td class="content" id="description_81"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540668&amp;blobId=3788716073" width="492"/></td></tr><tr><td class="content" id="description_82">其中，</td></tr><tr><td class="content" id="description_83"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540735&amp;blobId=3788573060" width="492"/></td></tr><tr><td class="content" id="description_84">S和T分别是空间和时间的体像素。为了避免对相异性测度的优化成为一个未限定问题，因此，将时间上的平均变形约束为恒等变换：</td></tr><tr><td class="content" id="description_85"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540773&amp;blobId=3788613671" width="492"/></td></tr><tr><td class="content" id="description_86">利用自适应随机梯度下降优化器(ASGD)来优化变换的参数使得相异性矩阵最小，即：</td></tr><tr><td class="content" id="description_87"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540715&amp;blobId=3788395423" width="492"/></td></tr><tr><td class="content" id="description_88">ASGD优化器要求损失函数对μ的导数是已知的，由下微分公式得，</td></tr><tr><td class="content" id="description_89"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540725&amp;blobId=3788696835" width="492"/></td></tr><tr><td class="content" id="description_90">进一步可得：</td></tr><tr><td class="content" id="description_91"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540703&amp;blobId=3788485084" width="492"/></td></tr><tr><td class="content" id="description_92">加上公式(5)的约束，即减去每个导数向量的均值，使得B-样条系数总和为零。用公式(9)来确定<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540759&amp;blobId=3788608719" width="66"/>每个元素i的约束更新：</td></tr><tr><td class="content" id="description_93"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540682&amp;blobId=3788493882" width="492"/></td></tr><tr><td class="content" id="description_94">其中，Q<base:Sub>i</base:Sub>表示μ随时间变化的对应于与元素i相同的空间网格点位置和方向的所有元素的集合。</td></tr><tr><td class="content" id="description_95">与传统的基于梯度的优化器相比，该优化器的主要优点在于它在导数计算中应用了数据的随机采样，使计算时间显著减少。以上步骤实现了不同呼吸节点间3D超声体数据之间的弹性配准，保证了运动分析的准确性，其结果的是得到描述超声体数据呼吸运动的形变场。</td></tr><tr><td class="content" id="description_96">在此基础上，步骤105的具体实现为：</td></tr><tr><td class="content" id="description_97">将变换矩阵和呼吸参考信号值进行拟合，建立半个周期的呼吸模型。每条曲线建立成呼吸信号值的多项式，如式(10)所示。使用线性最小二乘拟合来确定呼吸运动模型参数A。最终获得呼吸模型。</td></tr><tr><td class="content" id="description_98"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540654&amp;blobId=3788574418" width="492"/></td></tr><tr><td class="content" id="description_99">进一步的，实现呼吸运动估计与补偿的具体实现为：</td></tr><tr><td class="content" id="description_100">输入i时刻的呼吸参考信号值s<base:Sub>i</base:Sub>后获得对应的变换矩阵<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540694&amp;blobId=3788473765" width="86"/>通过变换矩阵的逆变换可将该时刻的图像映射到参考图像，实现呼吸运动的估计与补偿。</td></tr><tr><td class="content" id="description_101">图4是本发明所提出的4D超声呼吸模型建立的示意图，将N个时刻的体数据向参考图像配准，得到形变矩阵也就是变换矩阵<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4587540767&amp;blobId=3788597267" width="85"/>将变化矩阵与对应的呼吸参考信号拟合得到3D呼吸模型。</td></tr><tr><td class="content" id="description_102">本发明实施例提供的呼吸运动建模方法具有以下优点：直接输入整个超声序列来提取呼吸参考信号，不需要任何外设跟踪呼吸运动或标志点，也不要求图像中需具有特定的解刨学特征；并且利用2D超声序列重建4D超声数据，使用普通2D超声探头也可以获得4D超声数据，提高系统的适用性和实用性；同时本发明实施例的技术方案考虑了脏器(比如肝脏)因呼吸运动产生的形变，采用B-样条插值的方法实现了不同呼吸节点超声体数据之间的弹性配准；此外，重建的三维图像序列可以在半个呼吸周期内捕获活动的脏器，使脏器的三维运动可视化。</td></tr><tr><td class="content" id="description_103">本发明实施例还提供了一种呼吸运动建模装置，如图5所示，该装置包括：</td></tr><tr><td class="content" id="description_104">呼吸参考信号提取模块51，用于对于2D超声探头采集的脏器不同部位的每个2D超声序列，以整张帧图像为感兴趣区域，采用基于kd-树最近邻查找的流形学习方法进行降维分析，将流形学习结果输出的数值作为参考信号，实现呼吸参考信号的提取。</td></tr><tr><td class="content" id="description_105">4D超声数据重建模块52，用于从呼吸参考信号提取模块51提取的每个2D超声序列的呼吸参考信号中提取一个从呼气末到吸气末的呼吸信号，将呼吸信号对应的图像子序列重采样，得到重建的4D超声数据。</td></tr><tr><td class="content" id="description_106">变换矩阵生成模块53，用于将4D超声数据重建模块52重建出的4D超声数据进行基于B-样条参数化的拉格朗日nD+t形变模型的弹性配准，获得变换矩阵。</td></tr><tr><td class="content" id="description_107">呼吸模型生成模块54，用于将呼吸参考信号提取模块51提取的呼吸参考信号和对应的变换矩阵生成模块53获得的变换矩阵进行线性拟合，生成呼吸模型。</td></tr><tr><td class="content" id="description_108">进一步的，该装置还包括呼吸估计与补偿模块，用于计算术中采集的实时2D超声序列的实时呼吸参考信号值并将该实时呼吸参考信号值输入呼吸模型进行呼吸运动估计与补偿。</td></tr><tr><td class="content" id="description_109">本发明实施例还提供了一种呼吸运动建模系统，如图6所示，包括：</td></tr><tr><td class="content" id="description_110">计算机61、超声机62。</td></tr><tr><td class="content" id="description_111">超声机62用于通过2D超声探头采集脏器不同部位的2D超声序列。</td></tr><tr><td class="content" id="description_112">计算机61包括：</td></tr><tr><td class="content" id="description_113">呼吸参考信号提取模块、4D超声数据重建模块、变换矩阵生成模块、呼吸模型生成模块。</td></tr><tr><td class="content" id="description_114">该计算机61进一步的还可以包括呼吸估计与补偿模块。</td></tr><tr><td class="content" id="description_115">对呼吸参考信号提取模块、4D超声数据重建模块、变换矩阵生成模块、呼吸模型生成模块、呼吸估计与补偿模块的描述可以参考前文，此处不再赘述。</td></tr><tr><td class="content" id="description_116">本发明实施例提供的呼吸运动建模装置及系统能够通过常规超声机采集超声信号，并向计算机输入整个超声序列来提取呼吸参考信号，不需要任何外设跟踪呼吸运动或标志点，也无需图像中具有特定的解刨学特征。同时，通过2D超声序列重建4D超声数据，使用普通2D超声探头也可以获得4D超声数据，提高系统的适用性和实用性。并且，本发明实施例通过考察脏器(比如肝脏)因呼吸运动产生的形变，采用B-样条插值的方法实现不同呼吸节点超声体数据之间的弹性配准。本发明实施例重建的三维图像序列可以在半个呼吸周期内捕获活动的脏器，使脏器的三维运动可视化。综合来看，本发明实施例的技术方案具有安全、方便、高效、精准的特点，为医生的手术操作提供了有力的保障和支援，提升了判断准确性，降低了对临床经验的依赖。</td></tr><tr><td class="content" id="description_117">虽然已经详细说明了本发明及其优点，但是应当理解在不超出由所附的权利要求所限定的本发明的精神和范围的情况下可以进行各种改变、替代和变换。而且，本申请的范围不仅限于说明书所描述的过程、设备、手段、方法和步骤的具体实施例。本领域内的普通技术人员从本发明的公开内容将容易理解，根据本发明可以使用执行与在此所述的相应实施例基本相同的功能或者获得与其基本相同的结果的、现有和将来要被开发的过程、设备、手段、方法或者步骤。因此，所附的权利要求旨在在它们的范围内包括这样的过程、设备、手段、方法或者步骤。</td></tr></table></div></body></html>