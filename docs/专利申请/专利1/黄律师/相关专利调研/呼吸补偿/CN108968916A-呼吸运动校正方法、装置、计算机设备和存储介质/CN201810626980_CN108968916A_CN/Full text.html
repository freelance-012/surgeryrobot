<html><head><title>全文文本(Fulltext)</title><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><style>div.fullText table {width: 100%;text-indent: 1px;} 
 div.fullText table td.header {font-weight: bold;text-align: center;font-family: '宋体';font-size: 16px;line-height:20px;color: #000000;padding: 5px;}div.fullText table td.content {padding: 1px;text-align: left;vertical-align: top;width: 100%;font-family: '宋体';font-size: 14px;line-height:20px;color: #000000;}</style></head><body><?xml version="1.0" encoding="UTF-8"?><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table><tr><td id="claim_title" class="header">权利要求书</td></tr><tr><td class="content" id="claim_1"><business:ClaimText>1.一种呼吸运动校正方法，其特征在于，所述呼吸运动校正方法包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_2"><business:ClaimText>获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_3"><business:ClaimText>根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_4"><business:ClaimText>通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；</business:ClaimText></td></tr><tr><td class="content" id="claim_5"><business:ClaimText>获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</business:ClaimText></td></tr><tr><td class="content" id="claim_6"><business:ClaimText>2.根据权利要求1所述的呼吸运动校正方法，其特征在于，所述根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_7"><business:ClaimText>根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_8"><business:ClaimText>获取第二呼气形变场集合和第二吸气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_9"><business:ClaimText>将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_10"><business:ClaimText>将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</business:ClaimText></td></tr><tr><td class="content" id="claim_11"><business:ClaimText>3.根据权利要求2所述的呼吸运动校正方法，其特征在于，所述根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_12"><business:ClaimText>从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_13"><business:ClaimText>从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_14"><business:ClaimText>将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_15"><business:ClaimText>将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</business:ClaimText></td></tr><tr><td class="content" id="claim_16"><business:ClaimText>4.根据权利要求2所述的呼吸运动校正方法，其特征在于，所述获取第二呼气形变场集合和第二吸气形变场集合具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_17"><business:ClaimText>从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_18"><business:ClaimText>通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；</business:ClaimText></td></tr><tr><td class="content" id="claim_19"><business:ClaimText>分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；</business:ClaimText></td></tr><tr><td class="content" id="claim_20"><business:ClaimText>将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</business:ClaimText></td></tr><tr><td class="content" id="claim_21"><business:ClaimText>5.根据权利要求1所述的呼吸运动校正方法，其特征在于，所述根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_22"><business:ClaimText>根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱；</business:ClaimText></td></tr><tr><td class="content" id="claim_23"><business:ClaimText>获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息；</business:ClaimText></td></tr><tr><td class="content" id="claim_24"><business:ClaimText>根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场；</business:ClaimText></td></tr><tr><td class="content" id="claim_25"><business:ClaimText>根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</business:ClaimText></td></tr><tr><td class="content" id="claim_26"><business:ClaimText>6.根据权利要求5所述的呼吸运动校正方法，其特征在于，所述根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_27"><business:ClaimText>从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_28"><business:ClaimText>从所述呼气末图像集合和吸气末图像集合中选择匹配的一对目标呼气末图像和目标吸气末图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_29"><business:ClaimText>将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_30"><business:ClaimText>将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_31"><business:ClaimText>根据所述第一呼气形变场集合获取配准后呼气图像，以及根据所述第一吸气形变场集合获取配准后吸气图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_32"><business:ClaimText>根据所述配准后呼气图像获取呼气末状态图谱，以及根据所述配准后吸气图像获取吸气末状态图谱。</business:ClaimText></td></tr><tr><td class="content" id="claim_33"><business:ClaimText>7.根据权利要求1至6任一项所述的呼吸运动校正方法，其特征在于，所述通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_34"><business:ClaimText>从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_35"><business:ClaimText>从所述当前呼气图像中呼吸器官所在区域内提取第一预设区域，并从所述当前呼气模拟图像中呼吸器官所在区域内对应于所述第一预设区域的位置提取第二预设区域；</business:ClaimText></td></tr><tr><td class="content" id="claim_36"><business:ClaimText>根据所述第一预设区域和所述第二预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至所述呼气模拟图像集合中各个呼气模拟图像选择完毕；</business:ClaimText></td></tr><tr><td class="content" id="claim_37"><business:ClaimText>以及，从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_38"><business:ClaimText>从所述当前吸气图像中呼吸器官所在区域内提取第三预设区域，并从所述当前吸气模拟图像中呼吸器官所在区域内对应于所述第三预设区域的位置提取第四预设区域；</business:ClaimText></td></tr><tr><td class="content" id="claim_39"><business:ClaimText>根据所述第三预设区域和所述第四预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像的步骤，直至所述吸气模拟图像集合中各个吸气模拟图像选择完毕，得到训练后卷积神经网络。</business:ClaimText></td></tr><tr><td class="content" id="claim_40"><business:ClaimText>8.根据权利要求1至6任一项所述的呼吸运动校正方法，其特征在于，所述获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正具体包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_41"><business:ClaimText>获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；</business:ClaimText></td></tr><tr><td class="content" id="claim_42"><business:ClaimText>通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；</business:ClaimText></td></tr><tr><td class="content" id="claim_43"><business:ClaimText>将所述多个形变场进行重建，得到所述待校正图像的预测形变场；</business:ClaimText></td></tr><tr><td class="content" id="claim_44"><business:ClaimText>根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</business:ClaimText></td></tr><tr><td class="content" id="claim_45"><business:ClaimText>9.一种呼吸运动校正装置，其特征在于，所述呼吸运动校正装置包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_46"><business:ClaimText>形变场获取模块，用于获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_47"><business:ClaimText>图像获取模块，用于根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；</business:ClaimText></td></tr><tr><td class="content" id="claim_48"><business:ClaimText>训练模块，用于通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；</business:ClaimText></td></tr><tr><td class="content" id="claim_49"><business:ClaimText>校正模块，用于获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</business:ClaimText></td></tr><tr><td class="content" id="claim_50"><business:ClaimText>10.一种计算机设备，包括存储器和处理器，其特征在于，所述存储器存储有计算机程序，所述计算机程序被所述处理器执行时，使得所述处理器执行如权利要求1至8任一项所述的呼吸运动校正方法中的步骤。</business:ClaimText></td></tr><tr><td class="content" id="claim_51"><business:ClaimText>11.一种存储介质，其特征在于，所述存储介质存储有多条指令，所述指令适于处理器进行加载，以执行权利要求1至8任一项所述的呼吸运动校正方法中的步骤。</business:ClaimText></td></tr></table></div><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table style="table-layout:fixed"><tr><td id="description_title" class="header">
						说明书
					</td></tr><tr><td class="content" id="description_invention_title">呼吸运动校正方法、装置、计算机设备和存储介质</td></tr><tr><td class="content" id="description_1">技术领域</td></tr><tr><td class="content" id="description_2">本发明涉及医疗技术领域，尤其涉及一种呼吸运动校正方法、装置、计算机设备和存储介质。</td></tr><tr><td class="content" id="description_3">背景技术</td></tr><tr><td class="content" id="description_4">术前肝脏图像与术后肝脏图像的比对，是肝癌手术术后评估中验证治疗精确程度的重要手段。由于对术前肝脏图像和术后肝脏图像进行采集时，无法保证病人处于相同的呼吸节点，肝脏受呼吸影响产生滑动形变，因此得到的术前肝脏图像和术后肝脏图像之间存在呼吸运动形变。为了校正肝脏呼吸形变，必须将术前肝脏图像和术后肝脏图像进行配准，即对术后肝脏图像中的肝脏呼吸运动进行校正。</td></tr><tr><td class="content" id="description_5">现有技术中，在对术后肝脏图像中的肝脏呼吸运动进行校正的过程中，第一类方法是将肝脏组织内实际发生的非刚性形变视为刚性形变，通过限制像素点位移量大小来实现不可压缩配准。例如，将不可压缩区域内像素点位移量限制在一个常量之内，或者先将图像中的不可压缩组织分割出来，并对整幅图像进行刚性配准，然后单独地对肝脏组织进行多分辨率的弹性配准，其中各像素点位移量限制在一个与当前分辨率相关的常量内，将弹性配准得到的形变场与刚性配准得到的形变场相结合得到最终形变场。由于肝脏属于柔性组织，受呼吸影响产生非刚性运动，因此该方法对肝脏呼吸运动校正的准确性非常低。</td></tr><tr><td class="content" id="description_6">第二类方法是通过获得散度为0的无源场，将此无源场作为形变场作用于肝脏图像后保持体积不变，实现不可压缩配准。例如，引入形变场散度为0的限制条件，利用无散的径向基函数插值求得肝脏组织区域内各像素点的位移量，最终得到的该形变场即是一个散度为0的场，可在配准的过程中保证不可压缩性。该方法在肝脏图像形变较大的时候，不可压缩限制条件效果减弱，使得配准求得的形变场散度大于0，导致不可压缩性下降；且无源场只具备旋转分量，当术前肝脏图像与术后肝脏图像中出现较大的滑动形变时，只利用无源场进行形变则导致配准精度下降，大大降低了对肝脏呼吸运动校正的准确性。</td></tr><tr><td class="content" id="description_7">发明内容</td></tr><tr><td class="content" id="description_8">本发明的主要目的在于解决现有技术中对呼吸运动进行校正的精准性较低的技术问题，旨在提高对呼吸运动进行校正的精准性。</td></tr><tr><td class="content" id="description_9">为实现上述目的，本发明提供一种呼吸运动校正方法，所述呼吸运动校正方法包括：</td></tr><tr><td class="content" id="description_10">获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；</td></tr><tr><td class="content" id="description_11">根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；</td></tr><tr><td class="content" id="description_12">通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；</td></tr><tr><td class="content" id="description_13">获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_14">优选地，所述根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合具体包括：</td></tr><tr><td class="content" id="description_15">根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合；</td></tr><tr><td class="content" id="description_16">获取第二呼气形变场集合和第二吸气形变场集合；</td></tr><tr><td class="content" id="description_17">将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合；</td></tr><tr><td class="content" id="description_18">将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</td></tr><tr><td class="content" id="description_19">优选地，所述根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合具体包括：</td></tr><tr><td class="content" id="description_20">从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</td></tr><tr><td class="content" id="description_21">从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；</td></tr><tr><td class="content" id="description_22">将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</td></tr><tr><td class="content" id="description_23">将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</td></tr><tr><td class="content" id="description_24">优选地，所述获取第二呼气形变场集合和第二吸气形变场集合具体包括：</td></tr><tr><td class="content" id="description_25">从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；</td></tr><tr><td class="content" id="description_26">通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；</td></tr><tr><td class="content" id="description_27">分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；</td></tr><tr><td class="content" id="description_28">将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_29">优选地，所述根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合具体包括：</td></tr><tr><td class="content" id="description_30">根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱；</td></tr><tr><td class="content" id="description_31">获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息；</td></tr><tr><td class="content" id="description_32">根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场；</td></tr><tr><td class="content" id="description_33">根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_34">优选地，所述根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱具体包括：</td></tr><tr><td class="content" id="description_35">从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</td></tr><tr><td class="content" id="description_36">从所述呼气末图像集合和吸气末图像集合中选择匹配的一对目标呼气末图像和目标吸气末图像；</td></tr><tr><td class="content" id="description_37">将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</td></tr><tr><td class="content" id="description_38">将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合；</td></tr><tr><td class="content" id="description_39">根据所述第一呼气形变场集合获取配准后呼气图像，以及根据所述第一吸气形变场集合获取配准后吸气图像；</td></tr><tr><td class="content" id="description_40">根据所述配准后呼气图像获取呼气末状态图谱，以及根据所述配准后吸气图像获取吸气末状态图谱。</td></tr><tr><td class="content" id="description_41">优选地，所述通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络具体包括：</td></tr><tr><td class="content" id="description_42">从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像；</td></tr><tr><td class="content" id="description_43">从所述当前呼气图像中呼吸器官所在区域内提取第一预设区域，并从所述当前呼气模拟图像中呼吸器官所在区域内对应于所述第一预设区域的位置提取第二预设区域；</td></tr><tr><td class="content" id="description_44">根据所述第一预设区域和所述第二预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至所述呼气模拟图像集合中各个呼气模拟图像选择完毕；</td></tr><tr><td class="content" id="description_45">以及，从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像；</td></tr><tr><td class="content" id="description_46">从所述当前吸气图像中呼吸器官所在区域内提取第三预设区域，并从所述当前吸气模拟图像中呼吸器官所在区域内对应于所述第三预设区域的位置提取第四预设区域；</td></tr><tr><td class="content" id="description_47">根据所述第三预设区域和所述第四预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像的步骤，直至所述吸气模拟图像集合中各个吸气模拟图像选择完毕，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_48">优选地，所述获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正具体包括：</td></tr><tr><td class="content" id="description_49">获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；</td></tr><tr><td class="content" id="description_50">通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；</td></tr><tr><td class="content" id="description_51">将所述多个形变场进行重建，得到所述待校正图像的预测形变场；</td></tr><tr><td class="content" id="description_52">根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_53">为实现上述目的，本发明另提供一种呼吸运动校正装置，所述呼吸运动校正装置包括：</td></tr><tr><td class="content" id="description_54">形变场获取模块，用于获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；</td></tr><tr><td class="content" id="description_55">图像获取模块，用于根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；</td></tr><tr><td class="content" id="description_56">训练模块，用于通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；</td></tr><tr><td class="content" id="description_57">校正模块，用于获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_58">优选地，所述形变场获取模块包括：</td></tr><tr><td class="content" id="description_59">第一获取单元，用于根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合；</td></tr><tr><td class="content" id="description_60">第二获取单元，用于获取第二呼气形变场集合和第二吸气形变场集合；</td></tr><tr><td class="content" id="description_61">第一复合单元，用于将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合；</td></tr><tr><td class="content" id="description_62">第二复合单元，用于将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</td></tr><tr><td class="content" id="description_63">优选地，所述第一获取单元，具体用于从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</td></tr><tr><td class="content" id="description_64">从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；</td></tr><tr><td class="content" id="description_65">将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</td></tr><tr><td class="content" id="description_66">将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</td></tr><tr><td class="content" id="description_67">优选地，所述第二获取单元，具体用于从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；</td></tr><tr><td class="content" id="description_68">通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；</td></tr><tr><td class="content" id="description_69">分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；</td></tr><tr><td class="content" id="description_70">将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_71">优选地，所述图像获取模块包括：</td></tr><tr><td class="content" id="description_72">图谱获取单元，用于根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱；</td></tr><tr><td class="content" id="description_73">信息获取单元，用于获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息；</td></tr><tr><td class="content" id="description_74">配准单元，用于根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场；</td></tr><tr><td class="content" id="description_75">图像获取单元，用于根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_76">优选地，所述图谱获取单元，具体用于从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</td></tr><tr><td class="content" id="description_77">从所述呼气末图像集合和吸气末图像集合中选择匹配的一对目标呼气末图像和目标吸气末图像；</td></tr><tr><td class="content" id="description_78">将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</td></tr><tr><td class="content" id="description_79">将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合；</td></tr><tr><td class="content" id="description_80">根据所述第一呼气形变场集合获取配准后呼气图像，以及根据所述第一吸气形变场集合获取配准后吸气图像；</td></tr><tr><td class="content" id="description_81">根据所述配准后呼气图像获取呼气末状态图谱，以及根据所述配准后吸气图像获取吸气末状态图谱。</td></tr><tr><td class="content" id="description_82">优选地，所述训练模块，具体用于从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像；</td></tr><tr><td class="content" id="description_83">从所述当前呼气图像中呼吸器官所在区域内提取第一预设区域，并从所述当前呼气模拟图像中呼吸器官所在区域内对应于所述第一预设区域的位置提取第二预设区域；</td></tr><tr><td class="content" id="description_84">根据所述第一预设区域和所述第二预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至所述呼气模拟图像集合中各个呼气模拟图像选择完毕；</td></tr><tr><td class="content" id="description_85">以及，从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像；</td></tr><tr><td class="content" id="description_86">从所述当前吸气图像中呼吸器官所在区域内提取第三预设区域，并从所述当前吸气模拟图像中呼吸器官所在区域内对应于所述第三预设区域的位置提取第四预设区域；</td></tr><tr><td class="content" id="description_87">根据所述第三预设区域和所述第四预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像的步骤，直至所述吸气模拟图像集合中各个吸气模拟图像选择完毕，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_88">优选地，所述校正模块，具体用于获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；</td></tr><tr><td class="content" id="description_89">通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；</td></tr><tr><td class="content" id="description_90">将所述多个形变场进行重建，得到所述待校正图像的预测形变场；</td></tr><tr><td class="content" id="description_91">根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_92">一种计算机设备，包括存储器和处理器，所述存储器存储有计算机程序，所述计算机程序被所述处理器执行时，使得所述处理器执行上述呼吸运动校正方法中的步骤。</td></tr><tr><td class="content" id="description_93">一种存储介质，所述存储介质存储有多条指令，所述指令适于处理器进行加载，以执行上述呼吸运动校正方法中的步骤。</td></tr><tr><td class="content" id="description_94">本发明提供的呼吸运动校正方法、装置、计算机设备和存储介质，通过获取多组包含呼吸器官的样本图像，根据多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；然后，根据复合呼气形变场集合获取呼气模拟图像集合，以及根据复合吸气形变场集合获取吸气模拟图像集合；其次，通过多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；最后，可以获取待校正图像，利用训练后卷积神经网络对待校正图像中呼吸器官的呼吸运动进行校正。实现了根据复合呼气形变场集合获取呼气模拟图像集合，以及根据复合吸气形变场集合获取吸气模拟图像集合，来对预设的卷积神经网络进行训练，从而可以利用训练后卷积神经网络校对校正图像中呼吸器官的呼吸运动进行校正，提高了对呼吸运动进行校正的精准性及效率。</td></tr><tr><td class="content" id="description_95">附图说明</td></tr><tr><td class="content" id="description_96">图1为本发明的呼吸运动校正方法第一实施例的流程示意图；</td></tr><tr><td class="content" id="description_97">图2为本发明中呼气图像和吸气图像的示意图；</td></tr><tr><td class="content" id="description_98">图3为本发明中获取复合呼气形变场集合和复合吸气形变场集合的流程示意图；</td></tr><tr><td class="content" id="description_99">图4为图3中步骤S201的具体细化流程示意图；</td></tr><tr><td class="content" id="description_100">图5为图3中步骤S202的具体细化流程示意图；</td></tr><tr><td class="content" id="description_101">图6为本发明中获取呼气模拟图像集合和吸气模拟图像集合的流程示意图；</td></tr><tr><td class="content" id="description_102">图7为本发明中对预设的卷积神经网络进行训练的示意图；</td></tr><tr><td class="content" id="description_103">图8为本发明中利用训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正的流程示意图；</td></tr><tr><td class="content" id="description_104">图9为本发明的呼吸运动校正装置第一实施例的功能模块示意图；</td></tr><tr><td class="content" id="description_105">图10为图9中所述形变场获取模块的具体细化功能模块示意图；</td></tr><tr><td class="content" id="description_106">图11为图9中所述图像获取模块的具体细化功能模块示意图。</td></tr><tr><td class="content" id="description_107">本发明目的的实现、功能特点及优点将结合实施例，参照附图做进一步说明。</td></tr><tr><td class="content" id="description_108">具体实施方式</td></tr><tr><td class="content" id="description_109">应当理解，此处所描述的优选实施例仅用于说明和解释本发明，并不用于限定本发明。</td></tr><tr><td class="content" id="description_110">本发明提出一种呼吸运动校正方法第一实施例，参见图1，图1为本发明的呼吸运动校正方法第一实施例的流程示意图。如图1所示，在本第一实施例中所述呼吸运动校正方法包括以下步骤：</td></tr><tr><td class="content" id="description_111">步骤S10：获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合。</td></tr><tr><td class="content" id="description_112">其中，呼吸器官可以包括肝脏或肺部等器官，以下将以呼吸器官为肝脏为例进行详细说明，例如，呼吸运动校正方法可以应用于肝癌手术术后评估，可以将术前图像和术后肝脏图像进行比对以验证治疗精确程度等。</td></tr><tr><td class="content" id="description_113">样本图像可以是包含肝脏的影像，每组样本图像中可以包括多张图像，其中，一组样本图像可以包括一个人在一个呼吸周期内的三维影像，该三维影像加上各个图像中呼吸节点对应的标识，可以得到四维数据组，多组(即N组)样本图像即为多个人(即N个人，N的取值可以根据实际需要进行灵活设置)在整个呼吸周期的三维影像，还可以加上呼吸节点对应的标识，该标识可以是时间或编号等。</td></tr><tr><td class="content" id="description_114">参见图2，图2中为一组样本图像的示意图，即为一个人在在整个呼吸周期的呼吸过程，包括呼气图像和吸气图像，该呼气图像包括在T<base:Sub>50</base:Sub>时刻对应的呼气末图像和在T<base:Sub>60</base:Sub>、T<base:Sub>70</base:Sub>、T<base:Sub>80</base:Sub>和T<base:Sub>90</base:Sub>时刻对应的呼气节点图像、该吸气图像包括在T<base:Sub>00</base:Sub>时刻对应的吸气末图像和在T<base:Sub>10</base:Sub>、T<base:Sub>20</base:Sub>、T<base:Sub>30</base:Sub>和T<base:Sub>40</base:Sub>时刻对应的吸气节点图像。</td></tr><tr><td class="content" id="description_115">参见图3，图3为本发明中获取复合呼气形变场集合和复合吸气形变场集合的流程示意图。所述根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合具体包括：</td></tr><tr><td class="content" id="description_116">步骤S201：根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合。</td></tr><tr><td class="content" id="description_117">参见图4，图4为图3中步骤S201的具体细化流程示意图。所述步骤S201具体包括：</td></tr><tr><td class="content" id="description_118">步骤S301：从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</td></tr><tr><td class="content" id="description_119">步骤S302：从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；</td></tr><tr><td class="content" id="description_120">步骤S303：将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</td></tr><tr><td class="content" id="description_121">步骤S304：将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</td></tr><tr><td class="content" id="description_122">在多组样本图像(例如包括N组三维影像和对应的时间)中，提取出各组对应的呼气末图像，得到呼气末图像集合，以及从多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；然后从呼气末图像集合和吸气末图像集合中，任意选择一对匹配的吸气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513646&amp;blobId=3526017821" width="59"/>(即目标吸气末图像)和呼气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513416&amp;blobId=3526056651" width="299"/>(即目标呼气末图像)，即该目标吸气末图像和目标呼气末图像为同一个人在整个呼吸周期内的同一组图像。</td></tr><tr><td class="content" id="description_123">此时，可以将吸气末图像集合中除目标呼气末图像之外的其它组吸气末图像向目标吸气末图像配准，得到第一吸气形变场集合，即得到各组样本图像中吸气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513662&amp;blobId=3526193993" width="361"/>以及将呼气末图像集合中除目标呼气末图像之外的其他呼气末图像，向目标呼气末图像配准，得到第一呼气形变场集合，即得到各组组样本图像中呼气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514429&amp;blobId=3525848142" width="365"/></td></tr><tr><td class="content" id="description_124">其中，配准是指将其它组的吸气末图像向选定的那一组的吸气末图像配准，配准后获得它们之间的形变场，利用该形变场可以将其它组的吸气末图像形变到选定的那一组吸气末图像所在的空间。同理，对于呼气末图像也一样，可以将其它组的呼气末图像向选定的那一组的呼气末图像配准，配准后获得它们之间的形变场，利用该形变场可以将其它组的呼气末图像形变到选定的那一组呼气末图像所在的空间。</td></tr><tr><td class="content" id="description_125">步骤S202：获取第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_126">参见图5，图5为图3中步骤S202的具体细化流程示意图。所述步骤S202具体包括：</td></tr><tr><td class="content" id="description_127">步骤S401：从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；</td></tr><tr><td class="content" id="description_128">步骤S402：通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；</td></tr><tr><td class="content" id="description_129">步骤S403：分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；</td></tr><tr><td class="content" id="description_130">步骤S404：将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_131">对于每组样本图像，需要将吸气节点图像向吸气末图像配准，以及将呼气节点图像向呼气末图像配准，且保持肝脏不可压缩，其中，吸气节点图像为处于吸气节点的图像，呼气节点图像为处于呼气节点的图像，吸气末图像为处于吸气末端的图像，呼气末图像为处于呼气末端的图像。</td></tr><tr><td class="content" id="description_132">具体地，可以从多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；通过预设的不可压缩配准的能量函数计算呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算吸气节点图像与对应的吸气末图像之间的吸气速度场，该呼气速度场和吸气速度场均可以包括待估计的速度场、中间速度场及更新场等。其中，预设的不可压缩配准的能量函数如下：</td></tr><tr><td class="content" id="description_133"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513847&amp;blobId=3526023081" width="492"/></td></tr><tr><td class="content" id="description_134">其中，R为吸气末图像或呼气末图像，M为处于其他呼吸节点的呼气节点图像或吸气节点图像，σ<base:Sub>i</base:Sub>，σ<base:Sub>x</base:Sub>和σ<base:Sub>d</base:Sub>为权重因子，v和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514079&amp;blobId=3526139252" width="31"/>分别为待估计的速度场与中间速度场。且v和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513721&amp;blobId=3526117069" width="34"/>满足以下公式：</td></tr><tr><td class="content" id="description_135"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513901&amp;blobId=3526020623" width="492"/></td></tr><tr><td class="content" id="description_136">其中δv为更新速度场，将公式(2)代入能量函数，通过优化能量函数，获得形变场的更新场，其公式如下：</td></tr><tr><td class="content" id="description_137"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513271&amp;blobId=3525884386" width="492"/></td></tr><tr><td class="content" id="description_138">将求得的δv代入公式(2)，求得<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513930&amp;blobId=3526126636" width="51"/></td></tr><tr><td class="content" id="description_139">此时，可以分别对呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除无旋场，利用调和场和预设的平移场补偿去除的无旋场，得到补偿后速度场。例如对于指定不可压缩区域的呼气速度场和吸气速度场，即肝脏区域Ω<base:Sub>I</base:Sub>，利用霍奇-亥姆霍兹分解定理，将该区域的速度场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513302&amp;blobId=3526122892" width="179"/>进行分解，获得对应的无源场f<base:Sub>D</base:Sub>、无旋场f<base:Sub>C</base:Sub>和调和场f<base:Sub>H</base:Sub>，其公式如下：</td></tr><tr><td class="content" id="description_140"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513459&amp;blobId=3525916839" width="492"/></td></tr><tr><td class="content" id="description_141">无源场、无旋场和调和场的公式如下：</td></tr><tr><td class="content" id="description_142"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514040&amp;blobId=3526050299" width="492"/></td></tr><tr><td class="content" id="description_143"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513446&amp;blobId=3525880167" width="492"/></td></tr><tr><td class="content" id="description_144"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513375&amp;blobId=3525936485" width="492"/></td></tr><tr><td class="content" id="description_145"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513822&amp;blobId=3525889756" width="492"/></td></tr><tr><td class="content" id="description_146"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514344&amp;blobId=3526130313" width="492"/></td></tr><tr><td class="content" id="description_147">其中公式(6)和(8)为泊松方程，通过求解，可以获得无源场f<base:Sub>D</base:Sub>、无旋场f<base:Sub>C</base:Sub>和调和场f<base:Sub>H</base:Sub>。</td></tr><tr><td class="content" id="description_148">然后为了保证速度场的散度为零，去除速度场中的有源分量，即删除无旋场。同时，利用调和场和平移场(该平移场是在x、y或z轴向移动的刚性形变场)分别补偿去除的有源分量中的非线性和线性部分，得到补偿后速度场。补偿后速度场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513477&amp;blobId=3526191299" width="182"/>公式如下：</td></tr><tr><td class="content" id="description_149"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513293&amp;blobId=3525981869" width="492"/></td></tr><tr><td class="content" id="description_150">其中<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513581&amp;blobId=3526033371" width="60"/>为调和场的权重，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514213&amp;blobId=3525901760" width="44"/>为平移场，可以利用线性最小二乘法求解<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513633&amp;blobId=3525850834" width="51"/>及<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514225&amp;blobId=3526126730" width="72"/>根据求解的<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513781&amp;blobId=3525963152" width="48"/>及<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513747&amp;blobId=3526107999" width="67"/>每次迭代的速度场为：</td></tr><tr><td class="content" id="description_151"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514535&amp;blobId=3526208381" width="492"/></td></tr><tr><td class="content" id="description_152">将补偿后速度场输入能量函数进行下一次迭代，直到能量函数收敛，即通过不可压缩配准的能量函数计算各组对应的呼气节点图像与对应的呼气末图像之间的呼气速度场，对呼气速度场进行分解，得到呼气速度场对应的无源场、无旋场和调和场，并去除无旋场，利用调和场和预设的平移场补偿去除的无旋场，得到呼气速度场对应的补偿后速度场；将该补偿后速度场输入能量函数进行下一次迭代，直到能量函数收敛，得到第二呼气形变场集合。以及通过不可压缩配准的能量函数计算各组对应的吸气节点图像与对应的吸气末图像之间的吸气速度场，对吸气速度场进行分解，得到吸气速度场对应的无源场、无旋场和调和场，并去除无旋场，利用调和场和预设的平移场补偿去除的无旋场，得到吸气速度场对应的补偿后速度场；将该补偿后速度场输入能量函数进行下一次迭代，直到能量函数收敛，得到第二吸气形变场集合。</td></tr><tr><td class="content" id="description_153">例如，将更新后的<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514529&amp;blobId=3525869672" width="32"/>作为下一次迭代的v，从而求解新的能量函数，通过不断重复，最终直到能量函数收敛，求得最优的形变场，即第二呼气形变场集合ES和第二吸气形变场集合IS。</td></tr><tr><td class="content" id="description_154">步骤S203：将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合。</td></tr><tr><td class="content" id="description_155">步骤S204：将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</td></tr><tr><td class="content" id="description_156">将第二呼气形变场集合ES和第一呼气形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513879&amp;blobId=3526065326" width="343"/>中各个时刻对应的形变场分别进行复合，得到复合呼气形变场集合RMES；以及将第二吸气形变场集合IS和第一吸气形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514578&amp;blobId=3525993970" width="336"/>中各个时刻对应的形变场分别进行复合，得到复合吸气形变场集合RMIS，其中，吸气末状态图谱A<base:Sup>I</base:Sup>、呼气末状态图谱A<base:Sup>E</base:Sup>、复合呼气形变场集合RMES和复合吸气形变场集合RMIS可以组成呼吸运动模型。</td></tr><tr><td class="content" id="description_157">步骤S20：根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_158">参见图6，图6为本发明中获取呼气模拟图像集合和吸气模拟图像集合的流程示意图。所述根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合具体包括：</td></tr><tr><td class="content" id="description_159">步骤S501：根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱。</td></tr><tr><td class="content" id="description_160">优选地，所述根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱具体包括：</td></tr><tr><td class="content" id="description_161">从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；</td></tr><tr><td class="content" id="description_162">从所述呼气末图像集合和吸气末图像集合中选择匹配的一对目标呼气末图像和目标吸气末图像；</td></tr><tr><td class="content" id="description_163">将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；</td></tr><tr><td class="content" id="description_164">将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合；</td></tr><tr><td class="content" id="description_165">根据所述第一呼气形变场集合获取配准后呼气图像，以及根据所述第一吸气形变场集合获取配准后吸气图像；</td></tr><tr><td class="content" id="description_166">根据所述配准后呼气图像获取呼气末状态图谱，以及根据所述配准后吸气图像获取吸气末状态图谱。</td></tr><tr><td class="content" id="description_167">具体地，在多组样本图像中，提取出各组对应的呼气末图像，得到呼气末图像集合，以及从多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；然后从呼气末图像集合和吸气末图像集合中，任意选择一对匹配的吸气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514600&amp;blobId=3526024829" width="53"/>(即目标吸气末图像)和呼气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514355&amp;blobId=3525949277" width="293"/>(即目标呼气末图像)，即该目标吸气末图像和目标呼气末图像为同一个人在整个呼吸周期内的同一组图像。</td></tr><tr><td class="content" id="description_168">此时，可以将吸气末图像集合中除目标呼气末图像之外的其它组吸气末图像向目标吸气末图像配准，得到第一吸气形变场集合，即得到各组样本图像中吸气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513561&amp;blobId=3526021363" width="365"/>以及将呼气末图像集合中除目标呼气末图像之外的其他呼气末图像，向目标呼气末图像配准，得到第一呼气形变场集合，即得到各组组样本图像中呼气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513873&amp;blobId=3526147268" width="363"/></td></tr><tr><td class="content" id="description_169">然后，将求得的第一呼气形变场集合中的各个呼气形变场分别作用于对应的呼气图像，获得配准后呼气图像，将配准后呼气图像的像素值进行平均，获得肝脏区域的呼气末状态图谱A<base:Sup>I</base:Sup>。以及将求得的第一吸气形变场集合中的各个吸气形变场分别作用于对应的吸气图像，获得配准后吸气图像，将配准后吸气图像的像素值进行平均，获得肝脏区域的吸气末状态图谱A<base:Sup>E</base:Sup>。</td></tr><tr><td class="content" id="description_170">步骤S502：获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息。</td></tr><tr><td class="content" id="description_171">其中，第一配准信息和第二配准信息均包括互信息、重叠率及像素距离等。</td></tr><tr><td class="content" id="description_172">步骤S503：根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场。</td></tr><tr><td class="content" id="description_173">步骤S504：根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_174">在得到呼气末状态图谱A<base:Sup>I</base:Sup>和吸气末状态图谱A<base:Sup>E</base:Sup>后，可以将呼气末状态图谱A<base:Sup>I</base:Sup>与呼气图像(即术前呼气图像)进行配准，以及将吸气末状态图谱A<base:Sup>E</base:Sup>与吸气图像术(即术前吸气图像)进行配准。以呼气末状态图谱A<base:Sup>I</base:Sup>向术前呼气图像进行配准为例，相似性测度SIM如下：</td></tr><tr><td class="content" id="description_175"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513917&amp;blobId=3526205615" width="492"/></td></tr><tr><td class="content" id="description_176">其中，SIM<base:Sub>MI</base:Sub>表示呼气末状态图谱A<base:Sup>I</base:Sup>与术前呼气图像之间的互信息，该互信息是一种衡量图像间相似性的指标；SIM<base:Sub>KS</base:Sub>表示呼气末状态图谱A<base:Sup>I</base:Sup>与术前呼气图像中肝脏分割结果之间的重叠率(即肝脏体积重叠率)；SIM<base:Sub>CP</base:Sub>表示呼气末状态图谱A<base:Sup>I</base:Sup>与术前呼气图像中膈肌对应点间的距离，即呼气末状态图谱A<base:Sup>I</base:Sup>中膈肌区域内的每个像素点(x1，y1)，与术前呼气图像中膈肌区域内的每个像素点(x2，y2)之间的距离<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513792&amp;blobId=3526030849" width="492"/>ω<base:Sub>1</base:Sub>，ω<base:Sub>2</base:Sub>和ω<base:Sub>3</base:Sub>分别为SIM<base:Sub>MI</base:Sub>、SIM<base:Sub>KS</base:Sub>、及SIM<base:Sub>CP</base:Sub>对应的权重。通过利用梯度下降法优化公式(12)，即根据SIM<base:Sub>MI</base:Sub>、SIM<base:Sub>KS</base:Sub>、及SIM<base:Sub>CP</base:Sub>等第一配准信息将呼气末状态图谱向术前呼气图像配准，可以获得形变场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513389&amp;blobId=3526226026" width="83"/>(即得到第一形变场)。同样的，可以利用公式(12)将吸气末状态图谱A<base:Sup>E</base:Sup>向术前吸气图像配准，获得形变场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513305&amp;blobId=3525967060" width="88"/>(即第二形变场)。</td></tr><tr><td class="content" id="description_177">将RMES经过<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513996&amp;blobId=3526178430" width="89"/>投影得到形变场集合EFS，然后将EFS作用于术前吸气图像，即利用EFS形变术前吸气图像，得到形变后的图像即为吸气模拟图像，从而可以获得处于吸气阶段的吸气模拟图像集合I<base:Sup>E</base:Sup>＝FoEFS。以及，将RMIS经过<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513352&amp;blobId=3526025818" width="83"/>投影得到形变场集合IFS，然后将IFS作用于术前呼气图像，即利用IFS形变术前呼气图像，得到形变后的图像即为呼气模拟图像，从而可以获得处于呼气阶段的呼气模拟图像集合I<base:Sup>I</base:Sup>＝FoIFS。吸气模拟图像集合和呼气模拟图像集合组成的模拟图像集合I＝{I<base:Sup>I</base:Sup>,I<base:Sup>E</base:Sup>}将作为卷积神经网络学习的训练样本。</td></tr><tr><td class="content" id="description_178">步骤S30：通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_179">优选地，所述通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络具体包括：</td></tr><tr><td class="content" id="description_180">从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像；</td></tr><tr><td class="content" id="description_181">从所述当前呼气图像中呼吸器官所在区域内提取第一预设区域，并从所述当前呼气模拟图像中呼吸器官所在区域内对应于所述第一预设区域的位置提取第二预设区域；</td></tr><tr><td class="content" id="description_182">根据所述第一预设区域和所述第二预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至所述呼气模拟图像集合中各个呼气模拟图像选择完毕；</td></tr><tr><td class="content" id="description_183">以及，从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像；</td></tr><tr><td class="content" id="description_184">从所述当前吸气图像中呼吸器官所在区域内提取第三预设区域，并从所述当前吸气模拟图像中呼吸器官所在区域内对应于所述第三预设区域的位置提取第四预设区域；</td></tr><tr><td class="content" id="description_185">根据所述第三预设区域和所述第四预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像的步骤，直至所述吸气模拟图像集合中各个吸气模拟图像选择完毕，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_186">从多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从呼气模拟图像集合中选择与当前呼气图像标识匹配(即相同时刻或相同编号等)的呼气模拟图像作为当前呼气模拟图像，如图7所示，然后，从当前呼气图像中呼吸器官所在区域内(即肝脏区域)提取第一预设区域，该第一预设区域可以是一个矩形的子块，该子块的形状和大小等可以根据实际需要进行灵活设置，并从当前呼气模拟图像中呼吸器官所在区域内对应于第一预设区域的位置提取第二预设区域，该第二预设区域可以是一个矩形的子块，该子块的形状和大小等可以根据实际需要进行灵活设置，该第一预设区域与第二预设区域的形状、大小及所在肝脏区域的位置一致。</td></tr><tr><td class="content" id="description_187">其中，第一预设区域与第二预设区域可以包括多组，例如，在当前呼气图像和当前呼气模拟图像中，分别以呼吸器官所在区域的原点为第一个子块的原点，得到一组第一预设区域与第二预设区域，然后逐渐平原点位置，获得其他子块，其他组的第一预设区域与第二预设区域。</td></tr><tr><td class="content" id="description_188">将每一组第一预设区域与第二预设区域分别作为预设的卷积神经网络的双通道输入，例如可以将第一预设区域作为第一通道输入，将第二预设区域作为第二通道输入，如图7所示，该卷积神经网络可以包括卷积层、激活层、联合层及反卷积层等，此时可以利用卷积神经网络的不同卷积核对输入的第一预设区域与第二预设区域执行卷积操作，使用修正线性单元(Rectified Linear Unit，ReLU)作为激活函数，或者将parametric ReLU作为激活函数，使用范数L1作为损失函数，可以输出x、y、z三个方向上的形变场，对应金标准(金标准是指用不可压缩算法求得的形变场)为子块区域的形变场。然后对卷积神经网络进行训练，返回执行从多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从呼气模拟图像集合中选择与当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至呼气模拟图像集合中各个呼气模拟图像选择完毕，通过小批量梯度下降优化算法，调整卷积神经网络的权重及偏差等网络参数，实现损失函数的最小化。</td></tr><tr><td class="content" id="description_189">同样的，对于吸气模拟图像集合和多组样本图像中吸气图像按照上述方法对卷积神经网络进行训练，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_190">步骤S40：获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_191">参见图8，图8为本发明中利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正的流程示意图。所述获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正具体包括：</td></tr><tr><td class="content" id="description_192">步骤S601：获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；</td></tr><tr><td class="content" id="description_193">步骤S602：通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；</td></tr><tr><td class="content" id="description_194">步骤S603：将所述多个形变场进行重建，得到所述待校正图像的预测形变场；</td></tr><tr><td class="content" id="description_195">步骤S604：根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_196">其中，待校正图像可以是术后呼气图像或术后吸气图像，将术后呼气图像或术后吸气图像统称为术后图像。对于术后图像(即待校正图像)，从术后图像中呼吸器官(即肝脏)所在区域内提取出多个子块，以及从术前图像中呼吸器官所在区域内的对应位置提取出多个子块，将这些子块分别输入训练后卷积神经网络，通过训练后卷积神经网络进行预测，即计算多个子块对应的形变场，得到多个形变场，将多个形变场进行重建，例如把所有子块的形变场重叠的部分进行平均，没有重叠的部分进行插值，从而获得术后图像的预测形变场，使得子块区域的稀疏形变场，通过重建获得整幅图像的稠密形变场。然后将该预测形变场作用于术后图像，获得术前图像与术后图像之间的配准结果，实现了对术后图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_197">本实施例为了校正肝脏呼吸形变，可以将术前肝脏图像和术后肝脏图像进行配准。而由于肝脏组织细胞含水量很高，在形变的过程中可以被视为不可压缩组织，即保持自身体积不变，因此在配准的过程中需考虑保证肝脏不可压缩。通过考虑肝脏组织的不可压缩特性，在求解肝脏呼吸运动过程中，保持肝脏不可压缩，使得配准后的肝脏体积未发生变化，从而可以不精确求解肝脏呼吸运动，大大较小了运动误差，提高了手术术后的评估精度，另外，通过卷积神经网络进行计算，可以快速校正术后肝脏图像中肝脏的呼吸运动，消耗时间较短，提高了校正的效率。</td></tr><tr><td class="content" id="description_198">以下以举例的方式本对本发明所提供的呼吸运动校正方法中各个步骤进行详细说明，该方法通过将多组样本图像进行不可压缩配准构建呼吸模型，其中在不可压缩配准中利用调和场对无旋场进行补偿，利用呼吸模型作用于样本图像以丰富训练样本，在此基础上，利用深度学习的卷积神经网络，建立样本图像表观与形变场的对应关系，对于输入的样本图像，实现快速的不可压缩配准融合。具体可以包括以下步骤：</td></tr><tr><td class="content" id="description_199">一：在训练阶段：</td></tr><tr><td class="content" id="description_200">第一步：构建呼吸状态图谱。对于多组样本图像，将其中的呼气末图像与吸气末图像，分别利用组群配准算法求解呼气末状态图谱和吸气末状态图谱(呼气末状态图谱和吸气末状态图谱组成呼吸状态图谱)，以及各个呼吸状态图谱到各个呼吸状态图像的形变场集合。例如，将多组样本图像中其它组的吸气末图像和呼气末图像，分别向其中一组的吸气末图像和呼气末图像配准，将配准后的图像像素值进行平均，获得肝脏吸气末状态图谱和呼气末状态图谱。</td></tr><tr><td class="content" id="description_201">第二步：执行不可压缩配准。对于每组样本图像，采用基于滑动补偿的不可压缩配准算法，将吸气节点图像与呼气节点图像分别向吸气末图像和呼气末图像配准，求得对应的吸气形变场集合和呼气形变场集合。在不可压缩配准的过程中，实时对滑动形变进行补偿，实现不可压缩形变场快速精确的求解。</td></tr><tr><td class="content" id="description_202">第三步：构建呼吸运动模型。将第一步与第二步求得的对应形变场(包括吸气形变场和呼气形变场)分别进行复合，复合后的形变场集合(包括复合吸气形变场集合和复合呼气形变场集合)与呼吸状态图谱构成呼吸运动模型。</td></tr><tr><td class="content" id="description_203">第四步：应用呼吸运动模型。通过不同主体间配准算法将呼吸状态图谱向术前图像配准，并获得形变场，将该形变场通过第三步复合后的形变场投影到术前图像空间。投影后的形变场直接作用于术前图像，从而获得模拟的处于不同呼吸节点的图像(包括呼气模拟图像集合及吸气模拟图像集合)。通过构建呼吸运动模型，获得了肝脏呼吸运动规律，将其作用于术前图像，可以获得更加真实的模拟图像。</td></tr><tr><td class="content" id="description_204">第五步：基于深度学习的呼吸运动预测。将利用第四步求得的模拟图像与对应的形变场，对卷积神经网络进行训练。在术前图像与模拟图像的对应位置上提取子块，将它们作为卷积神经网络的双通道输入，而它们对应的形变场则作为金标准，从而可以得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_205">二：在测试阶段：</td></tr><tr><td class="content" id="description_206">对于输入的术后图像和术前图像，分别提取子块，并将提取到的子块输入训练后卷积神经网络，获得预测形变场，将该预测形变场进行重建，获得图像的形变场，将该形变场作用于术后图像，实现了呼吸的补偿，得到最终的配准结果。利用卷积神经网络对呼吸运动预测，减少了不可压缩配准算法所消耗的时间，快速的求解术后图像和术前图像中肝脏间的呼吸运动。</td></tr><tr><td class="content" id="description_207">上述实施例所提供的呼吸运动校正方法，通过获取多组包含呼吸器官的样本图像，根据多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；然后，根据复合呼气形变场集合获取呼气模拟图像集合，以及根据复合吸气形变场集合获取吸气模拟图像集合；其次，通过多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；最后，可以获取待校正图像，利用训练后卷积神经网络对待校正图像中呼吸器官的呼吸运动进行校正。实现了根据复合呼气形变场集合获取呼气模拟图像集合，以及根据复合吸气形变场集合获取吸气模拟图像集合，对预设的卷积神经网络进行训练，从而可以利用训练后卷积神经网络校对校正图像中呼吸器官的呼吸运动进行校正，提高了对呼吸运动进行校正的精准性及效率。</td></tr><tr><td class="content" id="description_208">本发明提供一种呼吸运动校正装置第一实施例，参见图9，图9为本发明的呼吸运动校正装置第一实施例的功能模块示意图。在第一实施例中，所述呼吸运动校正装置100包括：形变场获取模块110、图像获取模块120、训练模块130和校正模块140等。其中，形变场获取模块110，用于获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；图像获取模块120，用于根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；训练模块130，用于通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；校正模块140，用于获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_209">其中，呼吸器官可以包括肝脏或肺部等器官，以下将以呼吸器官为肝脏为例进行详细说明。样本图像可以是包含肝脏的影像，每组样本图像中可以包括多张图像，其中，一组样本图像可以包括一个人在一个呼吸周期内的三维影像，该三维影像加上各个图像中呼吸节点对应的标识，可以得到四维数据组，多组(即N组)样本图像即为多个人(即N个人，N的取值可以根据实际需要进行灵活设置)在整个呼吸周期的三维影像，还可以加上呼吸节点对应的标识，该标识可以是时间或编号等。</td></tr><tr><td class="content" id="description_210">参见图2，图2中为一组样本图像的示意图，即为一个人在在整个呼吸周期的呼吸过程，包括呼气图像和吸气图像，该呼气图像包括在T<base:Sub>50</base:Sub>时刻对应的呼气末图像和在T<base:Sub>60</base:Sub>、T<base:Sub>70</base:Sub>、T<base:Sub>80</base:Sub>和T<base:Sub>90</base:Sub>时刻对应的呼气节点图像、该吸气图像包括在T<base:Sub>00</base:Sub>时刻对应的吸气末图像和在T<base:Sub>10</base:Sub>、T<base:Sub>20</base:Sub>、T<base:Sub>30</base:Sub>和T<base:Sub>40</base:Sub>时刻对应的吸气节点图像。</td></tr><tr><td class="content" id="description_211">参见图10，图10为图9中所述形变场获取模块110的具体细化功能模块示意图。上述第一实施例中所述形变场获取模块110包括：第一获取单元111、第二获取单元112、第一复合单元113和第二复合单元114。其中，第一获取单元111，用于根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合；第二获取单元112，用于获取第二呼气形变场集合和第二吸气形变场集合；第一复合单元113，用于将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合；第二复合单元114，用于将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</td></tr><tr><td class="content" id="description_212">优选地，所述第一获取单元111，具体用于从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</td></tr><tr><td class="content" id="description_213">第一获取单元111在多组样本图像(例如包括N组三维影像和对应的时间)中，提取出各组对应的呼气末图像，得到呼气末图像集合，以及从多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；然后从呼气末图像集合和吸气末图像集合中，任意选择一对匹配的吸气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513515&amp;blobId=3526002584" width="51"/>(即目标吸气末图像)和呼气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514101&amp;blobId=3525935354" width="299"/>(即目标呼气末图像)，即该目标吸气末图像和目标呼气末图像为同一个人在整个呼吸周期内的同一组图像。</td></tr><tr><td class="content" id="description_214">此时，第一获取单元111可以将吸气末图像集合中除目标呼气末图像之外的其它组吸气末图像向目标吸气末图像配准，得到第一吸气形变场集合，即得到各组样本图像中吸气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513972&amp;blobId=3526203598" width="363"/>以及将呼气末图像集合中除目标呼气末图像之外的其他呼气末图像，向目标呼气末图像配准，得到第一呼气形变场集合，即得到各组组样本图像中呼气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514186&amp;blobId=3525917864" width="364"/></td></tr><tr><td class="content" id="description_215">其中，配准是指将其它组的吸气末图像向选定的那一组的吸气末图像配准，配准后获得它们之间的形变场，利用该形变场可以将其它组的吸气末图像形变到选定的那一组吸气末图像所在的空间。同理，对于呼气末图像也一样，第一获取单元111可以将其它组的呼气末图像向选定的那一组的呼气末图像配准，配准后获得它们之间的形变场，利用该形变场可以将其它组的呼气末图像形变到选定的那一组呼气末图像所在的空间。</td></tr><tr><td class="content" id="description_216">优选地，所述第二获取单元112，具体用于从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_217">对于每组样本图像，第二获取单元112需要将吸气节点图像向吸气末图像配准，以及将呼气节点图像向呼气末图像配准，且保持肝脏不可压缩，其中，吸气节点图像为处于吸气节点的图像，呼气节点图像为处于呼气节点的图像，吸气末图像为处于吸气末端的图像，呼气末图像为处于呼气末端的图像。</td></tr><tr><td class="content" id="description_218">具体地，第二获取单元112可以从多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；通过预设的不可压缩配准的能量函数计算呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算吸气节点图像与对应的吸气末图像之间的吸气速度场，该呼气速度场和吸气速度场均可以包括待估计的速度场、中间速度场及更新场等。其中，预设的不可压缩配准的能量函数如下：</td></tr><tr><td class="content" id="description_219"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514061&amp;blobId=3526185710" width="492"/></td></tr><tr><td class="content" id="description_220">其中，R为吸气末图像或呼气末图像，M为处于其他呼吸节点的呼气节点图像或吸气节点图像，σ<base:Sub>i</base:Sub>，σ<base:Sub>x</base:Sub>和σ<base:Sub>d</base:Sub>为权重因子，v和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513921&amp;blobId=3526079810" width="30"/>分别为待估计的速度场与中间速度场。且v和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514126&amp;blobId=3525861800" width="30"/>满足以下公式：</td></tr><tr><td class="content" id="description_221"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513501&amp;blobId=3526023712" width="492"/></td></tr><tr><td class="content" id="description_222">其中δv为更新速度场，将公式(2)代入能量函数，通过优化能量函数，获得形变场的更新场，其公式如下：</td></tr><tr><td class="content" id="description_223"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514162&amp;blobId=3526036625" width="492"/></td></tr><tr><td class="content" id="description_224">将求得的δv代入公式(2)，求得<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513588&amp;blobId=3525898500" width="51"/></td></tr><tr><td class="content" id="description_225">此时，第二获取单元112可以分别对呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除无旋场，利用调和场和预设的平移场补偿去除的无旋场，得到补偿后速度场。例如对于指定不可压缩区域的呼气速度场和吸气速度场，即肝脏区域Ω<base:Sub>I</base:Sub>，利用霍奇-亥姆霍兹分解定理，将该区域的速度场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514136&amp;blobId=3526167294" width="171"/>进行分解，获得对应的无源场f<base:Sub>D</base:Sub>、无旋场f<base:Sub>C</base:Sub>和调和场f<base:Sub>H</base:Sub>，其公式如下：</td></tr><tr><td class="content" id="description_226"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514443&amp;blobId=3525942100" width="492"/></td></tr><tr><td class="content" id="description_227">无源场、无旋场和调和场的公式如下：</td></tr><tr><td class="content" id="description_228"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514245&amp;blobId=3526106575" width="492"/></td></tr><tr><td class="content" id="description_229"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513959&amp;blobId=3526119585" width="492"/></td></tr><tr><td class="content" id="description_230"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514550&amp;blobId=3526189498" width="492"/></td></tr><tr><td class="content" id="description_231"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514070&amp;blobId=3526223412" width="492"/></td></tr><tr><td class="content" id="description_232"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513926&amp;blobId=3526218450" width="492"/></td></tr><tr><td class="content" id="description_233">其中公式(6)和(8)为泊松方程，通过求解，可以获得无源场f<base:Sub>D</base:Sub>、无旋场f<base:Sub>C</base:Sub>和调和场f<base:Sub>H</base:Sub>。</td></tr><tr><td class="content" id="description_234">然后为了保证速度场的散度为零，去除速度场中的有源分量，即删除无旋场。同时，利用调和场和平移场(该平移场是在x、y或z轴向移动的刚性形变场)分别补偿去除的有源分量中的非线性和线性部分，得到补偿后速度场。补偿后速度场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514155&amp;blobId=3526108265" width="182"/>公式如下：</td></tr><tr><td class="content" id="description_235"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513536&amp;blobId=3525900200" width="492"/></td></tr><tr><td class="content" id="description_236">其中<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514013&amp;blobId=3526037442" width="50"/>为调和场的权重，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513435&amp;blobId=3525853611" width="39"/>为平移场，可以利用线性最小二乘法求解<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514621&amp;blobId=3525963786" width="51"/>及<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514478&amp;blobId=3525907551" width="70"/>根据求解的<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513386&amp;blobId=3525872221" width="52"/>及<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514034&amp;blobId=3526019943" width="67"/>每次迭代的速度场为：</td></tr><tr><td class="content" id="description_237"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514626&amp;blobId=3526064414" width="492"/></td></tr><tr><td class="content" id="description_238">第二获取单元112将补偿后速度场输入能量函数进行下一次迭代，直到能量函数收敛，即通过不可压缩配准的能量函数计算各组对应的呼气节点图像与对应的呼气末图像之间的呼气速度场，对呼气速度场进行分解，得到呼气速度场对应的无源场、无旋场和调和场，并去除无旋场，利用调和场和预设的平移场补偿去除的无旋场，得到呼气速度场对应的补偿后速度场；将该补偿后速度场输入能量函数进行下一次迭代，直到能量函数收敛，得到第二呼气形变场集合。以及通过不可压缩配准的能量函数计算各组对应的吸气节点图像与对应的吸气末图像之间的吸气速度场，对吸气速度场进行分解，得到吸气速度场对应的无源场、无旋场和调和场，并去除无旋场，利用调和场和预设的平移场补偿去除的无旋场，得到吸气速度场对应的补偿后速度场；将该补偿后速度场输入能量函数进行下一次迭代，直到能量函数收敛，得到第二吸气形变场集合。</td></tr><tr><td class="content" id="description_239">例如，将更新后的<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513686&amp;blobId=3526178878" width="29"/>作为下一次迭代的v，从而求解新的能量函数，通过不断重复，最终直到能量函数收敛，求得最优的形变场，即第二呼气形变场集合ES和第二吸气形变场集合IS。</td></tr><tr><td class="content" id="description_240">第一复合单元113将第二呼气形变场集合ES和第一呼气形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514464&amp;blobId=3525859219" width="339"/>中各个时刻对应的形变场分别进行复合，得到复合呼气形变场集合RMES；以及第二复合单元114将第二吸气形变场集合IS和第一吸气形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514279&amp;blobId=3526021266" width="338"/>中各个时刻对应的形变场分别进行复合，得到复合吸气形变场集合RMIS，其中，吸气末状态图谱A<base:Sup>I</base:Sup>、呼气末状态图谱A<base:Sup>E</base:Sup>、复合呼气形变场集合RMES和复合吸气形变场集合RMIS可以组成呼吸运动模型。</td></tr><tr><td class="content" id="description_241">参见图11，图11为图9中所述图像获取模块120的具体细化功能模块示意图。上述第一实施例中所述图像获取模块120包括：图谱获取单元121、信息获取单元122、配准单元123和图像获取单元124。其中，图谱获取单元121，用于根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱；信息获取单元122，用于获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息；配准单元123，用于根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场；图像获取单元124，用于根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_242">优选地，所述图谱获取单元121，具体用于从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；从所述呼气末图像集合和吸气末图像集合中选择匹配的一对目标呼气末图像和目标吸气末图像；将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合；根据所述第一呼气形变场集合获取配准后呼气图像，以及根据所述第一吸气形变场集合获取配准后吸气图像；根据所述配准后呼气图像获取呼气末状态图谱，以及根据所述配准后吸气图像获取吸气末状态图谱。</td></tr><tr><td class="content" id="description_243">具体地，在多组样本图像中，图谱获取单元121提取出各组对应的呼气末图像，得到呼气末图像集合，以及从多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；然后从呼气末图像集合和吸气末图像集合中，任意选择一对匹配的吸气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514260&amp;blobId=3525943550" width="59"/>(即目标吸气末图像)和呼气末图像<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513339&amp;blobId=3525931427" width="299"/>(即目标呼气末图像)，即该目标吸气末图像和目标呼气末图像为同一个人在整个呼吸周期内的同一组图像。</td></tr><tr><td class="content" id="description_244">此时，可以将吸气末图像集合中除目标呼气末图像之外的其它组吸气末图像向目标吸气末图像配准，得到第一吸气形变场集合，即得到各组样本图像中吸气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514572&amp;blobId=3525968120" width="363"/>以及将呼气末图像集合中除目标呼气末图像之外的其他呼气末图像，向目标呼气末图像配准，得到第一呼气形变场集合，即得到各组组样本图像中呼气末图像的形变场集合<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513708&amp;blobId=3526036998" width="363"/></td></tr><tr><td class="content" id="description_245">然后，图谱获取单元121将求得的第一呼气形变场集合中各个呼气形变场分别作用于对应的呼气图像，获得配准后呼气图像，将配准后呼气图像的像素值进行平均，获得肝脏区域的呼气末状态图谱A<base:Sup>I</base:Sup>。以及将求得的第一吸气形变场集合中各个吸气形变场分别作用于对应的吸气图像，获得配准后吸气图像，将配准后吸气图像的像素值进行平均获得肝脏区域的吸气末状态图谱A<base:Sup>E</base:Sup>。</td></tr><tr><td class="content" id="description_246">在得到呼气末状态图谱A<base:Sup>I</base:Sup>和吸气末状态图谱A<base:Sup>E</base:Sup>后，可以将呼气末状态图谱A<base:Sup>I</base:Sup>与呼气图像(即术前呼气图像)进行配准，以及将吸气末状态图谱A<base:Sup>E</base:Sup>与吸气图像术(即术前吸气图像)进行配准。以呼气末状态图谱A<base:Sup>I</base:Sup>向术前呼气图像进行配准为例，相似性测度SIM如下：</td></tr><tr><td class="content" id="description_247"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209514503&amp;blobId=3526017267" width="492"/></td></tr><tr><td class="content" id="description_248">其中，SIM<base:Sub>MI</base:Sub>表示呼气末状态图谱A<base:Sup>I</base:Sup>与术前呼气图像之间的互信息，该互信息是一种衡量图像间相似性的指标；SIM<base:Sub>KS</base:Sub>表示呼气末状态图谱A<base:Sup>I</base:Sup>与术前呼气图像中肝脏分割结果之间的重叠率(即肝脏体积重叠率)；SIM<base:Sub>CP</base:Sub>表示呼气末状态图谱A<base:Sup>I</base:Sup>与术前呼气图像中膈肌对应点间的距离，即呼气末状态图谱A<base:Sup>I</base:Sup>中膈肌区域内的每个像素点(x1，y1)，与术前呼气图像中膈肌区域内的每个像素点(x2，y2)之间的距离<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513759&amp;blobId=3525955930" width="492"/>ω<base:Sub>1</base:Sub>，ω<base:Sub>2</base:Sub>和ω<base:Sub>3</base:Sub>分别为SIM<base:Sub>MI</base:Sub>、SIM<base:Sub>KS</base:Sub>、及SIM<base:Sub>CP</base:Sub>对应的权重。信息获取单元122可以获取SIM<base:Sub>MI</base:Sub>、SIM<base:Sub>KS</base:Sub>、及SIM<base:Sub>CP</base:Sub>等第一配准信息，通过利用梯度下降法优化公式(12)，即根据SIM<base:Sub>MI</base:Sub>、SIM<base:Sub>KS</base:Sub>、及SIM<base:Sub>CP</base:Sub>等第一配准信息将呼气末状态图谱向术前呼气图像配准，由配准单元123可以获得形变场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513924&amp;blobId=3525909506" width="83"/>(即得到第一形变场)。同样的，可以利用公式(12)将吸气末状态图谱A<base:Sup>E</base:Sup>向术前吸气图像配准，获得形变场<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513807&amp;blobId=3526068162" width="88"/>(即第二形变场)。</td></tr><tr><td class="content" id="description_249">图像获取单元124将RMES经过<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513993&amp;blobId=3526002498" width="85"/>投影得到形变场集合EFS，然后将EFS作用于术前吸气图像，即利用EFS形变术前吸气图像，得到形变后的图像即为吸气模拟图像，从而可以获得处于吸气阶段的吸气模拟图像集合I<base:Sup>E</base:Sup>＝FoEFS。以及，将RMIS经过<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4209513324&amp;blobId=3526113476" width="84"/>投影得到形变场集合IFS，然后将IFS作用于术前呼气图像，即利用IFS形变术前呼气图像，得到形变后的图像即为呼气模拟图像，从而可以获得处于呼气阶段的呼气模拟图像集合I<base:Sup>I</base:Sup>＝FoIFS。吸气模拟图像集合和呼气模拟图像集合组成的模拟图像集合I＝{I<base:Sup>I</base:Sup>,I<base:Sup>E</base:Sup>}将作为卷积神经网络学习的训练样本。</td></tr><tr><td class="content" id="description_250">优选地，所述训练模块130，具体用于从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像；从所述当前呼气图像中呼吸器官所在区域内提取第一预设区域，并从所述当前呼气模拟图像中呼吸器官所在区域内对应于所述第一预设区域的位置提取第二预设区域；根据所述第一预设区域和所述第二预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从所述呼气模拟图像集合中选择与所述当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至所述呼气模拟图像集合中各个呼气模拟图像选择完毕；</td></tr><tr><td class="content" id="description_251">以及，从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像；从所述当前吸气图像中呼吸器官所在区域内提取第三预设区域，并从所述当前吸气模拟图像中呼吸器官所在区域内对应于所述第三预设区域的位置提取第四预设区域；根据所述第三预设区域和所述第四预设区域对预设的卷积神经网络的参数进行收敛，返回执行从所述多组样本图像中选择其中一张吸气图像作为当前吸气图像，以及从所述吸气模拟图像集合中选择与所述当前吸气图像标识匹配的吸气模拟图像作为当前吸气模拟图像的步骤，直至所述吸气模拟图像集合中各个吸气模拟图像选择完毕，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_252">训练模块130从多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从呼气模拟图像集合中选择与当前呼气图像标识匹配(即相同时刻或相同编号等)的呼气模拟图像作为当前呼气模拟图像，如图7所示，然后，训练模块130从当前呼气图像中呼吸器官所在区域内(即肝脏区域)提取第一预设区域，该第一预设区域可以是一个矩形的子块，该子块的形状和大小等可以根据实际需要进行灵活设置，并从当前呼气模拟图像中呼吸器官所在区域内对应于第一预设区域的位置提取第二预设区域，该第二预设区域可以是一个矩形的子块，该子块的形状和大小等可以根据实际需要进行灵活设置，该第一预设区域与第二预设区域的形状、大小及所在肝脏区域的位置一致。</td></tr><tr><td class="content" id="description_253">其中，第一预设区域与第二预设区域可以包括多组，例如，在当前呼气图像和当前呼气模拟图像中，分别以呼吸器官所在区域的原点为第一个子块的原点，得到一组第一预设区域与第二预设区域，然后逐渐平原点位置，获得其他子块，其他组的第一预设区域与第二预设区域。</td></tr><tr><td class="content" id="description_254">训练模块130将每一组第一预设区域与第二预设区域分别作为预设的卷积神经网络的双通道输入，例如可以将第一预设区域作为第一通道输入，将第二预设区域作为第二通道输入，如图7所示，该卷积神经网络可以包括卷积层、激活层、联合层及反卷积层等，此时可以利用卷积神经网络的不同卷积核对输入的第一预设区域与第二预设区域执行卷积操作，使用修正线性单元(Rectified Linear Unit，ReLU)作为激活函数，或者将parametric ReLU作为激活函数，使用范数L1作为损失函数，可以输出x、y、z三个方向上的形变场，对应金标准(金标准是指用不可压缩算法求得的形变场)为子块区域的形变场。然后对卷积神经网络进行训练，返回执行从多组样本图像中选择其中一张呼气图像作为当前呼气图像，以及从呼气模拟图像集合中选择与当前呼气图像标识匹配的呼气模拟图像作为当前呼气模拟图像的步骤，直至呼气模拟图像集合中各个呼气模拟图像选择完毕，通过小批量梯度下降优化算法，调整卷积神经网络的权重及偏差等网络参数，实现损失函数的最小化。</td></tr><tr><td class="content" id="description_255">同样的，对于吸气模拟图像集合和多组样本图像中吸气图像按照上述方法对卷积神经网络进行训练，得到训练后卷积神经网络。</td></tr><tr><td class="content" id="description_256">优选地，所述校正模块140，具体用于获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；将所述多个形变场进行重建，得到所述待校正图像的预测形变场；根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_257">其中，待校正图像可以是术后呼气图像或术后吸气图像，将术后呼气图像或术后吸气图像统称为术后图像。对于术后图像(即待校正图像)，校正模块140从术后图像中呼吸器官(即肝脏)所在区域内提取出多个子块，以及从术前图像中呼吸器官所在区域内的对应位置提取出多个子块，将这些子块分别输入训练后卷积神经网络，通过训练后卷积神经网络进行预测，即计算多个子块对应的形变场，得到多个形变场，将多个形变场进行重建，例如把所有子块的形变场重叠的部分进行平均，没有重叠的部分进行插值，从而获得术后图像的预测形变场，使得子块区域的稀疏形变场，通过重建获得整幅图像的稠密形变场。然后校正模块140将该预测形变场作用于术后图像，获得术前图像与术后图像之间的配准结果，实现了对术后图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_258">上述实施例所提供的呼吸运动校正装置，通过形变场获取模块110获取多组包含呼吸器官的样本图像，根据多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；然后，由图像获取模块120根据复合呼气形变场集合获取呼气模拟图像集合，以及根据复合吸气形变场集合获取吸气模拟图像集合；其次，由训练模块130通过多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；最后，校正模块140可以获取待校正图像，利用训练后卷积神经网络对待校正图像中呼吸器官的呼吸运动进行校正。实现了根据复合呼气形变场集合获取呼气模拟图像集合，以及根据复合吸气形变场集合获取吸气模拟图像集合，来对预设的卷积神经网络进行训练，从而可以利用训练后卷积神经网络校对校正图像中呼吸器官的呼吸运动进行校正，提高了对呼吸运动进行校正的精准性及效率。</td></tr><tr><td class="content" id="description_259">本发明实施例还提供一种计算机设备，该计算机设备可以包括一个或者一个以上处理核心的处理器、一个或一个以上包含计算机可读存储介质的存储器、电源和输入单元等部件。其中：</td></tr><tr><td class="content" id="description_260">处理器是该计算机设备的控制中心，利用各种接口和线路连接整个计算机设备的各个部分，通过运行或执行存储在存储器内的软件程序和/或模块，以及调用存储在存储器内的数据，执行计算机设备的各种功能和处理数据，从而对计算机设备进行整体监控。优选地，处理器可包括一个或多个处理核心，处理器可集成应用处理器和调制解调处理器，其中，应用处理器主要处理操作系统、用户界面和应用程序等，调制解调处理器主要处理无线通信。可以理解的是，上述调制解调处理器也可以不集成到处理器中。</td></tr><tr><td class="content" id="description_261">存储器可用于存储软件程序以及模块，处理器通过运行存储在存储器的软件程序以及模块，从而执行各种功能应用以及呼吸运动校正。存储器可主要包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、至少一个功能所需的应用程序等；存储数据区可存储根据网络设备的使用所创建的数据等。此外，存储器可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件、闪存器件、或其他易失性固态存储器件。相应地，存储器还可以包括存储器控制器，以提供处理器对存储器的访问。</td></tr><tr><td class="content" id="description_262">计算机设备还包括给各个部件供电的电源，优选地，电源可以通过电源管理系统与处理器逻辑相连，从而通过电源管理系统实现管理充电、放电、以及功耗管理等功能。电源还可以包括一个或一个以上的直流或交流电源、再充电系统、电源故障检测电路、电源转换器或者逆变器、电源状态指示器等任意组件。该计算机设备还可包括输入单元，该输入单元可用于接收输入的数字或字符信息，以及产生与用户设置以及功能控制有关的键盘、鼠标、操作杆、光学或者轨迹球信号输入。尽管未示出，计算机设备还可以包括显示单元等，在此不再赘述。</td></tr><tr><td class="content" id="description_263">具体在本实施例中，计算机设备中的处理器会按照如下的指令，将一个或一个以上的应用程序的进程对应的可执行文件加载到存储器中，并由处理器来运行存储在存储器中的应用程序，从而实现本发明实施例提供的呼吸运动校正方法，如下：</td></tr><tr><td class="content" id="description_264">获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_265">优选地，所述根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合具体包括：根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合；获取第二呼气形变场集合和第二吸气形变场集合；将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合；将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</td></tr><tr><td class="content" id="description_266">优选地，所述根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合具体包括：从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</td></tr><tr><td class="content" id="description_267">优选地，所述获取第二呼气形变场集合和第二吸气形变场集合具体包括：从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_268">优选地，所述根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合具体包括：根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱；获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息；根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场；根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_269">优选地，所述获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正具体包括：获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；将所述多个形变场进行重建，得到所述待校正图像的预测形变场；根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_270">以上各个操作的具体实施可参见前面的实施例，在此不再赘述。</td></tr><tr><td class="content" id="description_271">本领域普通技术人员可以理解，上述实施例的各种方法中的全部或部分步骤可以通过指令来完成，或通过指令控制相关的硬件来完成，该指令可以存储于一计算机可读存储介质中，并由处理器进行加载和执行。</td></tr><tr><td class="content" id="description_272">为此，本发明实施例提供一种存储介质，其中存储有多条指令，该指令能够被处理器进行加载，以执行本发明实施例所提供的任一种呼吸运动校正方法中的步骤。例如，该指令可以执行如下步骤：</td></tr><tr><td class="content" id="description_273">获取多组包含呼吸器官的样本图像，根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合；根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合；通过所述多组样本图像、呼气模拟图像集合、以及吸气模拟图像集合对预设的卷积神经网络进行训练，得到训练后卷积神经网络；获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_274">优选地，所述根据所述多组样本图像获取复合呼气形变场集合和复合吸气形变场集合具体包括：根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合；获取第二呼气形变场集合和第二吸气形变场集合；将所述第一呼气形变场集合和第二呼气形变场集合进行复合，得到复合呼气形变场集合；将所述第一吸气形变场集合和第二吸气形变场集合进行复合，得到复合吸气形变场集合。</td></tr><tr><td class="content" id="description_275">优选地，所述根据所述多组样本图像获取第一呼气形变场集合和第一吸气形变场集合具体包括：从所述多组样本图像中提取出各组对应的呼气末图像，得到呼气末图像集合，以及从所述多组样本图像中提取出各组对应的吸气末图像，得到吸气末图像集合；从所述呼气末图像集合和吸气末图像集合中选择一对匹配的目标呼气末图像和目标吸气末图像；将所述呼气末图像集合中除所述目标呼气末图像之外的其他呼气末图像，向所述目标呼气末图像配准，得到第一呼气形变场集合；将所述吸气末图像集合中除所述目标吸气末图像之外的其他吸气末图像，向所述目标吸气末图像配准，得到第一吸气形变场集合。</td></tr><tr><td class="content" id="description_276">优选地，所述获取第二呼气形变场集合和第二吸气形变场集合具体包括：从所述多组样本图像中提取出各组对应的呼气节点图像，以及提取出各组对应的吸气节点图像；通过预设的不可压缩配准的能量函数计算所述呼气节点图像与对应的呼气末图像之间的呼气速度场，以及计算所述吸气节点图像与对应的吸气末图像之间的吸气速度场；分别对所述呼气速度场和吸气速度场进行分解，得到无源场、无旋场和调和场，并去除所述无旋场，利用所述调和场和预设的平移场补偿去除的所述无旋场，得到补偿后速度场；将补偿后速度场输入所述能量函数进行下一次迭代，直到所述能量函数收敛，得到第二呼气形变场集合和第二吸气形变场集合。</td></tr><tr><td class="content" id="description_277">优选地，所述根据所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述复合吸气形变场集合获取吸气模拟图像集合具体包括：根据所述多组样本图像获取呼气末状态图谱和吸气末状态图谱；获取所述呼气末状态图谱与所述多组样本图像中对应的呼气图像之间的第一配准信息，以及获取所述吸气末状态图谱与所述多组样本图像中对应的吸气图像之间的第二配准信息；根据所述第一配准信息将所述呼气末状态图谱向所述呼气图像配准，得到第一形变场，以及根据所述第二配准信息将所述吸气末状态图谱向所述吸气图像配准，得到第二形变场；根据所述第一形变场和所述复合呼气形变场集合获取呼气模拟图像集合，以及根据所述第二形变场和所述复合吸气形变场集合获取吸气模拟图像集合。</td></tr><tr><td class="content" id="description_278">优选地，所述获取待校正图像，利用所述训练后卷积神经网络对所述待校正图像中呼吸器官的呼吸运动进行校正具体包括：获取待校正图像，从所述待校正图像中呼吸器官所在区域内提取出多个子块；通过训练后卷积神经网络计算所述多个子块对应的形变场，得到多个形变场；将所述多个形变场进行重建，得到所述待校正图像的预测形变场；根据所述预测形变场对所述待校正图像中呼吸器官的呼吸运动进行校正。</td></tr><tr><td class="content" id="description_279">以上各个操作的具体实施可参见前面的实施例，在此不再赘述。</td></tr><tr><td class="content" id="description_280">其中，该存储介质可以包括：只读存储器(ROM，Read Only Memory)、随机存取记忆体(RAM，Random Access Memory)、磁盘或光盘等。</td></tr><tr><td class="content" id="description_281">由于该存储介质中所存储的指令，可以执行本发明实施例所提供的任一种呼吸运动校正方法中的步骤，因此，可以实现本发明实施例所提供的任一种呼吸运动校正方法所能实现的有益效果，详见前面的实施例，在此不再赘述。</td></tr><tr><td class="content" id="description_282">以上仅为本发明的优选实施例，并非因此限制本发明的专利范围，凡是利用本发明说明书及附图内容所作的等效结构或等效流程变换，或直接或间接运用在其他相关的技术领域，均同理包括在本发明的专利保护范围内。</td></tr></table></div></body></html>