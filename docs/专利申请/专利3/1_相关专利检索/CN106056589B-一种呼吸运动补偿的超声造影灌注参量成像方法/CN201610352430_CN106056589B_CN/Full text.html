<html><head><title>全文文本(Fulltext)</title><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><style>div.fullText table {width: 100%;text-indent: 1px;} 
 div.fullText table td.header {font-weight: bold;text-align: center;font-family: '宋体';font-size: 16px;line-height:20px;color: #000000;padding: 5px;}div.fullText table td.content {padding: 1px;text-align: left;vertical-align: top;width: 100%;font-family: '宋体';font-size: 14px;line-height:20px;color: #000000;}</style></head><body><?xml version="1.0" encoding="UTF-8"?><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table><tr><td id="claim_title" class="header">权利要求书</td></tr><tr><td class="content" id="claim_1"><business:ClaimText>1.一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：包括以下步骤：</business:ClaimText></td></tr><tr><td class="content" id="claim_2"><business:ClaimText>(1)对B超图像序列进行非负矩阵分解得到整个灌注过程的呼吸运动曲线，并基于可调强度阈值法，剔除呼吸运动曲线突变区对应的无效图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_3"><business:ClaimText>(2)联合B超图像序列总帧数和目标区脏器呼吸运动导致形变程度进行判定，从而选出最佳呼吸运动补偿方案，利用所述呼吸运动补偿方案对包含呼气、吸气末期在内的所有呼吸相位子序列构建追踪序列；</business:ClaimText></td></tr><tr><td class="content" id="claim_4"><business:ClaimText>(3)对追踪序列进行由粗到精三步搜索的块匹配呼吸运动位移矢量跟踪计算，进而对所有呼吸相位对应的子序列图像的微泡背向散射时间强度曲线TIC进行针对性特征补偿；</business:ClaimText></td></tr><tr><td class="content" id="claim_5"><business:ClaimText>(4)经过步骤3)后，对B超图像序列中的造影图像序列进行灌注参量成像。</business:ClaimText></td></tr><tr><td class="content" id="claim_6"><business:ClaimText>2.根据权利要求1所述一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：所述步骤(1)具体包括以下步骤：</business:ClaimText></td></tr><tr><td class="content" id="claim_7"><business:ClaimText>(1.1)对非负矩阵分解的基矩阵Q<base:Sub>k×r</base:Sub>和系数矩阵P<base:Sub>r×m</base:Sub>进行初始设定，将Q和P均设置为0～1之间随机均匀分布的矩阵，其中k为一帧B超图像的总像素点数，r为降秩维数，m为TIC的帧数；</business:ClaimText></td></tr><tr><td class="content" id="claim_8"><business:ClaimText>(1.2)针对原始B超图像序列矩阵V<base:Sub>k×m</base:Sub>，V的行向量对应图像中特定像素点的TIC，列向量对应一帧图像中的所有像素点，并以欧式距离作为降秩逼近判定标准，采用交替迭代的方法，对Q和P矩阵进行逼近更新计算，算法的目标函数和第n+1次迭代的具体过程如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_9"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900956&amp;blobId=3523663530" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_10"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900997&amp;blobId=3523422678" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_11"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901094&amp;blobId=3523645601" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_12"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900969&amp;blobId=3523124350" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_13"><business:ClaimText>(1.3)系数矩阵P的第一行分量P(1,:)为呼吸运动曲线R(t)输出，并进行幅度归一化；</business:ClaimText></td></tr><tr><td class="content" id="claim_14"><business:ClaimText>(1.4)计算呼吸运动曲线幅度的平均值，以平均幅度为标准，基于强度阈值法剔除曲线幅度上下偏移x及以上所对应的B超图像，x取值在55％～85％之间。</business:ClaimText></td></tr><tr><td class="content" id="claim_15"><business:ClaimText>3.根据权利要求1所述一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：所述步骤(2)具体包括以下步骤：</business:ClaimText></td></tr><tr><td class="content" id="claim_16"><business:ClaimText>判断目标脏器在灌注过程中是否形变剧烈并且B超图像序列帧数是否小于1000帧，若均为否，则采取运动相位划分方案构造追踪序列，即方案一，其他情况则采取帧挑选方案构造追踪序列，即方案二；所述形变剧烈是指呼吸运动曲线出现局部极大值或极小值。</business:ClaimText></td></tr><tr><td class="content" id="claim_17"><business:ClaimText>4.根据权利要求3所述一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：所述方案一的具体步骤为：根据呼吸运动曲线R(t)的幅度将一个周期的呼吸运动等分为若干个呼吸相位，相位个数res<base:Sub>N</base:Sub>为10～30，从而得到相应呼吸相位对应的子图像序列frame_res<base:Sub>i</base:Sub>,i∈[1,res<base:Sub>N</base:Sub>],所有呼吸相位的子图像序列总帧数为frame<base:Sub>N</base:Sub>，选取每个呼吸相位子图像序列的首帧图像构成追踪序列。</business:ClaimText></td></tr><tr><td class="content" id="claim_18"><business:ClaimText>5.根据权利要求3所述一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：所述方案二的具体步骤为：仅挑选出呼吸运动曲线R(t)幅度的局部极大值或极小值对应的图像，从而得到呼气末期或吸气末期的子图像序列，子图像序列总帧数为frame<base:Sub>N</base:Sub>，该子图像序列即为追踪序列。</business:ClaimText></td></tr><tr><td class="content" id="claim_19"><business:ClaimText>6.根据权利要求1所述一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：所述步骤(3)具体包括以下步骤：</business:ClaimText></td></tr><tr><td class="content" id="claim_20"><business:ClaimText>(3.1)选择追踪序列图像中任意一帧作为参考图像，并勾勒出运动追踪的目标块；</business:ClaimText></td></tr><tr><td class="content" id="claim_21"><business:ClaimText>(3.2)以最小均方误差作为搜索块与目标块匹配的判断依据，对追踪序列图像进行由粗到精三步搜索的块匹配呼吸运动跟踪法的横向x、纵向y位移矢量计算，均方误差的计算公式如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_22"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900933&amp;blobId=3523349400" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_23"><business:ClaimText>其中，M,N分别为目标块的纵向和横向像素点数，C<base:Sub>ij</base:Sub>和R<base:Sub>ij</base:Sub>分别为目标块和搜索块的像素值；</business:ClaimText></td></tr><tr><td class="content" id="claim_24"><business:ClaimText>(3.3)对所有呼吸相位对应的子图像序列中经1×1～5×5像素点空间平滑所得的成像TIC进行针对性补偿，若t时刻图像对应呼吸相位res<base:Sub>i</base:Sub>，补偿前像素点(x,y)处的TIC为TIC(x,y,t)，则补偿后(x,y)处的TIC为<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901003&amp;blobId=3523307170" width="294"/></business:ClaimText></td></tr><tr><td class="content" id="claim_25"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901072&amp;blobId=3523659335" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_26"><business:ClaimText>其中，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900963&amp;blobId=3523500279" width="172"/>分别对应呼吸相位res<base:Sub>i</base:Sub>的x,y方向运动位移。</business:ClaimText></td></tr><tr><td class="content" id="claim_27"><business:ClaimText>7.根据权利要求1所述一种呼吸运动补偿的超声造影灌注参量成像方法，其特征在于：所述步骤(4)包括以下步骤：</business:ClaimText></td></tr><tr><td class="content" id="claim_28"><business:ClaimText>(4.1)对经运动补偿后的1×1～5×5像素点空间平滑所得成像TIC与整个待灌注参量成像区域所得TIC均值曲线进行互相关分析，剔除相关系数小于0.3的成像TIC，得有效TIC；</business:ClaimText></td></tr><tr><td class="content" id="claim_29"><business:ClaimText>(4.2)以有效TIC前5点的均值为基准进行TIC基线归零，并对TIC进行倍数为K的cubic插值，K的计算公式如下：</business:ClaimText></td></tr><tr><td class="content" id="claim_30"><business:ClaimText>K＝Frames/frame<base:Sub>N</base:Sub></business:ClaimText></td></tr><tr><td class="content" id="claim_31"><business:ClaimText>其中Frames为B超图像序列总帧数，frame<base:Sub>N</base:Sub>为呼吸相位的子图像序列总帧数；</business:ClaimText></td></tr><tr><td class="content" id="claim_32"><business:ClaimText>(4.3)经过步骤(4.2)后，分别提取TIC的时间类、强度类和比值类灌注参量，进行伪彩编码显示成像。</business:ClaimText></td></tr></table></div><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table style="table-layout:fixed"><tr><td id="description_title" class="header">
						说明书
					</td></tr><tr><td class="content" id="description_invention_title">一种呼吸运动补偿的超声造影灌注参量成像方法</td></tr><tr><td class="content" id="description_1">技术领域</td></tr><tr><td class="content" id="description_2">本发明属于超声造影成像领域，具体涉及一种呼吸运动补偿的超声造影灌注参量成像方法。</td></tr><tr><td class="content" id="description_3">背景技术</td></tr><tr><td class="content" id="description_4">超声造影血流灌注参量成像是一种功能性成像方法，已被初步应用于估计心肌血流灌注、区分肝脏的良性恶性病变、研究肿瘤新生血管的血液供给情况等。超声造影图像序列一般是在患者自由呼吸时采集的，呼吸运动的存在使得造影图像序列之间往往存在目标区域的严重偏移，从而影响医学诊断的结果。</td></tr><tr><td class="content" id="description_5">为了减小呼吸运动的影响，临床上可以采用屏息法。但该方法的局限性在于数据的采集时间受到很大限制。第二种方法为运动追踪法，通过在感兴趣区域内植入金属标记物进行运动追踪。该方法的缺陷在于有创性，并且检测到的运动信息仅仅为标记物的运动信息。第三种方法为门控法，分为在线和离线两种方式。在线门控包括呼吸门控和导航门控。呼吸门控采用外置呼吸探测垫或腹带检测呼吸运动，控制图像采集设备在特定时间内采集图像。导航门控不需任何外接部件，但需预先对横膈膜进行正常呼吸下的矢状位和冠状位扫描，寻找横膈膜置顶位置作为呼吸末期的导航窗位置，该技术操作复杂，扫描周期较长。离线门控是指在自由呼吸条件下采集图像序列，然后分析选出相同呼吸相位处的图像。该方法受人为因素影响较大，且相当耗时。第四种方法为呼吸运动模型法。该方法利用内部器官的运动数据和替代数据之间的关系进行建模。但并不是对于体内所有成像器官都能找到合适的替代数据，并且建模的过程较为复杂。第五种为基于纯图像的自动门控方法，为当前的研究热点。对患者进行B超造影成像，基于B超图像序列使用因子分析法提取呼吸运动曲线，并通过设定阈值挑选出呼气末和吸气末的造影图像序列，对其进行灌注参量成像。基于纯图像的自动门控呼吸运动补偿方法存在的限制：如因子分析法中因子数选择的困难、提取的呼吸运动曲线可能存在负值而不符合实际的生理意义、只针对腹部一种脏器进行运动补偿而对于其他腹部器官的有效性有待验证。</td></tr><tr><td class="content" id="description_6">发明内容</td></tr><tr><td class="content" id="description_7">本发明的目的在于提供一种普遍适用于腹部各个脏器同时保证分解结果具有实际生理意义的自动门控呼吸运动补偿的超声造影灌注参量成像方法。</td></tr><tr><td class="content" id="description_8">为实现上述目的，本发明采用了以下技术方案：</td></tr><tr><td class="content" id="description_9">(1)基于非负矩阵分解的呼吸运动曲线提取与可调强度阈值法的有效B超图像序列筛选：对B超图像序列进行非负矩阵分解得到整个灌注过程的呼吸运动曲线，并基于可调强度阈值法，剔除呼吸运动曲线突变区对应的无效图像；</td></tr><tr><td class="content" id="description_10">(2)联合B超图像序列总帧数和目标区脏器呼吸运动导致形变程度进行判定，从而选出最佳呼吸运动补偿方案，利用所述呼吸运动补偿方案对包含呼气、吸气末期在内的所有呼吸相位子序列构建追踪序列；</td></tr><tr><td class="content" id="description_11">(3)对追踪序列进行由粗到精三步搜索的块匹配呼吸运动位移矢量跟踪计算，进而对所有呼吸相位对应的子序列图像的微泡背向散射时间强度曲线进行针对性特征补偿；</td></tr><tr><td class="content" id="description_12">(4)经过步骤3)后，对B超图像序列中的造影图像序列进行灌注参量成像。</td></tr><tr><td class="content" id="description_13">所述步骤(1)具体包括以下步骤：</td></tr><tr><td class="content" id="description_14">(1.1)对非负矩阵分解的基矩阵Q<base:Sub>k×r</base:Sub>和系数矩阵P<base:Sub>r×m</base:Sub>进行初始设定，将Q和P均设置为0～1之间随机均匀分布的矩阵，其中k为一帧B超图像的总像素点数，r为降秩维数，一般设置为2～4，m为TIC的帧数；</td></tr><tr><td class="content" id="description_15">(1.2)针对原始B超图像序列矩阵V<base:Sub>k×m</base:Sub>，V的行向量对应图像中特定像素点的TIC，列向量对应一帧图像中的所有像素点，并以欧式距离作为降秩逼近判定标准，采用交替迭代的方法，对Q和P矩阵进行逼近更新计算，算法的目标函数和第n+1(n≥0)次迭代的具体过程如下：</td></tr><tr><td class="content" id="description_16"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901035&amp;blobId=3523596505" width="492"/></td></tr><tr><td class="content" id="description_17"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900984&amp;blobId=3523180858" width="492"/></td></tr><tr><td class="content" id="description_18"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901083&amp;blobId=3523295093" width="492"/></td></tr><tr><td class="content" id="description_19"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901009&amp;blobId=3523599059" width="492"/></td></tr><tr><td class="content" id="description_20">(1.3)系数矩阵P的第一行分量P(1,:)为呼吸运动曲线R(t)输出，并进行幅度归一化；</td></tr><tr><td class="content" id="description_21">(1.4)计算呼吸运动曲线幅度的平均值，以平均幅度为标准，基于强度阈值法剔除曲线幅度上下偏移x及以上所对应的B超图像，x取值在55％～85％之间。</td></tr><tr><td class="content" id="description_22">所述步骤(2)具体包括以下步骤：</td></tr><tr><td class="content" id="description_23">判断目标脏器在灌注过程中是否形变剧烈并且B超图像序列帧数是否小于1000帧，若均为否，则采取运动相位划分方案构造追踪序列，即方案一，其他情况则采取帧挑选方案构造追踪序列，即方案二；所述形变剧烈是指超出强度阈值法的阈值范围，呼吸运动曲线出现局部极大值或极小值。</td></tr><tr><td class="content" id="description_24">所述方案一的具体步骤为：根据呼吸运动曲线R(t)的幅度将一个周期的呼吸运动等分为若干个呼吸相位，相位个数res<base:Sub>N</base:Sub>由B超图像序列总帧数Frames决定，res<base:Sub>N</base:Sub>一般为10～30，从而得到相应呼吸相位对应的子图像序列frame_res<base:Sub>i</base:Sub>,i∈[1,res<base:Sub>N</base:Sub>],所有呼吸相位的子图像序列总帧数为frame<base:Sub>N</base:Sub>，选取每个呼吸相位子图像序列的首帧图像构成追踪序列。</td></tr><tr><td class="content" id="description_25">所述方案二的具体步骤为：仅挑选出呼吸运动曲线R(t)幅度的局部极大值或极小值对应的图像，从而得到呼气末期或吸气末期的子图像序列，子图像序列总帧数为frame<base:Sub>N</base:Sub>，该子图像序列即为追踪序列。</td></tr><tr><td class="content" id="description_26">所述步骤(3)具体包括以下步骤：</td></tr><tr><td class="content" id="description_27">(3.1)选择追踪序列图像中任意一帧作为参考图像，并勾勒出运动追踪的目标块；</td></tr><tr><td class="content" id="description_28">(3.2)以最小均方误差作为搜索块与目标块匹配的判断依据，对追踪序列图像进行由粗到精三步搜索的块匹配呼吸运动跟踪法的横向x、纵向y位移矢量计算，均方误差的计算公式如下：</td></tr><tr><td class="content" id="description_29"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901088&amp;blobId=3523637152" width="492"/></td></tr><tr><td class="content" id="description_30">其中，M,N分别为目标块的纵向和横向像素点数，C<base:Sub>ij</base:Sub>和R<base:Sub>ij</base:Sub>分别为目标块和搜索块的像素值；</td></tr><tr><td class="content" id="description_31">(3.3)对所有呼吸相位对应的子图像序列中经1×1～5×5像素点空间平滑所得的成像TIC进行针对性补偿，若t时刻图像对应呼吸相位res<base:Sub>i</base:Sub>，补偿前像素点(x,y)处的TIC为TIC(x,y,t)，则补偿后(x,y)处的TIC为<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900939&amp;blobId=3523630082" width="299"/></td></tr><tr><td class="content" id="description_32"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900978&amp;blobId=3523645425" width="492"/></td></tr><tr><td class="content" id="description_33">其中，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901054&amp;blobId=3523168367" width="174"/>分别对应呼吸相位res<base:Sub>i</base:Sub>的x,y方向运动位移，由步骤(3.2)获得。</td></tr><tr><td class="content" id="description_34">所述步骤(4)包括以下步骤：</td></tr><tr><td class="content" id="description_35">(4.1)对经运动补偿后的1×1～5×5像素点空间平滑所得成像TIC与整个待灌注参量成像区域所得TIC均值曲线进行互相关分析，剔除相关系数小于0.3的成像TIC，得有效TIC；</td></tr><tr><td class="content" id="description_36">(4.2)以有效TIC前5点的均值为基准进行TIC基线归零，并对TIC进行倍数为K的cubic插值，K的计算公式如下：</td></tr><tr><td class="content" id="description_37">K＝Frames/frame<base:Sub>N</base:Sub></td></tr><tr><td class="content" id="description_38">其中Frames为B超图像序列总帧数，frame<base:Sub>N</base:Sub>为呼吸相位的子图像序列总帧数；</td></tr><tr><td class="content" id="description_39">(4.3)经过步骤(4.2)后，分别提取TIC的时间类、强度类和比值类灌注参量，进行伪彩编码显示成像。</td></tr><tr><td class="content" id="description_40">本发明的优点如下：</td></tr><tr><td class="content" id="description_41">1、不需要人工介入，实现超声造影灌注参量成像的自动门控呼吸运动补偿。</td></tr><tr><td class="content" id="description_42">2、避免了因子分析法提取呼吸运动曲线时因子数选择的困难。</td></tr><tr><td class="content" id="description_43">3、非负矩阵分解得到的呼吸运动曲线具有较好的实际生理意义。</td></tr><tr><td class="content" id="description_44">4、普遍适用于腹部各个脏器的超声造影灌注参量成像。</td></tr><tr><td class="content" id="description_45">附图说明</td></tr><tr><td class="content" id="description_46">图1为本发明的整体流程框图。</td></tr><tr><td class="content" id="description_47">图2为脾脏(以峰值PV为例)呼吸运动补偿前、后的灌注参量图，采用运动相位划分的方案构造追踪序列；其中，(a)脾脏PV-补偿前，(b)脾脏PV-补偿后。</td></tr><tr><td class="content" id="description_48">图3为脾脏呼吸运动补偿前、后的TIC对比。</td></tr><tr><td class="content" id="description_49">具体实施方式</td></tr><tr><td class="content" id="description_50">下面结合附图和实施例对本发明作详细说明。</td></tr><tr><td class="content" id="description_51">本发明主要提出在自由呼吸模式下进行B超造影成像，通过提取呼吸运动曲线最终实现对超声造影图像序列的自动门控呼吸运动补偿，其核心在于呼吸运动曲线的有效提取以及运动追踪的准确性。为此，本发明使用非负矩阵分解(nonnegative matrixfactorization,NMF)提取呼吸运动曲线以保证分解结果具有实际的生理意义，同时使用三步搜索(Three Step Search,TSS)块匹配算法进行运动追踪以保证较快的追踪速度。本发明的呼吸运动补偿方法同样适用于其他B超图像(非造影图像)。</td></tr><tr><td class="content" id="description_52">本发明基于B超造影成像的灌注参量呼吸运动补偿及灌注参量成像方法，包括以下步骤：</td></tr><tr><td class="content" id="description_53">步骤一、基于非负矩阵分解的呼吸运动曲线提取与可调强度阈值法的有效图像序列筛选：对B超造影图像序列进行非负矩阵分解得到整个灌注过程的呼吸运动曲线，并基于可调强度阈值法，剔除呼吸运动曲线突变区对应的无效图像；</td></tr><tr><td class="content" id="description_54">步骤二、联合造影图像序列总帧数和目标区脏器呼吸运动导致形变程度进行判定，从两种呼吸运动补偿方案中筛选最佳呼吸运动补偿方案；对包括呼气、吸气末期等在内的呼吸相位子序列构建追踪序列；</td></tr><tr><td class="content" id="description_55">步骤三、对追踪序列进行由粗到精三步搜索的块匹配呼吸运动位移矢量跟踪计算，进而对所有呼吸相位对应的子序列图像的微泡背向散射时间强度曲线(Time-intensity Curve，TIC)进行针对性特征补偿；</td></tr><tr><td class="content" id="description_56">步骤四、进行灌注参量成像。</td></tr><tr><td class="content" id="description_57">具体实施步骤如下：</td></tr><tr><td class="content" id="description_58">(1)对非负矩阵分解的基矩阵Q<base:Sub>k×r</base:Sub>和系数矩阵P<base:Sub>r×m</base:Sub>进行初始设定，使用rand命令将基矩阵和系数矩阵均设置为0-1之间均匀分布的随机矩阵，其中k为一帧造影图像的总像素点数，r为降秩维数，设置为2，m为时间强度曲线的帧数，算法的迭代次数设为100；</td></tr><tr><td class="content" id="description_59">(2)针对原始造影图像序列矩阵V<base:Sub>k×m</base:Sub>，V的行向量对应图像中特定像素点的TIC，列向量对应一帧图像中的所有像素点，并以欧式距离作为降秩逼近判定标准，采用交替迭代的方法，对Q和P矩阵进行逼近更新计算，算法的目标函数和第n+1(n≥0)次迭代的具体过程如下；</td></tr><tr><td class="content" id="description_60"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901064&amp;blobId=3523486994" width="492"/></td></tr><tr><td class="content" id="description_61"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901026&amp;blobId=3523416450" width="492"/></td></tr><tr><td class="content" id="description_62"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900950&amp;blobId=3523293651" width="492"/></td></tr><tr><td class="content" id="description_63"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900990&amp;blobId=3523635516" width="492"/></td></tr><tr><td class="content" id="description_64">(3)系数矩阵P的第一行分量P(1,:)为呼吸运动曲线R(t)输出，并进行幅度归一化；</td></tr><tr><td class="content" id="description_65">(4)计算呼吸运动曲线幅度的平均值，以平均幅度为标准，基于强度阈值法剔除曲线幅度上下偏移55％及以上所对应的造影图像；</td></tr><tr><td class="content" id="description_66">(5)脾脏在灌注过程中形变较小(未超出上述强度阈值法的阈值)且B超造影图像序列帧数(Frames)超过1000，因而采取运动相位划分方案构造追踪序列，即：根据呼吸运动曲线R(t)的幅度将一个周期的呼吸运动等分为20个呼吸相位，从而得到相应呼吸相位对应的子图像序列frame_res<base:Sub>i</base:Sub>,i∈[1,20],所有呼吸相位的子图像序列总帧数为frame<base:Sub>N</base:Sub>,选取每个呼吸相位子图像序列的首帧图像构成追踪序列；</td></tr><tr><td class="content" id="description_67">(7)选择上述追踪序列中任意一帧图像作为参考图像，并勾勒出运动追踪的目标块；</td></tr><tr><td class="content" id="description_68">(8)以最小均方误差作为搜索块与目标块匹配的判断依据，对追踪序列图像进行基于由粗到精三步搜索的块匹配呼吸运动跟踪法的横向x、纵向y位移矢量计算，均方误差的计算公式如下：</td></tr><tr><td class="content" id="description_69"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901078&amp;blobId=3523511881" width="492"/></td></tr><tr><td class="content" id="description_70">其中，M,N分别为目标块的纵向和横向像素点数，C<base:Sub>ij</base:Sub>和R<base:Sub>ij</base:Sub>分别为目标块和搜索块的像素值；</td></tr><tr><td class="content" id="description_71">(9)对所有呼吸相位对应的子图像序列中经3×3像素点空间平滑所得的成像TIC进行针对性补偿，若t时刻图像对应呼吸相位res<base:Sub>i</base:Sub>，补偿前像素点(x,y)处的TIC为TIC(x,y,t)，则补偿后(x,y)处的TIC为<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901047&amp;blobId=3523478191" width="299"/></td></tr><tr><td class="content" id="description_72"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204900945&amp;blobId=3523639632" width="492"/></td></tr><tr><td class="content" id="description_73">其中，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4204901018&amp;blobId=3523118564" width="173"/>分别对应呼吸相位res<base:Sub>i</base:Sub>的x,y方向运动位移；</td></tr><tr><td class="content" id="description_74">(10)对经运动补偿后的3×3像素点空间平滑所得成像TIC与整个待灌注参量成像区域所得TIC均值曲线进行互相关分析，剔除相关系数小于0.3的成像TIC，得到有效TIC；</td></tr><tr><td class="content" id="description_75">(11)以有效TIC前5点的均值为基准进行TIC基线归零，并对TIC进行倍数为K的cubic插值，K的计算公式如下：</td></tr><tr><td class="content" id="description_76">K＝Frames/frame<base:Sub>N</base:Sub></td></tr><tr><td class="content" id="description_77">其中，Frames为图像序列总帧数；</td></tr><tr><td class="content" id="description_78">(12)分别提取TIC的时间类、强度类和比值类灌注参量，进行伪彩编码显示成像。</td></tr><tr><td class="content" id="description_79">选择脾脏作为目标灌注区域，进行Sonovue造影剂团注实验，获得相应的造影灌注图像。本发明涉及算法均在matlab平台上编程实现，其算法的整体流程图如图1所示。算法的整体流程为：呼吸运动曲线提取，补偿方案判定及追踪序列构造，运动追踪及补偿，TIC后处理，灌注参量计算及显示。与其他已公开的灌注参量成像呼吸运动补偿方法相比，本发明适用于腹部不同脏器，提取的呼吸运动曲线具有较好的生理意义，且不存在因子数选取的困难，并能有效减小呼吸运动对TIC的影响，从而很好地改善TIC的平滑度，提高灌注参量的成像质量。脾脏运动补偿前后的参量图(以峰值PV为例)和TIC分别如图2和图3所示，从图3可以看出，经呼吸运动补偿后对呼吸运动导致的TIC局部极小值干扰有效抑制，从图2可以看出，经呼吸运动补偿后的PV参量中所展示的微血管分布更为完整，未有断缺。</td></tr></table></div></body></html>