<html><head><title>全文文本(Fulltext)</title><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><style>div.fullText table {width: 100%;text-indent: 1px;} 
 div.fullText table td.header {font-weight: bold;text-align: center;font-family: '宋体';font-size: 16px;line-height:20px;color: #000000;padding: 5px;}div.fullText table td.content {padding: 1px;text-align: left;vertical-align: top;width: 100%;font-family: '宋体';font-size: 14px;line-height:20px;color: #000000;}</style></head><body><?xml version="1.0" encoding="UTF-8"?><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table><tr><td id="claim_title" class="header">权利要求书</td></tr><tr><td class="content" id="claim_1"><business:ClaimText>1.一种基于运动补偿学习的4D-CBCT成像方法，其特征在于，包括以下步骤：</business:ClaimText></td></tr><tr><td class="content" id="claim_2"><business:ClaimText>步骤1、准备网络所需训练数据集；</business:ClaimText></td></tr><tr><td class="content" id="claim_3"><business:ClaimText>在影像数据库中选取训练用4D-CBCT重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351693&amp;blobId=3687692897" width="468"/>其中T为总相位数，V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为t相位下的CBCT重建图像，当选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351858&amp;blobId=3687124276" width="68"/>为标签相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为样本相位数据；当选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351575&amp;blobId=3687353045" width="64"/>为样本相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为标签相位数据；t≠t<base:Sub>1</base:Sub>；</business:ClaimText></td></tr><tr><td class="content" id="claim_4"><business:ClaimText>步骤2、构建不同相位之间CBCT图像的运动补偿卷积神经网络；</business:ClaimText></td></tr><tr><td class="content" id="claim_5"><business:ClaimText>首先对样本相位数据和标签相位数据进行分块和预处理，然后针对分块后的图像块设计端到端的卷积神经网络，建立损失函数；最后获得样本相位数据和标签相位数据的图像块组合，并获得样本相位数据和标签相位数据之间的形变映射；</business:ClaimText></td></tr><tr><td class="content" id="claim_6"><business:ClaimText>步骤3、运动补偿卷积神经网络的训练；</business:ClaimText></td></tr><tr><td class="content" id="claim_7"><business:ClaimText>通过训练最小化损失函数，来更新网络中每层卷积参数，最终训练出从t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络M<base:Sub>t</base:Sub>，t≠t<base:Sub>1</base:Sub>，和t相位到t<base:Sub>1</base:Sub>相位下重建图的映射变换网络<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351448&amp;blobId=3687026373" width="111"/>t≠t<base:Sub>1</base:Sub>；</business:ClaimText></td></tr><tr><td class="content" id="claim_8"><business:ClaimText>步骤4、构建4D-CBCT重建模型；</business:ClaimText></td></tr><tr><td class="content" id="claim_9"><business:ClaimText>4D-CBCT重建目标函数为：<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351971&amp;blobId=3687082307" width="492"/>其中G<base:Sub>t</base:Sub>为t相位下的投影矩阵，V<base:Sub>t</base:Sub>为t相位下的待重建图像，M<base:Sub>t</base:Sub>为t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络，则M<base:Sub>t</base:Sub>·V<base:Sub>t</base:Sub>为t相位下补偿后的训练重建图，w<base:Sub>t</base:Sub>为对应投影数据的统计权重，P<base:Sub>t</base:Sub>为投影数据；<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352054&amp;blobId=3687582116" width="85"/>为加权L2范数，λ为正则化参数，TV(·)为四维TV正则化约束项，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351728&amp;blobId=3686936393" width="160"/>是将T个相位的训练重建图像组合起来，作为一组4D-CBCT图像序列；</business:ClaimText></td></tr><tr><td class="content" id="claim_10"><business:ClaimText>步骤5、利用训练好的运动补偿卷积神经网络，及4D-CBCT的重建模型，对4D-CBCT投影数据{P<base:Sub>1</base:Sub>,P<base:Sub>2</base:Sub>,…P<base:Sub>t</base:Sub>,…P<base:Sub>T</base:Sub>}进行重建，最终得到各相位下的待重建图像{V<base:Sub>1</base:Sub>,V<base:Sub>2</base:Sub>,…V<base:Sub>t</base:Sub>,…V<base:Sub>T</base:Sub>}。</business:ClaimText></td></tr><tr><td class="content" id="claim_11"><business:ClaimText>2.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于：步骤1中所选取的训练数据集与实际成像的4D-CBCT数据在扫描参数上除投影角度数外其它都保持一致。</business:ClaimText></td></tr><tr><td class="content" id="claim_12"><business:ClaimText>3.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于，步骤2中的预处理包括将分块后的数据都对其减去同一个均值并采用同一值进行归一化处理。</business:ClaimText></td></tr><tr><td class="content" id="claim_13"><business:ClaimText>4.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于：步骤2中所构建的运动补偿卷积神经网络包含一个连接层，三个降采样层，五个卷积层和两个全卷积层，所有的卷积均采用ReLU激活函数，最后一层无激活函数。</business:ClaimText></td></tr><tr><td class="content" id="claim_14"><business:ClaimText>5.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于：步骤3中的M<base:Sub>t</base:Sub>网络模块训练的损失函数<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351829&amp;blobId=3687564427" width="50"/>和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351867&amp;blobId=3687560595" width="76"/>网络模块训练的损失函数<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351821&amp;blobId=3687023775" width="52"/>为：</business:ClaimText></td></tr><tr><td class="content" id="claim_15"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351478&amp;blobId=3687285859" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_16"><business:ClaimText><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351985&amp;blobId=3687567510" width="492"/></business:ClaimText></td></tr><tr><td class="content" id="claim_17"><business:ClaimText>其中R(·)为约束项，保证运动补偿后的图像在局部区域是平滑的；V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为t相位下的训练重建图，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351608&amp;blobId=3687109233" width="71"/>为中间相位下的训练重建图，则M<base:Sub>t</base:Sub>·V<base:Sub>t</base:Sub><base:Sup>P</base:Sup>为t相位下补偿后的训练重建图，则<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351759&amp;blobId=3687085422" width="157"/>为t<base:Sub>1</base:Sub>相位下补偿后的训练重建图。</business:ClaimText></td></tr><tr><td class="content" id="claim_18"><business:ClaimText>6.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于:步骤3中的损失函数约束项为1范数约束。</business:ClaimText></td></tr><tr><td class="content" id="claim_19"><business:ClaimText>7.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于:步骤3中卷积神经网络的训练采用的是Adam方法进行最小化损失函数训练。</business:ClaimText></td></tr><tr><td class="content" id="claim_20"><business:ClaimText>8.根据权利要求1所述的一种基于运动补偿学习的4D-CBCT成像方法，其特征在于：步骤4中的4D-CBCT重建模型的求解采用的是采用交替求解的方法，具体步骤包括：</business:ClaimText></td></tr><tr><td class="content" id="claim_21"><business:ClaimText>S1、设置迭代参数，所述参数包括正则化参数、拉格朗日乘子和最大迭代次数；</business:ClaimText></td></tr><tr><td class="content" id="claim_22"><business:ClaimText>S2、设置迭代初始值，不同相位初始值采用FDK重建算法得到的三维体数据重建图像；</business:ClaimText></td></tr><tr><td class="content" id="claim_23"><business:ClaimText>S3、按照交替更新四维TV约束和重建图像数据的方式来求迭代，直到达到最大迭代次数。</business:ClaimText></td></tr></table></div><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" xmlns:business="http://www.sipo.gov.cn/XMLSchema/business" xmlns:base="http://www.sipo.gov.cn/XMLSchema/base" xmlns:tbl="http://oasis-open.org/specs/soextblx" class="fullText"><table style="table-layout:fixed"><tr><td id="description_title" class="header">
						说明书
					</td></tr><tr><td class="content" id="description_invention_title">一种基于运动补偿学习的4D-CBCT成像方法</td></tr><tr><td class="content" id="description_1">技术领域</td></tr><tr><td class="content" id="description_2">本发明涉及计算机断层成像技术领域，更具体地说，涉及一种基于运动补偿学习的4D-CBCT成像方法。</td></tr><tr><td class="content" id="description_3">背景技术</td></tr><tr><td class="content" id="description_4">随着医学技术的飞速发展，许多新技术应用于肿瘤防治，如射频消融、生物细胞疗法、基因疗法等，但放射治疗仍是治疗恶性肿瘤的三大手段之一。近几十年内，放疗临床实施的模式经历了几次大的技术革新。二十世纪后期，随着计算机断层成像(ComputedTomography,CT)、核磁共振成像(Magnetic Resonance Imaging,MRI)等技术的出现，放射治疗计划开始由二维转变成三维的。进入二十一世纪，出现的调强放射治疗，基本实现全自动计算机控制模式。但在放射治疗过程中，存在摆位误差以及靶区的变动，不仅会造成靶区漏照，还可能导致高剂量区移动到健康器官区域内，造成严重并发症或后遗症。近几年来，随着影像设备的发展，最新的图像引导放疗(Image-Guided Radiation Therapy,IGRT)技术的产生为肿瘤精确放疗提供了可能。IGRT是在放疗技术基础上整合了成像系统，其中以锥形束CT(Cone Beam CT,CBCT)成像引导的放疗系统最具代表性，它直接集成到医用直线加速器上，通过治疗前采集到的影像学信息来确定治疗靶区是否准确，并针对肿瘤的位置和形状变化，采取移动治疗床的方式来校正患者位置误差，相当于为放疗系统安装了一双“眼睛”。该技术能够最大限度地提高肿瘤照射剂量，并尽量避免射线对周围正常组织的损害，在提高放疗精度及疗效方面有显著作用。</td></tr><tr><td class="content" id="description_5">当前，临床肿瘤放射治疗多采用3D-CBCT引导的IGRT技术。然而，为实现对于胸腹部的肿瘤精确放疗，仅消除摆位误差是不够的，呼吸运动、心脏与大血管搏动以及食管蠕动均会引起肺部肿瘤的移动。肺癌放疗实施中呼吸运动是主要因素，所产生的肿瘤位置不确定性和运动伪影对IGRT提出了更高的要求，现有的CBCT成像仍然存在如下局限：局限一：无法在每次治疗前获取足够清晰并反映患者肺部解剖结构的在线影像，影响临床医师对肿瘤及其周围正常器官的准确识别。局限二：无法实时获取高分辨影像以用于辐射剂量计算，也就无法及时调整放疗计划。</td></tr><tr><td class="content" id="description_6">呼吸运动会不可避免的造成肿瘤的漏照和/或正常组织的过多卷入和损伤，是影响肺癌放疗准确实施的重要因素。针对4D-CBCT成像系统及成像模式的特殊性，近年来，科研界和工业界主要从硬件和软件算法两方面展开研究，旨在不过多增加硬件成本情况下，充分利用X射线，尽可能的提高图像成像质量，使其更好的服务于临床，如基于运动补偿的重建算法，基于呼吸相关的重建算法等。但归纳起来，重建图像质量依然不高，无法直接应用于临床，重建理论仍然存在一些缺点和不足：基于运动补偿的重建算法中，现有的变形矢量场估计不够不准确，多引入伪结构或运动模糊；呼吸相关的重建算法中，缺乏恰当的先验信息引入。如何有效的将变形矢量场和先验信息相结合，并提高成像质量是一项虽然困难但意义非常的工作。</td></tr><tr><td class="content" id="description_7">公开于该背景技术部分的信息仅仅旨在增加对本发明的总体背景的理解，而不应当被视为承认或以任何形式暗示该信息构成已为本领域一般技术人员所公知的现有技术。</td></tr><tr><td class="content" id="description_8">发明内容</td></tr><tr><td class="content" id="description_9">1.发明要解决的技术问题</td></tr><tr><td class="content" id="description_10">本发明的目的在于克服现有技术中4D-CBCT成像方法存在的不能有效去除星条状伪影和噪声问题，提供一种基于运动补偿学习的4D-CBCT成像方法，称之为运动补偿学习重建(Motion Compensation Learning Reconstruction,简称MCLR)，在不增加现有的CBCT硬件成本条件下，通过对关键的重建技术研究，结合训练运动补偿网络，来抑制由呼吸运动和角度缺失引起的图像模糊和条状伪影现象，提高4D-CBCT图像质量，使影像引导的放疗能够“看得更清，抓得更准”，从而提高肿瘤放疗的精准度，增加治疗收益。</td></tr><tr><td class="content" id="description_11">2.技术方案</td></tr><tr><td class="content" id="description_12">为达到上述目的，本发明提供的技术方案为：</td></tr><tr><td class="content" id="description_13">本发明的一种基于运动补偿学习的4D-CBCT成像方法，包括以下步骤：</td></tr><tr><td class="content" id="description_14">步骤1、准备网络所需训练数据集；</td></tr><tr><td class="content" id="description_15">在影像数据库中选取训练用4D-CBCT重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351420&amp;blobId=3686999918" width="471"/>其中T为总相位数，V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为t相位下的CBCT重建图像，当选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351564&amp;blobId=3687642749" width="73"/>为标签相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为样本相位数据；当选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351840&amp;blobId=3687063311" width="74"/>为样本相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为标签相位数据；t≠t<base:Sub>1</base:Sub>；</td></tr><tr><td class="content" id="description_16">步骤2、构建不同相位之间CBCT图像的运动补偿卷积神经网络；</td></tr><tr><td class="content" id="description_17">首先对样本相位数据和标签相位数据进行分块和预处理，然后针对分块后的图像块设计端到端的卷积神经网络，建立损失函数，以降低运动补偿后样本相位图像块与标签相位图像块之间的差异；最后获得样本相位数据和标签相位数据的图像块组合，并获得样本相位数据和标签相位数据之间的形变映射，提高相位数据之间的一致性；</td></tr><tr><td class="content" id="description_18">步骤3、运动补偿卷积神经网络的训练；</td></tr><tr><td class="content" id="description_19">通过训练最小化损失函数，来更新网络中每层卷积参数，最终训练出从t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络M<base:Sub>t</base:Sub>，t≠t<base:Sub>1</base:Sub>，和t相位到t<base:Sub>1</base:Sub>相位下重建图的映射变换网络<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351581&amp;blobId=3687654072" width="112"/>t≠t<base:Sub>1</base:Sub>；</td></tr><tr><td class="content" id="description_20">步骤4、构建4D-CBCT重建模型；</td></tr><tr><td class="content" id="description_21">4D-CBCT重建目标函数为：<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351650&amp;blobId=3687644179" width="492"/>其中G<base:Sub>t</base:Sub>为t相位下的投影矩阵，V<base:Sub>t</base:Sub>为t相位下的待重建图像，M<base:Sub>t</base:Sub>为t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络，则M<base:Sub>t</base:Sub>·V<base:Sub>t</base:Sub>为t相位下补偿后的训练重建图，w<base:Sub>t</base:Sub>为对应投影数据的统计权重，P<base:Sub>t</base:Sub>为投影数据；<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352033&amp;blobId=3686991280" width="89"/>为加权L2范数，λ为正则化参数，TV(·)为四维TV正则化约束项，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351877&amp;blobId=3687405481" width="162"/>是将T个相位的训练重建图像组合起来，作为一组4D-CBCT图像序列；</td></tr><tr><td class="content" id="description_22">步骤5、利用训练好的运动补偿卷积神经网络，及4D-CBCT的重建模型，对4D-CBCT投影数据{P<base:Sub>1</base:Sub>,P<base:Sub>2</base:Sub>,…P<base:Sub>t</base:Sub>,…P<base:Sub>T</base:Sub>}进行重建，最终得到各相位下的待重建图像{V<base:Sub>1</base:Sub>,V<base:Sub>2</base:Sub>,…V<base:Sub>t</base:Sub>,…V<base:Sub>T</base:Sub>}。</td></tr><tr><td class="content" id="description_23">更进一步地，步骤1中所选取的训练数据集与实际成像的4D-CBCT数据在扫描参数上除投影角度数外其它都保持一致。</td></tr><tr><td class="content" id="description_24">更进一步地，步骤2中的预处理包括将分块后的数据都对其减去同一个均值并采用同一值进行归一化处理。</td></tr><tr><td class="content" id="description_25">更进一步地，步骤2中所构建的运动补偿卷积神经网络包含一个连接层，三个降采样层，五个卷积层和两个全卷积层，所有的卷积均采用ReLU激活函数，最后一层无激活函数。</td></tr><tr><td class="content" id="description_26">更进一步地，步骤3中的M<base:Sub>t</base:Sub>网络模块训练的损失函数<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351781&amp;blobId=3687655605" width="59"/>和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351958&amp;blobId=3687188364" width="82"/>网络模块训练的损失函数<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351593&amp;blobId=3687559736" width="60"/>为：</td></tr><tr><td class="content" id="description_27"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351508&amp;blobId=3687509846" width="492"/></td></tr><tr><td class="content" id="description_28"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352015&amp;blobId=3687165263" width="492"/></td></tr><tr><td class="content" id="description_29">其中R(·)为约束项，保证运动补偿后的图像在局部区域是平滑的；V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为t相位下的训练重建图，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351979&amp;blobId=3687111953" width="73"/>为中间相位下的训练重建图，则M<base:Sub>t</base:Sub>·V<base:Sub>t</base:Sub><base:Sup>P</base:Sup>为t相位下补偿后的训练重建图，则<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351849&amp;blobId=3687485661" width="164"/>为t<base:Sub>1</base:Sub>相位下补偿后的训练重建图。</td></tr><tr><td class="content" id="description_30">更进一步地，步骤3中的损失函数约束项为1范数约束。</td></tr><tr><td class="content" id="description_31">更进一步地，步骤3中卷积神经网络的训练采用的是Adam方法进行最小化损失函数训练。</td></tr><tr><td class="content" id="description_32">更进一步地，步骤4中的4D-CBCT重建模型的求解采用的是采用交替求解的方法，具体步骤包括：</td></tr><tr><td class="content" id="description_33">S1、设置迭代参数，所述参数包括正则化参数、拉格朗日乘子和最大迭代次数；</td></tr><tr><td class="content" id="description_34">S2、设置迭代初始值，不同相位初始值采用采用FDK重建算法得到的三维体数据重建图像；</td></tr><tr><td class="content" id="description_35">S3、按照交替更新四维TV约束和重建图像数据的方式来求迭代，直到达到最大迭代次数。</td></tr><tr><td class="content" id="description_36">3.有益效果</td></tr><tr><td class="content" id="description_37">采用本发明提供的技术方案，与现有技术相比，具有如下有益效果：</td></tr><tr><td class="content" id="description_38">本发明的一种基于运动补偿学习的4D-CBCT成像方法，首先采用卷积神经网络对大量高质量数据集训练，获得运动补偿学习模型，然后将运动补偿卷积神经网络与传统的迭代重建方法相结合，并且提出了一种新的运动补偿学习的4D-CBCT迭代重建方式。通过卷积神经网络的数据学习策略，深入分析4D-CBCT图像域中的噪声、伪影及运动特征，并提取有效的先验信息，为高质量的重建服务，可以有效的改善了现有的重建方法在对呼吸运动的肺部重建时细节容易丢失及伪影严重的问题。实验结果验证了在常规呼吸状态下进行4D-CBCT成像，基于运动补偿学习的方法能得到较光流运动补偿迭代重建(Optical FlowMotion Compensation Reconstruction,简称OFMCR)更佳图像，即能够有效的抑制CBCT图像中在投影角度缺失条件下易出现的条状伪影，减缓由肺部呼吸带来的运动模糊，能做到实时精确定位肺部肿瘤的位置和结构，使临床医师做到“看得清，抓得准”，实现肿瘤的精准爆破，为患者降低额外辐射。并且在GPU的加速下，重建速度很快，可以达到实时成像的效果，具有较高的应用和推广前景。</td></tr><tr><td class="content" id="description_39">附图说明</td></tr><tr><td class="content" id="description_40">图1为本发明中运动补偿学习的4D-CBCT成像方法流程图；</td></tr><tr><td class="content" id="description_41">图2为本发明中运动补偿卷积神经网络的网络架构图；</td></tr><tr><td class="content" id="description_42">图3为本发明中样本及标签数据示例(a：Shepp-Logan数据；b：肺部数据)；</td></tr><tr><td class="content" id="description_43">图4为本发明实施例中模拟的动态Shepp-Logan数据重建结果(a：参考图；b：FDK重建图；c：OFMCR重建图；d：MCLR重建图)；</td></tr><tr><td class="content" id="description_44">图5为本发明实施例中模拟的动态Shepp-Logan数据重建结果的局部放大图(a：参考图；b：FDK重建图；c：OFMCR重建图；d：MCLR重建图)；</td></tr><tr><td class="content" id="description_45">图6为本发明实施例中模拟的动态Shepp-Logan数据重建结果的Profile曲线；</td></tr><tr><td class="content" id="description_46">图7为本发明实施例中模拟的动态肺部数据重建结果(a：参考图；b：FDK重建图；c：OFMCR重建图；d：MCLR重建图)；</td></tr><tr><td class="content" id="description_47">图8为本发明实施例中模拟的动态肺部数据重建结果的局部放大图(a：参考图；b：FDK重建图；c：OFMCR重建图；d：MCLR重建图)；</td></tr><tr><td class="content" id="description_48">具体实施方式</td></tr><tr><td class="content" id="description_49">为进一步了解本发明的内容，结合附图对本发明作详细描述。</td></tr><tr><td class="content" id="description_50">在本发明的描述中，需要说明的是，术语“中心”、“上”、“下”、“左”、“右”、“竖直”、“水平”、“内”、“外”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。此外，术语“第一”、“第二”、“第三”仅用于描述目的，而不能理解为指示或暗示相对重要性。</td></tr><tr><td class="content" id="description_51">下面结合实施例对本发明作进一步的描述。</td></tr><tr><td class="content" id="description_52">实施例1</td></tr><tr><td class="content" id="description_53">本实施例的一种基于运动补偿学习的4D-CBCT成像方法流程图如图1所示，具体步骤如下：</td></tr><tr><td class="content" id="description_54">步骤1、准备网络所需训练数据集。</td></tr><tr><td class="content" id="description_55">在医院影像数据库中选取高质量的4D-CBCT训练用重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352060&amp;blobId=3687075103" width="471"/>其中T为总相位数，V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为t相位下的CBCT重建图像，当选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351546&amp;blobId=3687428169" width="75"/>为标签相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为样本相位数据；当选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351997&amp;blobId=3687530554" width="74"/>为样本相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为标签相位数据；t≠t<base:Sub>1</base:Sub>；</td></tr><tr><td class="content" id="description_56">具体的，使用特定的训练数据集，如对同一个病人进行放疗时，需要对肿瘤进行实时的定位和跟踪，这就要求4D-CBCT成像质量要高。为此，所选取的训练数据集与实际成像的4D-CBCT数据在扫描参数上除投影角度数外其它都保持一致(如：扫描管电流，管电压，体素大小等)。首先对多扫描周期多投影角度下的4D-CBCT投影数据进行重建，这里为了提高重建效率，采用FDK算法进行重建，获得T个相位下的重建图；然后，选取中间相位(t<base:Sub>1</base:Sub>相位)重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351671&amp;blobId=3687541495" width="74"/>为标签相位数据，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>，t≠t<base:Sub>1</base:Sub>，作为训练样本；最后，将<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351616&amp;blobId=3687068428" width="75"/>和V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>作为训练迭代重建的卷积神经网络的标签和样本输入，训练运动补偿卷积神经网络的权重。重复的，选取中间相位重建图<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351717&amp;blobId=3687138550" width="73"/>为样本相位数据时，其余的相位重建图V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>，t≠t<base:Sub>1</base:Sub>，作为标签相位数据，来训练运动补偿卷积神经网络的权重；</td></tr><tr><td class="content" id="description_57">步骤2、构建不同相位之间CBCT图像的运动补偿卷积神经网络。</td></tr><tr><td class="content" id="description_58">首先，对样本相位数据和标签相位数据进行分块和预处理；然后针对分块后的图像块设计端到端的卷积网络模块，建立损失函数，来降低运动补偿后样本相位图像块与标签相位图像块之间的差异；最后，获得样本相位数据和标签相位数据的图像块组合，并获得样本相位数据和标签相位数据之间的形变映射，提高相位数据之间的一致性。</td></tr><tr><td class="content" id="description_59">具体的，运动补偿卷积神经网络架构图如图2所示。运动补偿卷积神经网络是采用包含一个连接层，三个降采样层，五个卷积层和两个全卷积层的浅层神经网络，其中所有的卷积均采用ReLU激活函数，最后一层无激活函数。该网络层数较少，训练容易，以实现将不同层的特征进行融合，解决训练深层网络难收敛的问题，通过训练降低损失函数值来获取整个运动补偿卷积神经网络的卷积权重，降低运动补偿后样本相位图像块与标签相位图像块之间的差异。</td></tr><tr><td class="content" id="description_60">步骤3、运动补偿卷积神经网络的训练。</td></tr><tr><td class="content" id="description_61">网络训练时随机初始化参数，并按照经验设定学习率，迭代次数，batchsize，epoch等参数。通过训练最小化损失函数，来更新网络中每层卷积参数，最终训练出从t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络M<base:Sub>t</base:Sub>，t≠t<base:Sub>1</base:Sub>，和t相位到t<base:Sub>1</base:Sub>相位下重建图的映射变换网络<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351737&amp;blobId=3687241741" width="111"/>t≠t<base:Sub>1</base:Sub>；</td></tr><tr><td class="content" id="description_62">具体的，首先，将准备的样本相位数据和标签相位数据，按照一定的尺寸和像素间隔进行分块(如：图块尺寸为45×45×25像素，分块间隔为20×20×10像素)，样本数据与标签数据分块是一一对应的。然后，对样本相位数据和标签相位数据进行分块处理，并进行一定的预处理，包括将分块后的数据都减去同一个均值并采用同一值进行归一化处理，得到近似高斯分布的数据对<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351900&amp;blobId=3687538969" width="199"/>接下来，以处理后的数据对<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351925&amp;blobId=3687163933" width="172"/>为训练集，训练三维端到端的从t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络M<base:Sub>t</base:Sub>，t≠t<base:Sub>1</base:Sub>，来补偿不同相位图之间的运动伪影和模糊。将分块后的数据作为输入，输入到运动补偿卷积神经网络中，网络中的参数进行随机初始化，并且按照经验设定学习率，迭代次数，batchsize，epoch等参数，通过采用Adam优化方法，对网络中的参数进行更新，直到损失函数L<base:Sub>i</base:Sub>达到收敛，网络训练完毕，其中M<base:Sub>t</base:Sub>网络模块训练的损失函数<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351492&amp;blobId=3687203106" width="492"/>其中R(·)为1范数约束项，保证运动补偿后的图像在局部区域是平滑的；V<base:Sub>t</base:Sub><base:Sup>p</base:Sup>为t相位下的训练重建图，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352041&amp;blobId=3687657228" width="77"/>为中间相位下的训练重建图，M<base:Sub>t</base:Sub>·V<base:Sub>t</base:Sub><base:Sup>P</base:Sup>为t相位下补偿后的训练重建图。重复的，按照同样步骤，损失函数设置为<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351518&amp;blobId=3687532467" width="492"/>训练三维端到端的从t相位到t<base:Sub>1</base:Sub>相位下重建图的映射变换网络<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352004&amp;blobId=3686935025" width="114"/>t≠t<base:Sub>1</base:Sub>，其中<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351661&amp;blobId=3687009339" width="163"/>为t<base:Sub>1</base:Sub>相位下补偿后的训练重建图。</td></tr><tr><td class="content" id="description_63">步骤4、构建4D-CBCT重建模型。</td></tr><tr><td class="content" id="description_64">基于运动补偿学习的4D-CBCT重建目标函数为：<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351749&amp;blobId=3687513085" width="492"/>其中G<base:Sub>t</base:Sub>为t相位下的投影矩阵，V<base:Sub>t</base:Sub>为t相位下的待重建图像，M<base:Sub>t</base:Sub>为t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络，M<base:Sub>t</base:Sub>·V<base:Sub>t</base:Sub>为t相位下补偿后的训练重建图，w<base:Sub>t</base:Sub>为对应投影数据的统计权重，通常按照投影数据P<base:Sub>t</base:Sub>的方差来计算；<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351912&amp;blobId=3687046876" width="91"/>为加权L2范数，λ为正则化参数，TV(·)为四维TV正则化约束项，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351587&amp;blobId=3687112904" width="161"/>是将T个相位的训练重建图像组合起来，作为一组4D-CBCT图像序列。</td></tr><tr><td class="content" id="description_65">如图1所示，本实施例的一种基于运动补偿学习的4D-CBCT成像方法，其目标函数求解过程主要包括以下步骤：</td></tr><tr><td class="content" id="description_66">S1、设置迭代参数，所述参数包括正则化参数、拉格朗日乘子和最大迭代次数；</td></tr><tr><td class="content" id="description_67">S2、设置迭代初始值，不同相位初始值采用采用FDK重建算法得到的三维体数据重建图像；</td></tr><tr><td class="content" id="description_68">S3、按照交替更新四维TV约束和重建图像数据的方式来求迭代，直到达到最大迭代次数，其中TV约束和重建图像数据更新可表示为：</td></tr><tr><td class="content" id="description_69"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351502&amp;blobId=3687359006" width="492"/></td></tr><tr><td class="content" id="description_70"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440352050&amp;blobId=3687649018" width="492"/></td></tr><tr><td class="content" id="description_71">其中，β为拉格朗日乘子，上标k为迭代次数(0≤k≤K)，λ为正则化参数，G<base:Sub>t</base:Sub>和<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351523&amp;blobId=3687566413" width="74"/>分别为t相位下的投影矩阵和反投影矩阵，V<base:Sub>t</base:Sub>为t相位下的待重建图像，w<base:Sub>t</base:Sub>为t相位下的投影数据的统计权重，Z<base:Sub>t</base:Sub>为拉格朗日辅助变量，M<base:Sub>t</base:Sub>为t<base:Sub>1</base:Sub>相位到t相位下重建图的映射变换网络，I是元素全为1的向量，<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351804&amp;blobId=3687392608" width="163"/>是将T个相位的训练重建图像组合起来，作为一组4D-CBCT图像序列；四维TV约束的将采用FISTA方法。</td></tr><tr><td class="content" id="description_72">步骤5、利用训练好的运动补偿卷积神经网络，及4D-CBCT的重建模型，对临床肺部呼吸扫描下的4D-CBCT投影数据{P<base:Sub>1</base:Sub>,P<base:Sub>2</base:Sub>,…P<base:Sub>t</base:Sub>,…P<base:Sub>T</base:Sub>}进行重建，最终得到各相位下的待重建图像{V<base:Sub>1</base:Sub>,V<base:Sub>2</base:Sub>,…V<base:Sub>t</base:Sub>,…V<base:Sub>T</base:Sub>}。</td></tr><tr><td class="content" id="description_73">具体的，临床4D-CBCT投影数据经过相位划分后，形成一组投影数据{P<base:Sub>1</base:Sub>,P<base:Sub>2</base:Sub>,…P<base:Sub>t</base:Sub>,…P<base:Sub>T</base:Sub>}，将不同相位的投影数据输入到重建模型中，达到最大迭代次数K后，最终得到各相位下的待重建图{V<base:Sub>1</base:Sub>,V<base:Sub>2</base:Sub>,…V<base:Sub>t</base:Sub>,…V<base:Sub>T</base:Sub>}。</td></tr><tr><td class="content" id="description_74">效果评估准则</td></tr><tr><td class="content" id="description_75">我们对模拟的动态Shepp-Logan数据和肺部数据进行重建，模拟扫描使用的参数为：管电压100KVp，管电流为360mAs，探测器大小为736×64，每个探测器单元尺寸为1.2856×1.0947mm<base:Sup>2</base:Sup>，射线源到物体中心和探测器中心的距离分别为59.5cm和108.56cm，扫描一周采集720个投影数据，其它参数采用默认值。网络训练所使用的是高质量的4D-CBCT图像数据，无运动模糊和条状伪影，总相位数T为10，选取的中间相位t<base:Sub>1</base:Sub>为5，样本及标签数据示意图如图3所示，总训练的运动补偿网络数目18个，重建过程中最大迭代次数为50次，正则化参数λ为0.02，拉格朗日乘子β为600。</td></tr><tr><td class="content" id="description_76">对模拟的4D-CBCT投影数据进行重建，重建结果如图4，5，7，8所示，图像显示窗宽为600HU(Housfield Units,HU)，窗位为50HU。通过比较动态Shepp-Logan数据的下，直接进行FDK重建方法、OFMCR重建方法和用本发明方法MCLR方法重建后的CBCT图来验证本发明的有效性(图4和图5)。动态Shepp-Logan数据重建结果的Profile曲线来检验重建后图像HU值的偏差(图6)；通过比较动态肺部数据的下，直接进行FDK重建方法、OFMCR重建方法和用本发明方法MCLR方法重建后的CBCT图来验证本发明的有效性(图7和图8)。为了客观有效的做出对比，我们采用了视觉评估和量化评估两种方法进行评估。</td></tr><tr><td class="content" id="description_77">视觉评估</td></tr><tr><td class="content" id="description_78">通过观察比较图4，5，7，8中CBCT图像的结构细节，对比度，解剖组织纹理，噪声伪影强度等特点，可以看出本发明能有效的提高4D-CBCT重建图像的质量。同时，我们从重建图中可以看到MCLR重建方法较经典的OFMCR迭代重建方法可以有效抑制条状伪影。从局部放大中可以看到，直接FDK重建方法噪声伪影严重，无法有效的抑制条状伪影，组织细节无法区分；OFMCR迭代重建虽然能抑制部分伪影，但产生了较大的运动模糊；而使用本发明方法MCLR重建后，图像质量有了明显提高，组织细节更加清晰，条状伪影不明显，效果更好。</td></tr><tr><td class="content" id="description_79">量化评估</td></tr><tr><td class="content" id="description_80">在使用视觉评估本发明方法的有效性的同时，我们引入两个量化指标对本发明方法的有效性进行评判，峰值信噪比(Peak Signal to Noise Ratio,PSNR)和结构相似度(Structural Similarity Index,SSIM)。其计算方法如下：</td></tr><tr><td class="content" id="description_81"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351626&amp;blobId=3687513575" width="492"/></td></tr><tr><td class="content" id="description_82"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351462&amp;blobId=3687152363" width="492"/></td></tr><tr><td class="content" id="description_83">其中V<base:Sub>t</base:Sub>为t相位下的待重建CBCT图像，H<base:Sub>t</base:Sub>为t相位下的高质量CBCT图像，为参考图，N为图像像素总数；μ<base:Sub>Vt</base:Sub>和μ<base:Sub>Ht</base:Sub>分别表示第t相位下的图像V和H的均值；σ<base:Sub>Vt</base:Sub>和σ<base:Sub>Ht</base:Sub>分别为对应的标准差，σ<base:Sub>VHt</base:Sub>为对应的协方差；C<base:Sub>1</base:Sub>和C<base:Sub>2</base:Sub>为两个常数，其中<img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351600&amp;blobId=3687623387" width="416"/><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351945&amp;blobId=3687564718" width="418"/><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351793&amp;blobId=3687535938" width="103"/>为H<base:Sub>t</base:Sub>的最大值。计算出各相位下重建图像的PSNR和SSIM的平均值，如表1所示。</td></tr><tr><td class="content" id="description_84">表1</td></tr><tr><td class="content" id="description_85"><img src="/sipopublicsearch/servlet/rm/DownLoadServlet?rid=4440351680&amp;blobId=3687028172" width="492"/></td></tr><tr><td class="content" id="description_86">从表1中可以看出，FDK算法重建图像的量化指标最差，OFMCR重建结果具有一定的提高，而采用本发明的方法可以有更高的SSIM和PSNR(肺部数据实验中，本发明MCLR算法与OFMCR算法结果相比，SSIM约高出0.03左右，PSNR约高出1.5dB左右)，量化比较的结果与视觉效果保持一致。从上述实验可以看到，在相位投影角度扫描条件下获得高质量4D-CBCT重建图像，满足了临床对肺部肿瘤的定位和跟踪要求；而且一旦网络训练好后，本发明方法计算适应性较强，具有较大的应用范围。</td></tr><tr><td class="content" id="description_87">以上示意性的对本发明及其实施方式进行了描述，该描述没有限制性，附图中所示的也只是本发明的实施方式之一，实际的结构并不局限于此。所以，如果本领域的普通技术人员受其启示，在不脱离本发明创造宗旨的情况下，不经创造性的设计出与该技术方案相似的结构方式及实施例，均应属于本发明的保护范围。</td></tr></table></div></body></html>